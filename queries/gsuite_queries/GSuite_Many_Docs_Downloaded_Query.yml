AnalysisType: scheduled_query
Description: Query to search high document download counts by users.
Enabled: true
Query: |
    SELECT
        actor:email AS user,
        ARRAY_AGG( DISTINCT parameters:doc_title) AS downloaded_files,
        ARRAY_SIZE(downloaded_files) as download_count
    FROM gsuite_activityevent
    WHERE p_occurs_since('1 day')
        AND name = 'download'
    GROUP BY actor:email
    HAVING download_count > 10
    ORDER BY download_count DESC
QueryName: High Google Drive Download Count
Schedule:
    RateMinutes: 1440
    TimeoutMinutes: 2
