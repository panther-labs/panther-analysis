AnalysisType: rule
Filename: box_event_triggered_externally.py
RuleID: Box.Event.Triggered.Externally
DisplayName: Box event triggered by unknown or external user
Enabled: true
LogTypes:
  - Box.Event
Tags:
  - Box
Severity: High
Description: >
  A external user has triggered a box enterprise event.
Reference: https://developer.box.com/reference/resources/event/
Runbook: >
  Investigate whether this user's activity is expected. 
SummaryAttributes:
  - ip_address
Threshold: 100
DedupPeriodMinutes: 60
Tests:
  -
    Name: Regular Event
    ExpectedResult: false
    Log:
      {
        "type": "event",
        "additional_details": '{"key": "value"}',
        "created_by": {
          "id": 12345678,
          "type": "user",
          "login": "cat@example",
          "name": "Bob Cat"
        },
        "event_type": "DELETE",
        "source": {
          "item_name": "regular_file.pdf",
          "item_type": "file",
          "owned_by": {
            "id": 12345678,
            "type": "user",
            "login": "cat@example",
            "name": "Bob Cat"
          },
          "parent": {
            "id": 12345,
            "type": "folder",
            "etag": 1,
            "name": "Parent_Folder",
            "sequence_id": 2
          }
        }
      }
  -
    Name: Previewed Anonymously
    ExpectedResult: true
    Log:
    {
      "created_by": {
        "id": "2",
        "type": "user",
        "name": "Unknown User"
      },
      "event_type": "PREVIEW",
      "type": "event",
      "source": {
        "item_id": "0987654321",
        "item_name": "Test.boxnote",
        "item_type": "file",
        "owned_by": {
          "id": "1234567890",
          "type": "user",
          "login": "bob.cat@example.com",
          "name": "Bob Cat"
        },
        "parent": {
          "id": "123318581760",
          "type": "folder",
          "name": "My Box Notes"
        }
      },
      "ip_address": "1.2.3.4",
    }