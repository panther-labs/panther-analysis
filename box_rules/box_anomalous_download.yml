AnalysisType: rule
Filename: box_anomalous_download.py
RuleID: Box.Shield.Anomalous.Download
DisplayName: Box Shield Detected Anomalous Download Activity
Enabled: true
LogTypes:
  - Box.Event
Tags:
  - Box
Severity: High
Description: >
  A user download activity has altered significantly. 
Reference: https://developer.box.com/guides/events/shield-alert-events/
Runbook: >
   Investigate whether this was triggered by an expected user download activity or if there is data exfiltaration.
SummaryAttributes:
  - event_type
Tests:
  -
    Name: Regular Event
    ExpectedResult: false
    Log:
      {
        "type": "event",
        "additional_details": {
          "key": "value"
        },
        "created_by": {
          "id": 12345678,
          "type": "user",
          "login": "cat@example",
          "name": "Bob Cat"
        },
        "event_id": "cd50d19784897085a8d0e3e413f8612b097c03f1",
        "event_type": "DELETE",
        "session_id": "12345678901234567890abcd",
        "source": {
          "item_id": 123456789012,
          "item_name": "regular_file.pdf",
          "item_type": "file",
          "owned_by": {
            "id": 12345678,
            "type": "user",
            "login": "cat@example",
            "name": "Bob Cat"
          },
          "parent": {
            "id": 12345,
            "type": "folder",
            "etag": 1,
            "name": "Parent_Folder",
            "sequence_id": 2
          }
        }
      }
  -
    Name: Anomalous Download Event
    ExpectedResult: true
    Log:
      {
        "type": "event",
        "additional_details":{
          "shield_alert":{
            "rule_category":"Anomalous Download",
            "rule_id":123,
            "rule_name":"Anomalous Download Rule",
            "risk_score":77,
            "alert_summary":{
              "description":"Significant increase in download content week over week, 9999% (50.00 MB) more than last week.",
              "historical_period":{
                "date_range":{
                  "start_date":"2020-01-01T01:01:00-08:00",
                  "end_date":"2020-01-08T01:01:00-08:00"
                },
                "download_size":"0 Mb",
                "downloaded_files_count":1
              },
              "anomaly_period":{
                "date_range":{
                  "start_date":"2020-01-08T01:01:00-08:00",
                  "end_date":"2020-01-15T01:01:00-08:00"
                },
                "download_size":"50 Mb",
                "downloaded_files_count":20
              },
              "download_ips":[
                {
                  "ip":"1.2.3.4"
                }
              ]
            },
            "alert_id":123,
            "priority":"medium",
            "user":{
              "id":555,
              "name":"Bob Cat",
              "email":"bob@example"
            },
            "link":"https://cloud.app.box.com/master/shield/alerts/123",
            "created_at":"2020-01-20T11:38:16-08:00"
          }
        },
        "created_by": {
          "id": 12345678,
          "type": "user",
          "login": "bob@example",
          "name": "Bob Cat"
        },
        "event_id": "cd50d19784897085a8d0e3e413f8612b097c03f1",
        "event_type": "SHIELD_ALERT",
        "session_id": "12345678901234567890abcd",
        "source": {
          "id": 12345678,
          "type": "user",
          "created_at": "2012-12-12T10:53:43-08:00",
          "language": "en",
          "login": "bob@example",
          "max_upload_size": 88999900,
          "modified_at": "2012-12-12T10:53:43-08:00",
          "name": "Bob Cat",
          "notification_email": {
            "email": "notifications@example",
            "is_confirmed": true
          },
          "phone": 1234567890,
          "status": "active",
        }
      } 