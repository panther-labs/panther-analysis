AnalysisType: rule
Filename: osquery_mac_osx_attacks_keyboard_events.py
RuleID: Osquery.Mac.OSXAttacksKeyboardEvents
DisplayName: MacOS Keyboard Events
Enabled: true
LogTypes:
  - Osquery.Differential
Tags:
  - Osquery
  - MacOS
  - Malware
Severity: Medium
Description: A Key Logger has potentially been detected on a macOS system
Runbook: Verify the Application monitoring the keyboard taps
Reference: https://support.apple.com/en-us/HT204899
Tests:
  -
    Name: App running on Desktop that is watching keyboard events
    LogType: Osquery.Differential
    ExpectedResult: true
    Log:
      {
        "name": "pack_osx-attacks_Keyboard_Event_Taps",
        "action": "added",
        "columns": {
          "path": "/Users/johnny/Desktop/Siri.app/Contents/MacOS/Siri",
          "pid": 100,
          "name": "Siri"
        }
      }
  -
    Name: App is running from approved path
    LogType: Osquery.Differential
    ExpectedResult: false
    Log:
      {
        "name": "pack_osx-attacks_Keyboard_Event_Taps",
        "action": "added",
        "columns": {
          "path": "/System/Library/CoreServices/Siri.app/Contents/MacOS/Siri",
          "pid": 100,
          "name": "Siri"
        }
      }
