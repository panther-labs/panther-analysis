AnalysisType: rule
Description: >-
  A new account was created
DisplayName: "New User Account Created"
Enabled: true
Filename: new_user_account_logging.py
LogTypes:
  - OneLogin.Events
  - AWS.CloudTrail
  - Zoom.Operation
Reference: https://attack.mitre.org/techniques/T1136/001/
Reports:
  MITRE ATT&CK:
    - TA0003:T1136
RuleID: "Standard.NewUserAccountCreated"
Runbook: >-
  A new user account was created, ensure it was created through standard practice
  and is for a valid purpose.
Severity: Info
SummaryAttributes:
  - p_any_usernames
Tags:
  - DataModel
  - Indicator Collection
  - OneLogin
  - Persistence:Create Account
Tests:
  - ExpectedResult: true
    Log:
      "actor_user_id": 123456
      "actor_user_name": "Bob Cat"
      "event_type_id": 13
      "p_event_time": "2021-06-27 00:08:28.792Z"
      "p_log_type": "OneLogin.Events"
      "p_row_id": "aaaaaaaabbbbbbbbbbbbccccccccc"
      "user_id": 12345
      "user_name": "Bob Cat"
    Mocks:
      - objectName: put_string_set
        returnValue: ''
    Name: User Creation Event - OneLogin
  - ExpectedResult: false
    Log:
      "actor_user_id": 123456
      "actor_user_name": "Bob Cat"
      "event_type_id": 5
      "ipaddr": "192.168.1.1"
      "p_event_time": "2021-06-27 00:08:28.792Z"
      "p_log_type": "OneLogin.Events"
      "p_row_id": "aaaaaaaabbbbbbbbbbbbccccccccc"
      "user_id": 12345
      "user_name": "Bob Cat"
    Name: Standard Login Event - OneLogin
  - ExpectedResult: true
    Log:
      "eventName": "CreateUser"
      "p_event_time": "2021-08-31 15:46:02.000000000"
      "p_log_type": "AWS.CloudTrail"
      "p_row_id": "aaaaaaaabbbbbbbbbbbbccccccccc"
      "responseElements":
        "user":
          "userId": "12345"
          "userName": "Bob Cat"
    Mocks:
      - objectName: put_string_set
        returnValue: ''
    Name: User Account Created - CloudTrail
  - ExpectedResult: false
    Log:
      "eventName": "ConsoleLogin"
      "p_event_time": "2021-06-04 09:59:53.650807"
      "p_log_type": "AWS.CloudTrail"
      "p_row_id": "aaaaaaaabbbbbbbbbbbbccccccccc"
      "responseElements":
        "ConsoleLogin": "Success"
      "userIdentity":
        "type": "IAMUser"
        "userName": "some_user"
    Name: Normal Console Login - CloudTrail
  - ExpectedResult: true
    Log:
      "action": "Add"
      "category_type": "User"
      "operation_detail": "Add User homer@simpson.io  - User Type: Basic - Department:
        Foo"
      "operator": "abe@simpson.io"
      "p_event_time": "2021-06-27 00:08:28.792Z"
      "p_log_type": "Zoom.Operation"
    Mocks:
      - objectName: put_string_set
        returnValue: ''
    Name: User Creation Event - Zoom
