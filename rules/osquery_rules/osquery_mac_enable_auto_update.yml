AnalysisType: rule
DedupPeriodMinutes: 1440
Description: >-
  Verifies that MacOS has automatic software updates enabled.
DisplayName: "OSQuery Reports Application Firewall Disabled"
Enabled: true
Filename: osquery_mac_enable_auto_update.py
LogTypes:
  - Osquery.Differential
Reference: https://support.apple.com/en-gb/guide/mac-help/mchlpx1065/mac
Reports:
  CIS:
    - 1.2
  MITRE ATT&CK:
    - TA0005:T1562
RuleID: "Osquery.Mac.AutoUpdateEnabled"
Runbook: >-
  Enable the auto updates on the host.
Severity: Medium
SummaryAttributes:
  - name
  - action
  - p_any_ip_addresses
  - p_any_domain_names
Tags:
  - Osquery
  - MacOS
  - Security Control
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: true
    Log:
      "action": "added"
      "columns":
        "domain": "com.apple.SoftwareUpdate"
        "key": "AutomaticCheckEnabled"
        "value": "false"
      "name": "pack/mac-cis/SoftwareUpdate"
    Name: Auto Updates Disabled
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "domain": "com.apple.SoftwareUpdate"
        "key": "AutomaticCheckEnabled"
        "value": "true"
      "name": "pack/mac-cis/SoftwareUpdate"
    Name: Auto Updates Enabled
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "domain": "com.apple.SoftwareUpdate"
        "key": "LastFullSuccessfulDate"
        "value": "false"
      "name": "pack/mac-cis/SoftwareUpdate"
    Name: Wrong Key
