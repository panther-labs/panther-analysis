AnalysisType: rule
Description: >-
  An AWS command was executed on a Linux instance
DisplayName: "AWS command executed on the command line"
Enabled: true
Filename: osquery_linux_aws_commands.py
LogTypes:
  - Osquery.Differential
Reference: https://attack.mitre.org/techniques/T1078/
Reports:
  MITRE ATT&CK:
    - TA0002:T1204
RuleID: "Osquery.Linux.AWSCommandExecuted"
Runbook: >-
  See which other commands were executed, and then remove IAM role causing the access
Severity: Medium
SummaryAttributes:
  - name
  - action
Tags:
  - Osquery
  - Linux
  - Execution:User Execution
Tests:
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "command": "aws sts get-caller-identity"
        "directory": "/home/ubuntu"
        "uid": "1000"
        "username": "ubuntu"
      "decorations":
        "platform": "darwin"
      "name": "pack_incident-response_shell_history"
    Name: AWS command executed on MacOS
  - ExpectedResult: true
    Log:
      "action": "added"
      "columns":
        "command": "aws s3 ls"
        "directory": "/home/ubuntu"
        "uid": "1000"
        "username": "ubuntu"
      "name": "pack_incident-response_shell_history"
    Name: AWS command executed
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "command": "tail -f /var/log/all"
        "directory": "/home/ubuntu"
        "uid": "1000"
        "username": "ubuntu"
      "name": "pack_incident-response_shell_history"
    Name: Tail command executed
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "command": "git commit -m 'all done'"
        "directory": "/home/ubuntu"
        "uid": "1000"
        "username": "ubuntu"
      "name": "pack_incident-response_shell_history"
    Name: Command with quote executed
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "command": "unopened '"
        "directory": "/home/ubuntu"
        "uid": "1000"
        "username": "ubuntu"
      "name": "pack_incident-response_shell_history"
    Name: Invalid command ignored
