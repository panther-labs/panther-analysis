AnalysisType: rule
Description: >-
  A system has been logged into from a non approved IP space.
DisplayName: "A Login from Outside the Corporate Office"
Enabled: false
Filename: osquery_linux_logins_non_office.py
LogTypes:
  - Osquery.Differential
Reference: https://attack.mitre.org/techniques/T1078/
Reports:
  MITRE ATT&CK:
    - TA0001:T1078
RuleID: "Osquery.Linux.LoginFromNonOffice"
Runbook: >-
  Analyze the host IP, and if possible, update allowlist or fix ACL.
Severity: High
SummaryAttributes:
  - name
  - action
  - p_any_ip_addresses
  - p_any_domain_names
Tags:
  - Configuration Required
  - Osquery
  - Linux
  - Initial Access:Valid Accounts
Tests:
  - ExpectedResult: true
    Log:
      "action": "added"
      "columns":
        "host": "10.0.3.1"
        "type": "user"
        "user": "ubuntu"
      "name": "pack/incident_response/logged_in_users"
    Name: Non-office network login (logged_in_users)
  - ExpectedResult: true
    Log:
      "action": "added"
      "columns":
        "host": "10.0.3.1"
        "pid": "648"
        "time": "1587502574"
        "tty": "ttys008"
        "type": "8"
        "username": "ubuntu"
      "name": "pack-incident_response-last"
    Name: Non-office network login (last)
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "host": "192.168.1.200"
        "user": "ubuntu"
      "name": "pack-logged_in_users"
    Name: Office network login
