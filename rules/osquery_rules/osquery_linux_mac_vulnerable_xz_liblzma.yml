AnalysisType: rule
Description: >-
  Detects vulnerable versions of XZ and liblzma on Linux and MacOS using Osquery logs.
  Versions 5.6.0 and 5.6.1 of xz and liblzma are most likely vulnerable to backdoor
  exploit. Vuln management pack must be enabled: https://github.com/osquery/osquery/blob/master/packs/vuln-management.conf
DisplayName: "A backdoored version of XZ or liblzma is vulnerable to CVE-2024-3094"
Enabled: true
Filename: osquery_linux_mac_vulnerable_xz_liblzma.py
LogTypes:
  - Osquery.Differential
Reference: https://gist.github.com/jamesspi/ee8319f55d49b4f44345c626f80c430f
Reports:
  MITRE ATT&CK:
    - TA0001:T1195.001
RuleID: "Osquery.Linux.Mac.VulnerableXZliblzma"
Runbook: >-
  Upgrade/downgrade xz and liblzma to non-vulnerable versions
Severity: High
SummaryAttributes:
  - name
  - hostIdentifier
  - action
Tags:
  - Osquery
  - MacOS
  - Linux
  - Emerging Threats
  - Supply Chain Compromise
Tests:
  - ExpectedResult: true
    Log:
      "action": "added"
      "columns":
        "name": "liblzma.so"
        "source": "test-host"
        "status": "Potentially vulnerable"
        "version": "5.6.1.000"
      "hostIdentifier": "test-host"
      "name": "pack_vuln-management_rpm_packages"
    Name: Vulnerable liblzma
  - ExpectedResult: true
    Log:
      "action": "added"
      "columns":
        "name": "xz"
        "source": "test-host"
        "status": "Potentially vulnerable"
        "version": "5.6.0.000"
      "hostIdentifier": "test-host"
      "name": "pack_vuln-management_deb_packages"
    Name: Vulnerable xz
  - ExpectedResult: false
    Log:
      "action": "added"
      "columns":
        "name": "liblzma.so"
        "source": "test-host"
        "status": "Most likely not vulnerable"
        "version": "5.4.6.000"
      "hostIdentifier": "test-host"
      "name": "pack_vuln-management_rpm_packages"
    Name: Not vulnerable
