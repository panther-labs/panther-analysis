AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  Reports when an Atlassian user logs in (impersonates) another user.
DisplayName: "Atlassian admin impersonated another user"
Enabled: true
Filename: user_logged_in_as_user.py
LogTypes:
  - Atlassian.Audit
Reference: https://support.atlassian.com/user-management/docs/log-in-as-another-user/
RuleID: "Atlassian.User.LoggedInAsUser"
Runbook: >-
  Validate that the Atlassian admin did log in (impersonate) as another user.
Severity: High
Tags:
  - Atlassian
  - User impersonation
Tests:
  - ExpectedResult: true
    Log:
      "attributes":
        "action": "user_logged_in_as_user"
        "actor":
          "email": "example.admin@example.com"
          "id": "1234567890abcdefghijklmn"
          "name": "Example Admin"
        "container":
          - "attributes":
              "siteHostName": "https://example.atlassian.net"
              "siteName": "example"
            "id": "12345678-abcd-9012-efgh-1234567890abcd"
            "links":
              "alt": "https://example.atlassian.net"
            "type": "sites"
        "context":
          - "attributes":
              "accountType": "atlassian"
              "email": "example.user@example.io"
              "name": "example.user@example.io"
            "type": "users"
        "time": "2022-12-15T00:35:15.890Z"
      "id": "2508d209-3336-4763-89a0-aceaf1322fcf"
      "message":
        "content": "Logged in as example.user@example.io"
        "format": "simple"
    Name: Admin impersonated user successfully
  - ExpectedResult: false
    Log:
      "attributes":
        "action": "user_login"
        "actor":
          "email": "example.admin@example.com"
          "id": "1234567890abcdefghijklmn"
          "name": "Example Admin"
        "container":
          - "attributes":
              "siteHostName": "https://example.atlassian.net"
              "siteName": "example"
            "id": "12345678-abcd-9012-efgh-1234567890abcd"
            "links":
              "alt": "https://example.atlassian.net"
            "type": "sites"
        "context":
          - "attributes":
              "accountType": "atlassian"
              "email": "example.user@example.io"
              "name": "example.user@example.io"
            "type": "users"
        "time": "2022-12-15T00:35:15.890Z"
      "id": "2508d209-3336-4763-89a0-aceaf1322fcf"
      "message":
        "content": "Logged in as example.user@example.io"
        "format": "simple"
    Name: user_logged_in_as_user not in log
