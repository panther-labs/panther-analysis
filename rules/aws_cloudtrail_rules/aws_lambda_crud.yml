AnalysisType: rule
Description: >-
  Unauthorized lambda Create, Read, Update, or Delete event occurred.
DisplayName: "Lambda CRUD Actions"
Enabled: false
Filename: aws_lambda_crud.py
LogTypes:
  - AWS.CloudTrail
Reference: https://docs.aws.amazon.com/lambda/latest/dg/logging-using-cloudtrail.html
Reports:
  CIS:
    - 3.12
  MITRE ATT&CK:
    - TA0005:T1525
RuleID: "AWS.LAMBDA.CRUD"
Runbook: >-
  https://docs.aws.amazon.com/lambda/latest/dg/logging-using-cloudtrail.html
Severity: High
SummaryAttributes:
  - eventSource
  - eventName
  - recipientAccountId
  - awsRegion
  - p_any_aws_arns
Tags:
  - AWS
  - Security Control
  - Configuration Required
Tests:
  - ExpectedResult: true
    Log:
      "awsRegion": "us-east-1"
      "eventID": "20b84ce5-730f-482e-b2b2-e8fcc87ceb22"
      "eventName": "DeleteFunction"
      "eventSource": "lambda.amazonaws.com"
      "eventTime": "2015-03-18T19:04:42Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.03"
      "recipientAccountId": "999999999999"
      "requestID": "a2198ecc-cda1-11e4-aaa2-e356da31e4ff"
      "requestParameters":
        "functionName": "basic-node-task"
      "responseElements":
      "sourceIPAddress": "127.0.0.1"
      "userAgent": "Python-httplib2/0.8 (gzip)"
      "userIdentity":
        "accessKeyId": "AKIAIOSFODNN7EXAMPLE"
        "accountId": "999999999999"
        "arn": "arn:aws:iam::999999999999:user/myUserName"
        "principalId": "A1B2C3D4E5F6G7EXAMPLE"
        "type": "IAMUser"
        "userName": "myUserName"
    Name: Lambda DeleteFunction Unauthorized Account
  - ExpectedResult: true
    Log:
      "awsRegion": "us-east-1"
      "eventID": "20b84ce5-730f-482e-b2b2-e8fcc87ceb22"
      "eventName": "DeleteFunction"
      "eventSource": "lambda.amazonaws.com"
      "eventTime": "2015-03-18T19:04:42Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.03"
      "recipientAccountId": "123456789012"
      "requestID": "a2198ecc-cda1-11e4-aaa2-e356da31e4ff"
      "requestParameters":
        "functionName": "basic-node-task"
      "responseElements":
      "sourceIPAddress": "127.0.0.1"
      "userAgent": "Python-httplib2/0.8 (gzip)"
      "userIdentity":
        "accessKeyId": "AKIAIOSFODNN7EXAMPLE"
        "accountId": "123456789012"
        "arn": "arn:aws:iam::123456789012:user/myUserName"
        "principalId": "A1B2C3D4E5F6G7EXAMPLE"
        "type": "IAMUser"
        "userName": "myUserName"
    Name: Lambda DeleteFunction Unauthorized User
  - ExpectedResult: false
    Log:
      "awsRegion": "us-west-1"
      "eventID": "20b84ce5-730f-482e-b2b2-e8fcc87ceb22"
      "eventName": "DeleteFunction"
      "eventSource": "lambda.amazonaws.com"
      "eventTime": "2015-03-18T19:04:42Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.03"
      "recipientAccountId": "123456789012"
      "requestID": "a2198ecc-cda1-11e4-aaa2-e356da31e4ff"
      "requestParameters":
        "functionName": "basic-node-task"
      "responseElements":
      "sourceIPAddress": "127.0.0.1"
      "userAgent": "Python-httplib2/0.8 (gzip)"
      "userIdentity":
        "accessKeyId": "AKIAIOSFODNN7EXAMPLE"
        "accountId": "123456789012"
        "arn": "arn:aws:iam::123456789012:user/DeployRole"
        "principalId": "A1B2C3D4E5F6G7EXAMPLE"
        "type": "IAMUser"
        "userName": "myUserName"
    Name: Lambda DeleteFunction Authorized Account
