AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  Threat actors who successfully compromise a victim's AWS account, whether through
  stolen credentials,  exposed access keys, exploited IAM misconfigurations, vulnerabilities
  in third-party applications,  or the absence of Multi-Factor Authentication (MFA),
  can exploit unused regions as safe zones  for malicious activities. These regions
  are often overlooked in monitoring and security setups,  making them an attractive
  target for attackers to operate undetected.
DisplayName: "AWS Cloudtrail Region Enabled"
Enabled: true
Filename: aws_cloudtrail_region_enabled.py
LogTypes:
  - AWS.CloudTrail
Reference: https://permiso.io/blog/how-threat-actors-leverage-unsupported-cloud-regions
Reports:
  MITRE ATT&CK:
    - TA0005:T1535
RuleID: "AWS.CloudTrail.EnableRegion"
Runbook: >-
  Validate whether enabling the new region was authorized.   Revoke user privileges,
  review the newly enabled region for malicious activity, and disable the region.
Severity: Medium
Tags:
  - AWS
  - CloudTrail
  - Region
Tests:
  - ExpectedResult: true
    Log:
      "additionalEventData":
        "CipherSuite": "ECDHE-RSA-AES128-GCM-SHA256"
        "SignatureVersion": "SigV4"
        "bytesTransferredIn": 0
        "bytesTransferredOut": 0
      "awsRegion": "us-east-1"
      "eventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "eventName": "EnableRegion"
      "eventSource": "cloudtrail.amazonaws.com"
      "eventTime": "2023-10-01T12:34:56Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.08"
      "managementEvent": false
      "readOnly": false
      "recipientAccountId": "123456789012"
      "requestID": "EXAMPLE123456789"
      "requestParameters":
        "RegionName": "us-west-2"
      "resources": []
      "responseElements":
      "sharedEventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "sourceIPAddress": "192.0.2.0"
      "userAgent": "aws-sdk-go/1.15.12 (go1.12.6; linux; amd64)"
      "userIdentity":
        "accessKeyId": "EXAMPLEKEY"
        "accountId": "123456789012"
        "arn": "arn:aws:iam::123456789012:user/Alice"
        "principalId": "EXAMPLE"
        "type": "IAMUser"
        "userName": "Alice"
      "vpcEndpointId": "vpce-1a2b3c4d"
    LogType: AWS.CloudTrail
    Name: EnableRegion
  - ExpectedResult: false
    Log:
      "additionalEventData":
        "CipherSuite": "ECDHE-RSA-AES128-GCM-SHA256"
        "SignatureVersion": "SigV4"
        "bytesTransferredIn": 0
        "bytesTransferredOut": 0
      "awsRegion": "us-east-1"
      "eventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "eventName": "ListBucket"
      "eventSource": "s3.amazonaws.com"
      "eventTime": "2023-10-01T12:34:56Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.08"
      "managementEvent": false
      "readOnly": true
      "recipientAccountId": "123456789012"
      "requestID": "EXAMPLE123456789"
      "requestParameters":
        "bucketName": "example-bucket"
      "resources":
        - "ARN": "arn:aws:s3:::example-bucket"
          "type": "AWS::S3::Bucket"
      "responseElements":
      "sharedEventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "sourceIPAddress": "192.0.2.0"
      "userAgent": "aws-sdk-go/1.15.12 (go1.12.6; linux; amd64)"
      "userIdentity":
        "accessKeyId": "EXAMPLEKEY"
        "accountId": "123456789012"
        "arn": "arn:aws:iam::123456789012:user/Bob"
        "principalId": "EXAMPLE"
        "type": "IAMUser"
        "userName": "Bob"
      "vpcEndpointId": "vpce-1a2b3c4d"
    LogType: AWS.CloudTrail
    Name: Other Event
