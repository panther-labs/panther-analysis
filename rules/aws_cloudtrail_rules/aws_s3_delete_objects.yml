AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  This rule detects when multiple objects are deleted from an S3 bucket. Such actions
  can be indicative of unauthorized data deletion or other suspicious activities.
DisplayName: "AWS S3 Delete Objects Detection"
Enabled: true
Filename: aws_s3_delete_objects.py
LogTypes:
  - AWS.CloudTrail
Reference: 
  https://docs.aws.amazon.com/AmazonS3/latest/userguide/logging-with-cloudtrail.html
RuleID: "AWS.S3.DeleteObjects"
Runbook: >-
  Investigate the user and the actions performed on the S3 bucket to ensure they were
  authorized. Unauthorized deletions can lead to data loss. Steps to investigate:
  1. Identify the user who performed the action. 2. Verify if the action was authorized.
  3. Check for any other suspicious activities performed by the same user. 4. If unauthorized,
  take necessary actions to secure the S3 bucket and prevent further unauthorized
  access.
Severity: Info
Tags:
  - AWS
  - S3
  - CloudTrail
  - Beta
Tests:
  - ExpectedResult: true
    Log:
      "additionalEventData":
        "CipherSuite": "ECDHE-RSA-AES128-GCM-SHA256"
        "SignatureVersion": "SigV4"
        "bytesTransferredIn": 0
        "bytesTransferredOut": 0
      "awsRegion": "us-east-1"
      "eventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "eventName": "DeleteObjects"
      "eventSource": "s3.amazonaws.com"
      "eventTime": "2023-10-01T12:34:56Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.08"
      "managementEvent": false
      "readOnly": false
      "recipientAccountId": "123456789012"
      "requestID": "EXAMPLE123456789"
      "requestParameters":
        "bucketName": "example-bucket"
        "key": "example-object"
      "resources":
        - "ARN": "arn:aws:s3:::example-bucket/example-object"
          "type": "AWS::S3::Object"
      "responseElements":
      "sharedEventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "sourceIPAddress": "192.0.2.0"
      "userAgent": "aws-sdk-go/1.15.12 (go1.12.6; linux; amd64)"
      "userIdentity":
        "accessKeyId": "EXAMPLEKEY"
        "accountId": "123456789012"
        "arn": "arn:aws:iam::123456789012:user/Alice"
        "principalId": "EXAMPLE"
        "type": "IAMUser"
        "userName": "Alice"
      "vpcEndpointId": "vpce-1a2b3c4d"
    LogType: AWS.CloudTrail
    Name: DeleteObjects
  - ExpectedResult: false
    Log:
      "additionalEventData":
        "CipherSuite": "ECDHE-RSA-AES128-GCM-SHA256"
        "SignatureVersion": "SigV4"
        "bytesTransferredIn": 0
        "bytesTransferredOut": 0
      "awsRegion": "us-east-1"
      "eventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "eventName": "ListBucket"
      "eventSource": "s3.amazonaws.com"
      "eventTime": "2023-10-01T12:34:56Z"
      "eventType": "AwsApiCall"
      "eventVersion": "1.08"
      "managementEvent": false
      "readOnly": true
      "recipientAccountId": "123456789012"
      "requestID": "EXAMPLE123456789"
      "requestParameters":
        "bucketName": "example-bucket"
      "resources":
        - "ARN": "arn:aws:s3:::example-bucket"
          "type": "AWS::S3::Bucket"
      "responseElements":
      "sharedEventID": "EXAMPLE-1234-5678-9012-EXAMPLE"
      "sourceIPAddress": "192.0.2.0"
      "userAgent": "aws-sdk-go/1.15.12 (go1.12.6; linux; amd64)"
      "userIdentity":
        "accessKeyId": "EXAMPLEKEY"
        "accountId": "123456789012"
        "arn": "arn:aws:iam::123456789012:user/Bob"
        "principalId": "EXAMPLE"
        "type": "IAMUser"
        "userName": "Bob"
      "vpcEndpointId": "vpce-1a2b3c4d"
    LogType: AWS.CloudTrail
    Name: Other Event
Threshold: 1
