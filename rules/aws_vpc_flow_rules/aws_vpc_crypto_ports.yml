AnalysisType: rule
Filename: aws_vpc_crypto_ports.py
RuleID: "AWS.VPC.CryptoPorts"
DisplayName: "VPC Flow Logs Known Cryotomining Ports"
Enabled: false
LogTypes:
  - AWS.VPCFlow
Tags:
  - AWS
  - Configuration Required
  - Security Control
  - Command and Control:Application Layer Protocol
Reports:
  MITRE ATT&CK:
    - TA0040:T1496
Severity: Low
Description: >
  Alerts if a known cryptomining port is detected in outbound traffic.
Runbook: >
  Investigate the host sending traffic over the known cryptomining ports for activity or signs of compromise or other malicious activity. Update network configurations appropriately.
Reference: https://unit42.paloaltonetworks.com/malicious-operations-of-exposed-iam-keys-cryptojacking/
SummaryAttributes:
  - srcaddr
  - dstaddr
  - dstport
Tests:
  -
    Name: DstPortInKnownList-true
    ExpectedResult: true
    Log:
      {
        "dstport": 6641,
        "dstaddr": "106.58.92.8",
        "srcaddr": "10.0.0.1"
      }
  -
    Name: DstPortTwoInKnownList-true
    ExpectedResult: true
    Log:
      {
        "dstport": 9332,
        "dstaddr": "106.58.92.8",
        "srcaddr": "10.0.0.1"
      }
  -
    Name: DstPortNotInKnownList-true
    ExpectedResult: false
    Log:
      {
        "dstport": 443,
        "dstaddr": "100.100.100.100",
        "srcaddr": "10.0.0.1"
      }
