AnalysisType: rule
Description: >-
  VPC Flow Logs observed inbound traffic violating the port blocklist.
DisplayName: "VPC Flow Logs Inbound Port Blocklist"
Enabled: false
Filename: aws_vpc_inbound_traffic_port_blocklist.py
LogTypes:
  - AWS.VPCFlow
  - OCSF.NetworkActivity
Reference: https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html
Reports:
  MITRE ATT&CK:
    - TA0011:T1571
RuleID: "AWS.VPC.InboundPortBlacklist"
Runbook: >-
  Block the unapproved traffic, or update the unapproved ports list.
Severity: High
SummaryAttributes:
  - srcaddr
  - dstaddr
  - dstport
Tags:
  - AWS
  - DataModel
  - Configuration Required
  - Security Control
  - Command and Control:Non-Standard Port
Tests:
  - ExpectedResult: true
    Log:
      "dstAddr": "10.0.0.1"
      "dstPort": 22
      "p_log_type": "AWS.VPCFlow"
      "srcAddr": "1.1.1.1"
    Name: Public to Private IP on Restricted Port
  - ExpectedResult: false
    Log:
      "dstAddr": "10.0.0.1"
      "dstPort": 443
      "p_log_type": "AWS.VPCFlow"
      "srcAddr": "1.1.1.1"
    Name: Public to Private IP on Allowed Port
  - ExpectedResult: false
    Log:
      "dstAddr": "10.0.0.1"
      "dstPort": 22
      "p_log_type": "AWS.VPCFlow"
      "srcAddr": "10.10.10.1"
    Name: Private to Private IP on Restricted Port
  - ExpectedResult: true
    Log:
      "dst_endpoint":
        "ip": "10.0.0.1"
        "port": 22
      "p_log_type": "OCSF.NetworkActivity"
      "src_endpoint":
        "ip": "1.1.1.1"
    Name: Public to Private IP on Restricted Port - OCSF
  - ExpectedResult: false
    Log:
      "dst_endpoint":
        "ip": "10.0.0.1"
        "port": 443
      "p_log_type": "OCSF.NetworkActivity"
      "src_endpoint":
        "ip": "1.1.1.1"
    Name: Public to Private IP on Allowed Port - OCSF
