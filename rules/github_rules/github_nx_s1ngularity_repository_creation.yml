AnalysisType: rule
Filename: github_nx_s1ngularity_repository_creation.py
RuleID: GitHub.NX.S1ngularity.Repository.Creation
DisplayName: NX Supply Chain - S1ngularity Repository Activity
Enabled: true
LogTypes:
  - GitHub.Audit
Tags:
  - GitHub
  - Supply Chain Attack
  - NX Package Compromise
  - S1ngularity Campaign
  - Data Exfiltration
  - Repository Creation
Reports:
  MITRE ATT&CK:
    - TA0001:T1195.002  # Supply Chain Compromise: Compromise Software Supply Chain
    - TA0010:T1567.001  # Exfiltration Over Web Service: Exfiltration to Code Repository
Severity: Critical
Description: >
  Detects repository creation and access patterns associated with the NX supply chain compromise (s1ngularity campaign).
  This attack compromised popular NX build system packages affecting ~4M weekly downloads and created repositories
  with specific naming patterns for data exfiltration of cryptocurrency wallets, SSH keys, and development credentials.
  
  Attack Details:
  - Timeline: August 26-27, 2025 (22:32-03:37 UTC)
  - Malicious repositories: s1ngularity-repository, s1ngularity-repository-0/1
  - Data targeted: Crypto wallets, SSH keys, GitHub/NPM tokens, .env files
  - Novel technique: First documented weaponization of AI CLI tools for reconnaissance
  - Persistence: Modified shell startup files with shutdown commands
Runbook: >
  For all users, check if you were impacted
  1. Check this https://github.com/search?q=s1ngularity-repository&type=repositories to see if your a repo was published to your Github account.
  2. Download the file in the repo for your own records.
  3. Then, remove the repo from GitHub.
  4. E-mail security@nrwl.io and we will instruct you on how to decode the file so you are aware what information was leaked
  Rotate your credentials and tokens on all of your accounts.

  For all users, stop using the malicious versions
  # Check if the version of nx you are using was a malicious version
  npm ls nx

  # If using affected versions, update immediately:
  npm uninstall nx && npm install nx@latest

  # Clear npm cache
  npm cache clean --force
  
  For Users Who were compromised:
  Refer to the section above to see if you were compromised. If so, do the following.

  1. Rotate npm tokens: Visit https://www.npmjs.com/ and rotate your tokens.
  2. Rotate Github Tokens: Visit https://www.github.com/ and rotate your tokens.
  3. Change Github Credentials: Change passwords for Github
  4. Change your passwords for any other services you use.
Reference: https://github.com/nrwl/nx/security/advisories/GHSA-cxm3-wv7p-598c
DedupPeriodMinutes: 60
SummaryAttributes:
  - actor
  - repo
  - action
  - org
Tests:
  - Name: S1ngularity Repository Creation
    ExpectedResult: true
    Log:
      action: repo.create
      actor: compromised-user
      actor_id: "12345678"
      actor_ip: 192.168.1.100
      repo: evil-org/s1ngularity-repository
      org: evil-org
      visibility: public
      public_repo: true
      operation_type: create
      created_at: "2025-08-26T22:32:00Z"
      p_event_time: "2025-08-26 22:32:00"
      p_log_type: GitHub.Audit

  - Name: S1ngularity Repository Access
    ExpectedResult: true
    Log:
      action: repo.access
      actor: attacker
      actor_id: "87654321"
      actor_ip: 10.0.0.1
      repo: victim-org/s1ngularity-repository-0
      org: victim-org
      visibility: public
      public_repo: true
      operation_type: access
      p_event_time: "2025-08-26 23:15:00"
      p_log_type: GitHub.Audit

  - Name: S1ngularity Repository Download
    ExpectedResult: true
    Log:
      action: repo.download_zip
      actor: malicious-actor
      actor_id: "11223344"
      repo: target-org/s1ngularity-repository-1
      org: target-org
      visibility: public
      public_repo: true
      user_agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)"
      p_event_time: "2025-08-27 01:00:00"
      p_log_type: GitHub.Audit

  - Name: Normal Repository Creation
    ExpectedResult: false
    Log:
      action: repo.create
      actor: legitimate-user
      repo: normal-org/legitimate-project
      org: normal-org
      visibility: public
      public_repo: true
      operation_type: create
      p_event_time: "2025-08-26 20:00:00"
      p_log_type: GitHub.Audit

  - Name: Non-Repository Action
    ExpectedResult: false
    Log:
      action: user.login
      actor: some-user
      org: some-org
      p_event_time: "2025-08-26 22:00:00"
      p_log_type: GitHub.Audit

  - Name: S1ngularity Pattern Case Insensitive
    ExpectedResult: true
    Log:
      action: repo.create
      actor: test-user
      repo: test-org/S1NGULARITY-REPOSITORY
      org: test-org
      visibility: public
      public_repo: true
      operation_type: create
      p_event_time: "2025-08-26 22:45:00"
      p_log_type: GitHub.Audit