AnalysisType: rule
Description: >-
  Detects when a user initially accesses a private organization repository.
DisplayName: "GitHub User Initial Access to Private Repo"
Enabled: true
Filename: github_repo_initial_access.py
LogTypes:
  - GitHub.Audit
Reference: 
  https://docs.github.com/en/organizations/managing-user-access-to-your-organizations-repositories/managing-repository-roles/managing-an-individuals-access-to-an-organization-repository
RuleID: "GitHub.Repo.InitialAccess"
Severity: Info
Tags:
  - GitHub
Tests:
  - ExpectedResult: true
    Log:
      "@timestamp": 1623971719091
      "action": "git.push"
      "actor": "cat"
      "business": ""
      "org": "my-org"
      "p_log_type": "GitHub.Audit"
      "protocol_name": "ssh"
      "repo": "my-org/my-repo"
      "repository": "my-org/my-repo"
      "repository_public": false
      "user": ""
    Mocks:
      - objectName: get_string_set
        returnValue: ''
      - objectName: put_string_set
        returnValue: ''
    Name: GitHub - Initial Access
  - ExpectedResult: false
    Log:
      "@timestamp": 1623971719091
      "action": "git.push"
      "actor": "cat"
      "business": ""
      "org": "my-org"
      "p_log_type": "GitHub.Audit"
      "protocol_name": "ssh"
      "repo": "my-org/my-repo"
      "repository": "my-org/my-repo"
      "repository_public": false
      "user": ""
    Mocks:
      - objectName: get_string_set
        returnValue: "\"cat\":\"my-repo\"\n"
    Name: GitHub - Repeated Access
  - ExpectedResult: false
    Log:
      "@timestamp": 1623971719091
      "action": "git.push"
      "actor": "cat"
      "business": ""
      "org": "my-org"
      "p_log_type": "GitHub.Audit"
      "protocol_name": "ssh"
      "repo": "my-org/my-repo"
      "repository": "my-org/my-repo"
      "repository_public": true
      "user": ""
    Mocks:
      - objectName: get_string_set
        returnValue: ''
      - objectName: put_string_set
        returnValue: ''
    Name: GitHub - Initial Access Public Repo
  - ExpectedResult: false
    Log:
      "@timestamp": 1623971719091
      "action": "git.push"
      "actor": ""
      "business": ""
      "org": "my-org"
      "p_log_type": "GitHub.Audit"
      "protocol_name": "ssh"
      "repo": "my-org/my-repo"
      "repository": "my-org/my-repo"
      "repository_public": false
      "user": ""
    Name: GitHub - Clone without Actor
