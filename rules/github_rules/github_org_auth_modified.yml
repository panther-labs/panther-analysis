AnalysisType: rule
Filename: github_org_auth_modified.py
RuleID: "GitHub.Org.AuthChange"
DisplayName: "GitHub Org Authentication Method Changed"
Enabled: true
LogTypes:
  - GitHub.Audit
Tags:
  - GitHub
  - Persistence
  - Account Manipulation
  - Identity and Access Management
  - Security Configuration
  - Privilege Escalation
  - Defense Evasion
  - Organization Security
Reports:
  MITRE ATT&CK:
    - TA0003:T1098
Severity: Critical
SummaryAttributes:
  - actor
  - action
Description: >
  Detects critical changes to GitHub organization authentication and access control settings that govern how users authenticate and access organizational resources. This rule monitors eight high-impact configuration changes: SAML single sign-on enablement or disablement, organization-wide two-factor authentication (2FA) requirement changes, SAML identity provider settings modifications, and OAuth application restriction policy changes. These authentication controls are foundational security mechanisms that protect entire GitHub organizations, and unauthorized or malicious modifications can severely weaken security posture. Disabling SAML SSO can allow attackers to bypass centralized identity management and maintain access even after corporate credentials are revoked. Disabling the organization-wide 2FA requirement removes a critical defense layer, enabling attackers with compromised passwords to access repositories without second-factor verification. Modifying SAML provider settings could redirect authentication to attacker-controlled identity providers for credential harvesting. Disabling OAuth app restrictions allows potentially malicious third-party applications to access organizational data without approval workflows. Attackers who compromise a GitHub organization owner or admin account often make these changes to establish persistence, weaken defenses for lateral movement, or prepare for data exfiltration. Legitimate changes do occur during planned security policy updates, migrations to new SSO providers, or organizational restructuring, but these should be rare, well-documented, and performed by authorized administrators. This rule leverages GitHub Audit Log events to detect these configuration changes in real-time, enabling security teams to validate authorization and rollback unauthorized changes before widespread impact.
Runbook: |
  1. Query GitHub audit logs for all actions by the actor in the 48 hours around this authentication change to identify other suspicious activities such as adding organization members, creating personal access tokens, modifying repository permissions, or accessing private repositories
  2. Review the organization membership changes, team permission modifications, and repository access grants in the 6 hours around this event to determine if the actor used elevated access to establish additional persistence mechanisms
  3. Check GitHub audit logs for authentication failures, suspicious login locations, or unusual access patterns from the actor's account in the 7 days before this change that might indicate account compromise
Reference: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/about-authentication-to-github
Tests:
  - Name: GitHub - SAML Disabled
    ExpectedResult: true
    Log:
      {
        "actor": "cat",
        "action": "org.saml_disabled",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
        "repo": "my-org/my-repo",
      }
  - Name: GitHub - Two Factor Requirement Disabled
    ExpectedResult: true
    Log:
      {
        "actor": "admin-user",
        "action": "org.disable_two_factor_requirement",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
      }
  - Name: GitHub - Two Factor Requirement Enabled
    ExpectedResult: true
    Log:
      {
        "actor": "security-admin",
        "action": "org.enable_two_factor_requirement",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
      }
  - Name: GitHub - OAuth App Restrictions Disabled
    ExpectedResult: true
    Log:
      {
        "actor": "org-owner",
        "action": "org.disable_oauth_app_restrictions",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
      }
  - Name: GitHub - OAuth App Restrictions Enabled
    ExpectedResult: true
    Log:
      {
        "actor": "security-admin",
        "action": "org.enable_oauth_app_restrictions",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
      }
  - Name: GitHub - SAML Provider Settings Updated
    ExpectedResult: true
    Log:
      {
        "actor": "it-admin",
        "action": "org.update_saml_provider_settings",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
      }
  - Name: GitHub - SAML Enabled
    ExpectedResult: true
    Log:
      {
        "actor": "security-team",
        "action": "org.saml_enabled",
        "created_at": 1621305118553,
        "p_log_type": "GitHub.Audit",
        "org": "my-org",
      }
  - Name: GitHub - Non Auth Related Org Change
    ExpectedResult: false
    Log:
      {
        "actor": "cat",
        "action": "invite_member",
        "created_at": 1621305118553,
        "org": "my-org",
        "p_log_type": "GitHub.Audit",
        "repo": "my-org/my-repo",
      }
  - Name: GitHub - Non Org Action
    ExpectedResult: false
    Log:
      {
        "actor": "developer",
        "action": "repo.create",
        "created_at": 1621305118553,
        "org": "my-org",
        "p_log_type": "GitHub.Audit",
        "repo": "my-org/new-repo",
      }
