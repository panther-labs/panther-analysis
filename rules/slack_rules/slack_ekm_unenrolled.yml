AnalysisType: rule
Filename: slack_ekm_unenrolled.py
RuleID: "Slack.AuditLogs.EKMUnenrolled"
DisplayName: "Slack Enterprise Key Management Unenrolled"
Enabled: true
LogTypes:
  - Slack.AuditLogs
Tags:
  - Slack
  - Defense Evasion
  - Weaken Encryption
  - Compliance
  - Data Protection
Reports:
  MITRE ATT&CK:
    - TA0005:T1600
    - TA0009:T1530
    - TA0010:T1567
Severity: Critical
Description: >
  Detects when a Slack workspace is unenrolled from Enterprise Key Management (EKM), representing a severe security degradation by removing customer-controlled encryption. EKM is Slack's enterprise-grade security feature that allows organizations to maintain complete control over their encryption keys by storing them in external key management systems such as AWS KMS, allowing customers to manage key rotation, access policies, and revocation independently of Slack. When EKM is enabled, Slack cannot decrypt workspace data without the customer providing access to their encryption keys, ensuring data remains protected even from Slack itself and providing defense-in-depth for sensitive communications and files. Unenrolling from EKM reverts the workspace to Slack-managed encryption keys, meaning Slack (and by extension, anyone who compromises Slack's infrastructure or obtains legal access to Slack systems) can decrypt all workspace data including messages, files, and metadata. This encryption downgrade has severe implications for organizations in regulated industries (healthcare with HIPAA, financial services with PCI-DSS, government contractors with FedRAMP, any organization with SOC 2 Type II commitments) where customer-controlled encryption is often a mandatory compliance requirement. Legitimate EKM unenrollment is extremely rare and typically only occurs during major organizational changes such as transitioning to a different key management provider, consolidating Slack workspaces during mergers, or troubleshooting critical technical issues with key availability, and should always require executive approval and legal/compliance review. Malicious unenrollment could indicate a compromised Slack administrator account being used to weaken encryption controls in preparation for data exfiltration, an insider threat attempting to gain unauthorized access to encrypted communications, or an attacker attempting to evade detection by accessing data that would otherwise be protected by customer-controlled keys. This action immediately exposes all workspace data to decryption by Slack systems and should trigger immediate investigation to determine authorization, business justification, compliance impact, and whether re-enrollment is required.
Reference: https://slack.com/intl/en-gb/help/articles/360019110974-Slack-Enterprise-Key-Management
Runbook: |
  1. Immediately identify the actor who unenrolled the workspace from EKM (check actor.user.email and actor.user.name from the alert) and the affected workspace (check context.location.domain and context.location.name) to understand the scope of this encryption downgrade
  2. Contact the identified actor through a secure out-of-band communication channel (phone call, in-person meeting, secondary platform) within minutes to verify they intentionally unenrolled EKM and have executive authorization with documented business justification for this critical security change
  3. If the actor confirms this was authorized, immediately obtain and review the change authorization documentation including executive approval, business justification (key management provider migration, workspace consolidation, technical troubleshooting), and timeline for re-enrollment to validate this is a legitimate temporary change
  4. Assess the compliance and regulatory impact by consulting with your legal, compliance, and information security teams to determine if EKM unenrollment violates regulatory requirements (HIPAA, FedRAMP, PCI-DSS, GDPR data processing agreements), contractual obligations with customers requiring customer-managed encryption, or internal security policies and data classification standards
  5. If this was unauthorized or the actor's account appears compromised, immediately use Slack Admin controls to re-enroll the workspace in EKM through Organization Settings > Security > Enterprise Key Management to restore customer-controlled encryption and prevent further data exposure
  6. Review the actor's complete Slack audit log activity for the past 30 days to identify other suspicious administrative actions such as data exports, workspace settings changes, user privilege escalations, external sharing modifications, app installations, or API token creations that might indicate broader account compromise or insider threat activity
  7. Investigate the timing and context of the unenrollment by checking if it occurred outside normal business hours, from an unusual IP address or geographic location, immediately before or after other suspicious events such as large data downloads, or in conjunction with other security control weakening (disabling 2FA, changing data retention policies)
  8. Assess the data exposure risk by determining what sensitive data exists in the workspace (intellectual property, customer data, financial information, healthcare records, personally identifiable information), who may have gained access to decryption capabilities during the unenrolled period, and whether this constitutes a data breach requiring notification under applicable regulations
  9. If this was a malicious or unauthorized action, collect comprehensive forensic evidence including complete audit logs, the actor's authentication history, IP addresses and user agents, any data access or export activity during the unenrolled period, and correlation with other security events for potential incident response, HR investigation, or law enforcement involvement
  10. Document the incident including who unenrolled EKM, when it was detected, business justification if authorized, duration of exposure, data at risk, and remediation actions taken, then notify executive leadership, legal counsel, compliance teams, and potentially customers or regulators depending on contractual obligations and regulatory requirements, and implement preventive controls such as requiring multi-person approval for EKM changes, enhanced monitoring and alerting for encryption control modifications, and regular audits of EKM enrollment status
DedupPeriodMinutes: 60
Threshold: 1
SummaryAttributes:
  - p_any_ip_addresses
  - p_any_emails
Tests:
  - Name: EKM Unenrolled
    ExpectedResult: true
    Log:
      {
        "action": "ekm_unenrolled",
        "actor":
          {
            "type": "user",
            "user":
              {
                "email": "user@example.com",
                "id": "A012B3CDEFG",
                "name": "username",
                "team": "T01234N56GB",
              },
          },
        "context":
          {
            "ip_address": "1.2.3.4",
            "location":
              {
                "domain": "test-workspace",
                "id": "T01234N56GB",
                "name": "test-workspace",
                "type": "workspace",
              },
            "ua": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",
          },
      }
  - Name: User Logout
    ExpectedResult: false
    Log:
      {
        "action": "user_logout",
        "actor":
          {
            "type": "user",
            "user":
              {
                "email": "user@example.com",
                "id": "W012J3FEWAU",
                "name": "primary-owner",
                "team": "T01234N56GB",
              },
          },
        "context":
          {
            "ip_address": "1.2.3.4",
            "location":
              {
                "domain": "test-workspace-1",
                "id": "T01234N56GB",
                "name": "test-workspace-1",
                "type": "workspace",
              },
            "ua": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",
          },
        "date_create": "2022-07-28 15:22:32",
        "entity":
          {
            "type": "user",
            "user":
              {
                "email": "user@example.com",
                "id": "W012J3FEWAU",
                "name": "primary-owner",
                "team": "T01234N56GB",
              },
          },
        "id": "72cac009-9eb3-4dde-bac6-ee49a32a1789",
      }
