AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  You can configure Atlas to require API access lists at the organization level. When
  you enable IP access list for the Atlas Administration API, all API calls in that
  organization must originate from a valid entry in the associated Atlas Administration
  API key access list. This rule detects when IP access list is disabled
DisplayName: "MongoDB org membership restriction disabled"
Enabled: true
Filename: mongodb_org_membership_restriction_disabled.py
LogTypes:
  - MongoDB.OrganizationEvent
Reference: https://www.mongodb.com/docs/atlas/tutorial/manage-organizations/
Reports:
  MITRE ATT&CK:
    - TA0003:T1556.009
RuleID: "MongoDB.org.Membership.Restriction.Disabled"
Runbook: >-
  Check if this activity is legitimate. If not, re-enable IP access list for the Atlas
  Administration API
Severity: High
Tags:
  - MongoDB
  - Persistence
  - Modify Authentication Process
  - Conditional Access Policies
Tests:
  - ExpectedResult: true
    Log:
      "created": "2024-04-03 15:03:51.000000000"
      "currentValue": {}
      "eventTypeName": "ORG_PUBLIC_API_ACCESS_LIST_NOT_REQUIRED"
      "id": "alert_id"
      "isGlobalAdmin": false
      "orgId": "some_org_id"
      "remoteAddress": "1.2.3.4"
      "userId": "user_id"
      "username": "some_user@company.com"
    Name: Restriction disabled
  - ExpectedResult: false
    Log:
      "created": "2024-04-03 15:03:51.000000000"
      "currentValue": {}
      "eventTypeName": "ORG_PUBLIC_API_ACCESS_LIST_REQUIRED"
      "id": "alert_id"
      "isGlobalAdmin": false
      "orgId": "some_org_id"
      "remoteAddress": "1.2.3.4"
      "userId": "user_id"
      "username": "some_user@company.com"
    Name: Restriction enabled
  - ExpectedResult: false
    Log:
      "alertConfigId": "alert_id"
      "created": "2024-04-01 11:58:52.000000000"
      "currentValue": {}
      "eventTypeName": "ALERT_CONFIG_DELETED_AUDIT"
      "id": "alert_id"
      "isGlobalAdmin": false
      "links": []
      "orgId": "some_org_id"
      "remoteAddress": "1.2.3.4"
      "userId": "user_id"
      "username": "some_user@company.com"
    Name: Other activity
Threshold: 1
