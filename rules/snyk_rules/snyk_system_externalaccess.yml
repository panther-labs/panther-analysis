AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  Detects when Snyk Settings that control access for external parties have been changed.
DisplayName: "Snyk System External Access Settings Changed"
Enabled: true
Filename: snyk_system_externalaccess.py
LogTypes:
  - Snyk.GroupAudit
  - Snyk.OrgAudit
Reference: 
  https://docs.snyk.io/snyk-admin/manage-users-and-permissions/organization-access-requests
RuleID: "Snyk.System.ExternalAccess"
Runbook: >-
  This action in the Snyk Audit logs indicate that the setting for allowing external
  parties to request access to your Snyk installation have changed.
Severity: High
SummaryAttributes:
  - event
Tags:
  - Snyk
Tests:
  - ExpectedResult: true
    Log:
      "content":
        "after":
          "isEnabled": true
        "before": {}
      "created": "2023-03-03T19:52:01.628Z"
      "event": "group.request_access_settings.edit"
      "groupId": "8fffffff-1555-4444-b000-b55555555555"
      "userId": "05555555-3333-4ddd-8ccc-755555555555"
    Name: Snyk External Access Allowed By External Parties - Enabled
  - ExpectedResult: true
    Log:
      "content":
        "after": {}
        "before":
          "isEnabled": true
      "created": "2023-03-03T20:52:01.628Z"
      "event": "group.request_access_settings.edit"
      "groupId": "8fffffff-1555-4444-b000-b55555555555"
      "userId": "05555555-3333-4ddd-8ccc-755555555555"
    Name: Snyk External Access Allowed By External Parties - Disabled
  - ExpectedResult: false
    Log:
      "content":
        "addAsOrgAdmin": []
        "addAsOrgCollaborator":
          - "group.name"
        "addAsOrgCustomRole": []
        "addAsOrgRestrictedCollaborator": []
        "removedOrgMemberships": []
        "userPublicId": "05555555-3333-4ddd-8ccc-755555555555"
      "created": "2023-03-15 13:13:13.133"
      "event": "group.sso.membership.sync"
      "groupId": "8fffffff-1555-4444-b000-b55555555555"
    Name: Snyk Group SSO Membership sync
Threshold: 1
