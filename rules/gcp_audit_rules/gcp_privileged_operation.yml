AnalysisType: rule
CreateAlert: false
Description: >-
  Detects privileged operations in GCP that could be part of a privilege escalation
  attempt, especially when following tag binding creation.
DisplayName: "GCP Privileged Operation"
Enabled: true
Filename: gcp_privileged_operation.py
LogTypes:
  - GCP.AuditLog
RuleID: "GCP.Privileged.Operation"
Runbook: >-
  Check if the user has legitimate business need for this privileged operation. If
  unauthorized, revoke any recently created tag bindings and review IAM policies.
Severity: Info
Tags:
  - attack.privilege_escalation
  - attack.t1548
  - gcp
  - iam
  - tagbinding
Tests:
  - ExpectedResult: true
    Log:
      "protoPayload":
        "authenticationInfo":
          "principalEmail": "test@example.com"
        "methodName": "compute.instances.setIamPolicy"
        "resourceName": "projects/test-project"
      "resource":
        "labels":
          "project_id": "test-project"
      "timestamp": "2024-01-01T00:00:00Z"
    Name: Privileged Operation
  - ExpectedResult: false
    Log:
      "protoPayload":
        "authenticationInfo":
          "principalEmail": "test@example.com"
        "methodName": "compute.instances.list"
        "resourceName": "projects/test-project"
      "resource":
        "labels":
          "project_id": "test-project"
      "timestamp": "2024-01-01T00:00:00Z"
    Name: Normal Operation
