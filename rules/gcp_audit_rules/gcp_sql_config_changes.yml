AnalysisType: rule
DedupPeriodMinutes: 720
Description: >-
  Monitoring changes to Sql Instance configuration may reduce time to detect and correct
  misconfigurations done on sql server.
DisplayName: "GCP SQL Config Changes"
Enabled: true
Filename: gcp_sql_config_changes.py
LogTypes:
  - GCP.AuditLog
Reference: https://cloud.google.com/sql/docs/mysql/instance-settings
Reports:
  CIS:
    - 2.11
RuleID: "GCP.SQL.ConfigChanges"
Runbook: >-
  Validate the Sql Instance configuration change was safe
Severity: Low
SummaryAttributes:
  - severity
  - p_any_ip_addresses
  - p_any_domain_names
Tags:
  - GCP
  - Database
Tests:
  - ExpectedResult: true
    Log:
      "protoPayload":
        "@type": "type.googleapis.com/google.cloud.audit.AuditLog"
        "authenticationInfo":
          "principalEmail": "user@runpanther.io"
        "methodName": "cloudsql.instances.update"
        "requestMetadata":
          "callerIp": "136.24.229.58"
          "callerSuppliedUserAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4)
            AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36,gzip(gfe)"
          "destinationAttributes": {}
          "requestAttributes":
            "auth": {}
            "time": "2020-05-15T04:28:42.243082428Z"
        "serviceName": "storage.googleapis.com"
        "status": {}
      "resource":
        "labels":
          "location": "asia-northeast2"
          "project_id": "western-verve-123456"
        "type": "sql_instance"
    Name: Sql Instance Change
