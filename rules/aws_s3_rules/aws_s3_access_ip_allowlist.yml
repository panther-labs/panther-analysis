AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  Checks that the remote IP accessing the S3 bucket is in the IP allowlist.
DisplayName: "AWS S3 Access IP Allowlist"
Enabled: false
Filename: aws_s3_access_ip_allowlist.py
LogTypes:
  - AWS.S3ServerAccess
Reference: https://aws.amazon.com/premiumsupport/knowledge-center/block-s3-traffic-vpc-ip/
Reports:
  MITRE ATT&CK:
    - TA0009:T1530
RuleID: "AWS.S3.ServerAccess.IPWhitelist"
Runbook: >-
  Verify whether unapproved access of S3 objects occurred, and take appropriate steps
  to remediate damage (for example, informing related parties of unapproved access
  and potentially invalidating data that was accessed). Consider updating the access
  policies of the S3 bucket to prevent future unapproved access.
Severity: Medium
SummaryAttributes:
  - bucket
  - key
  - remoteip
Tags:
  - AWS
  - Configuration Required
  - Identity & Access Management
  - Collection:Data From Cloud Storage Object
Tests:
  - ExpectedResult: false
    Log:
      "bucket": "my-test-bucket"
      "remoteip": "10.0.0.1"
    Name: Access From Approved IP
  - ExpectedResult: true
    Log:
      "bucket": "my-test-bucket"
      "remoteip": "11.0.0.1"
    Name: Access From Unapproved IP
  - ExpectedResult: true
    Log:
      "bucket": "my-test-bucket"
      "remoteip": "2600:1ffe:8140::a47:a85a"
    Name: Access From IPv6
