AnalysisType: rule
Description: >-
  This detection monitors for any pod creation or modification using the host PID
  namespace. The Host PID namespace enables a pod and its containers to have direct
  access and share the same view as of the hostâ€™s processes. This can offer a powerful
  escape hatch to the underlying host.
DisplayName: "GCP K8s Pod Using Host PID Namespace"
Enabled: true
Filename: gcp_k8s_pod_using_host_pid_namespace.py
LogTypes:
  - GCP.AuditLog
Reference: 
  https://medium.com/snowflake/from-logs-to-detection-using-snowflake-and-panther-to-detect-k8s-threats-d72f70a504d7
Reports:
  MITRE ATT&CK:
    - TA0004:T1611
    - TA0002:T1610
RuleID: "GCP.K8s.Pod.Using.Host.PID.Namespace"
Runbook: >-
  Investigate a reason of creating a pod using the host PID namespace. Advise that
  it is discouraged practice. Create ticket if appropriate.
Severity: Medium
Tags:
  - GCP
  - Optional
Tests:
  - ExpectedResult: true
    Log:
      "authorizationInfo":
        - "granted": true
          "permission": "io.k8s.core.v1.pods.create"
          "resource": "core/v1/namespaces/default/pods/nginx-test"
      "protoPayload":
        "methodName": "io.k8s.core.v1.pods.create"
        "request":
          "spec":
            "hostPID": true
    Name: triggers
  - ExpectedResult: false
    Log:
      "authorizationInfo":
        - "granted": true
          "permission": "io.k8s.core.v1.pods.create"
          "resource": "core/v1/namespaces/default/pods/nginx-test"
      "protoPayload":
        "methodName": "io.k8s.core.v1.pods.create"
        "request":
          "spec":
            "hostPID": false
    Name: ignore
