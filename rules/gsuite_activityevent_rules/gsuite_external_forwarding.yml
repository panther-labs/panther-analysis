AnalysisType: rule
Description: >-
  A user has configured mail forwarding to an external domain
DisplayName: "Gsuite Mail forwarded to external domain"
Enabled: true
Filename: gsuite_external_forwarding.py
LogTypes:
  - GSuite.ActivityEvent
Reference: https://support.google.com/mail/answer/10957?hl=en&sjid=864417124752637253-EU
Reports:
  MITRE ATT&CK:
    - TA0009:T1114
RuleID: "GSuite.ExternalMailForwarding"
Runbook: >-
  Follow up with user to remove this forwarding rule if not allowed.
Severity: Medium
SummaryAttributes:
  - p_any_emails
Tags:
  - GSuite
  - Collection:Email Collection
Tests:
  - ExpectedResult: true
    Log:
      "actor":
        "email": "homer.simpson@.springfield.io"
      "id":
        "applicationName": "user_accounts"
        "customerId": "D12345"
      "name": "email_forwarding_out_of_domain"
      "parameters":
        "email_forwarding_destination_address": "HSimpson@gmail.com"
      "type": "email_forwarding_change"
    Name: Forwarding to External Address - applicationName = user_accounts
  - ExpectedResult: true
    Log:
      "actor":
        "email": "homer.simpson@springfield.io"
      "id":
        "applicationName": "login"
        "customerId": "D12345"
      "name": "email_forwarding_out_of_domain"
      "parameters":
        "email_forwarding_destination_address": "HSimpsone@gmail.com"
      "type": "email_forwarding_change"
    Name: Forwarding to External Address - applicationName = login
  - ExpectedResult: false
    Log:
      "actor":
        "email": "homer.simpson@.springfield.io"
      "id":
        "applicationName": "user_accounts"
        "customerId": "D12345"
      "name": "2sv_enroll"
      "type": "2sv_change"
    Name: Non Forwarding Event
  - ExpectedResult: false
    Log:
      "actor":
        "email": "user@example.io"
        "profileId": "118111111111111111111"
      "id":
        "applicationName": "drive"
        "customerId": "D12345"
        "time": "2022-12-20 17:27:47.080000000"
        "uniqueQualifier": "-7312729053723258069"
      "ipAddress": "12.12.12.12"
      "kind": "admin#reports#activity"
      "name": "rename"
      "parameters":
        "actor_is_collaborator_account":
        "billable": true
        "doc_id": "1GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG"
        "doc_title": "Document Title- Found Here"
        "doc_type": "presentation"
        "is_encrypted":
        "new_value":
          - "Document Title- Found Here"
        "old_value":
          - "Document Title- Old"
        "owner": "user@example.io"
        "owner_is_shared_drive":
        "owner_is_team_drive":
        "primary_event": true
        "visibility": "private"
      "type": "access"
    Name: ListObject Type
