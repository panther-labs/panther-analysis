AnalysisType: rule
Description: >-
  Someone failed to unlock a user's device multiple times in quick succession.
DisplayName: "GSuite User Device Unlock Failures"
Enabled: true
Filename: gsuite_mobile_device_screen_unlock_fail.py
LogTypes:
  - GSuite.ActivityEvent
Reference: https://support.google.com/a/answer/6350074?hl=en
Reports:
  MITRE ATT&CK:
    - TA0006:T1110
RuleID: "GSuite.DeviceUnlockFailure"
Runbook: >-
  Verify that these unlock attempts came from the user, and not a malicious actor
  which has acquired the user's device.
Severity: Medium
SummaryAttributes:
  - actor:email
Tags:
  - GSuite
  - Credential Access:Brute Force
Tests:
  - ExpectedResult: false
    Log:
      "actor":
        "callerType": "USER"
        "email": "homer.simpson@example.io"
      "id":
        "applicationName": "mobile"
      "name": "DEVICE_SYNC_EVENT"
      "parameters":
        "USER_EMAIL": "homer.simpson@example.io"
      "type": "device_updates"
    Name: Normal Mobile Event
  - ExpectedResult: false
    Log:
      "actor":
        "callerType": "USER"
        "email": "homer.simpson@example.io"
      "id":
        "applicationName": "mobile"
      "name": "FAILED_PASSWORD_ATTEMPTS_EVENT"
      "parameters":
        "FAILED_PASSWD_ATTEMPTS": 2
        "USER_EMAIL": "homer.simpson@example.io"
      "type": "device_updates"
    Name: Small Number of Failed Logins
  - ExpectedResult: true
    Log:
      "actor":
        "callerType": "USER"
        "email": "homer.simpson@example.io"
      "id":
        "applicationName": "mobile"
      "name": "FAILED_PASSWORD_ATTEMPTS_EVENT"
      "parameters":
        "FAILED_PASSWD_ATTEMPTS": 100
        "USER_EMAIL": "homer.simpson@example.io"
      "type": "device_updates"
    Name: Multiple Failed Login Attempts with int Type
  - ExpectedResult: true
    Log:
      "actor":
        "callerType": "USER"
        "email": "homer.simpson@example.io"
      "id":
        "applicationName": "mobile"
      "name": "FAILED_PASSWORD_ATTEMPTS_EVENT"
      "parameters":
        "FAILED_PASSWD_ATTEMPTS": "100"
        "USER_EMAIL": "homer.simpson@example.io"
      "type": "device_updates"
    Name: Multiple Failed Login Attempts with String Type
