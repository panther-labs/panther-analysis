AnalysisType: rule
DedupPeriodMinutes: 60
Description: >-
  A user created a new API token to be used with Zendesk.
DisplayName: "Zendesk API Token Created"
Enabled: true
Filename: zendesk_new_api_token.py
LogTypes:
  - Zendesk.Audit
Reference: 
  https://support.zendesk.com/hc/en-us/articles/4408889192858-Managing-access-to-the-Zendesk-API#topic_bsw_lfg_mmb:~:text=enable%20token%20access.-,Generating%20API%20tokens,-To%20generate%20an
Reports:
  MITRE ATT&CK:
    - TA0006:T1528
RuleID: "Zendesk.NewAPIToken"
Runbook: >-
  Validate the api token was created for valid use case, otherwise delete the token
  immediately.
Severity: High
SummaryAttributes:
  - p_any_ip_addresses
Tags:
  - Zendesk
  - Credential Access:Steal Application Access Token
Tests:
  - ExpectedResult: false
    Log:
      "action": "update"
      "action_label": "Updated"
      "actor_id": 123
      "actor_name": "John Doe"
      "change_description": "description changed from not set to a new description"
      "created_at": "2021-05-28T18:39:50Z"
      "id": 123456789123
      "ip_address": "127.0.0.1"
      "p_log_type": "Zendesk.Audit"
      "source_id": 123
      "source_label": "API token: a new description"
      "source_type": "api_token"
      "url": "https://myzendek.zendesk.com/api/v2/audit_logs/111222333444.json"
    Name: Zendesk - API Token Updated
  - ExpectedResult: true
    Log:
      "action": "create"
      "action_label": "Created"
      "actor_id": 123
      "actor_name": "John Doe"
      "change_description": ""
      "created_at": "2021-05-28T18:39:50Z"
      "id": 123456789123
      "ip_address": "127.0.0.1"
      "p_log_type": "Zendesk.Audit"
      "source_id": 123
      "source_label": "API token"
      "source_type": "api_token"
      "url": "https://myzendek.zendesk.com/api/v2/audit_logs/111222333444.json"
    Name: Zendesk - API Token Created
