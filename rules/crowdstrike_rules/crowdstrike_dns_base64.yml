AnalysisType: rule
DisplayName: "Crowdstrike DNS Base64 Query"
RuleID: "Crowdstrike.FDR.LOLBAS"
Enabled: false
Filename: crowdstrike_dns_base64.py
Severity: Medium
DedupPeriodMinutes: 60
Threshold: 1
LogTypes:
    - Crowdstrike.FDREvent
Tests:
  -
    Name: AWS VPC DNS (Positive)
    ExpectedResult: true
    Log:
        {
            "account_id": "123456789012",
            "answers": [
                {
                    "Class": "IN",
                    "Rdata": "172.31.46.187",
                    "Type": "A"
                }
            ],
            "p_log_type": "AWS.VPCDns",
            "query_class": "IN",
            "query_name": "AQAAAAAAAAA5MAoAAAAAAA==.file1.16s.us",
            "query_timestamp": "2023-04-11 01:29:20",
            "query_type": "A",
            "rcode": "NOERROR",
            "region": "us-west-2",
            "srcaddr": "172.31.46.187",
            "srcids": {
                "instance": "i-09d9aa4e31675db61"
            },
            "srcport": "36899",
            "transport": "UDP",
            "version": "1.100000",
            "vpc_id": "vpc-c26c48ba"
        }
  -
    Name: AWS VPS DNS (Negative)
    ExpectedResult: false
    Log:
        {
            "account_id": "123456789012",
            "answers": [
                {
                    "Class": "IN",
                    "Rdata": "172.31.46.187",
                    "Type": "A"
                }
            ],
            "p_log_type": "AWS.VPCDns",
            "query_class": "IN",
            "query_name": "google.com",
            "query_timestamp": "2023-04-11 01:29:20",
            "query_type": "A",
            "rcode": "NOERROR",
            "region": "us-west-2",
            "srcaddr": "172.31.46.187",
            "srcids": {
                "instance": "i-09d9aa4e31675db61"
            },
            "srcport": "36899",
            "transport": "UDP",
            "version": "1.100000",
            "vpc_id": "vpc-c26c48ba"
        }


  -
    Name: AWS VPS DNS subdomain (Negative)
    ExpectedResult: false
        {
	"account_id": "123456789012",
	"answers": [
		{
			"Class": "IN",
			"Rdata": "172.31.46.187",
			"Type": "A"
		}
	],
	"p_log_type": "AWS.VPCDns",
	"query_class": "IN",
	"query_name": "=.google.com",
	"query_timestamp": "2023-04-11 01:29:20",
	"query_type": "A",
	"rcode": "NOERROR",
	"region": "us-west-2",
	"srcaddr": "172.31.46.187",
	"srcids": {
		"instance": "i-09d9aa4e31675db61"
	},
	"srcport": "36899",
	"transport": "UDP",
	"version": "1.100000",
	"vpc_id": "vpc-c26c48ba"
}