AnalysisType: correlation_rule
Description: >-
  Detects when a user account is created and deleted within 12 hours. This aims to
  detect ephemeral user accounts infiltrators might use to avoid suspicion.
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 1
    Sequence:
      - ID: AccountCreated
        RuleID: Crowdstrike.NewUserCreated
      - ID: AccountDeleted
        RuleID: Crowdstrike.UserDeleted
    Transitions:
      - From: AccountCreated
        ID: User Created FOLLOWED BY User Deleted
        Match:
          - On: p_alert_context.target_name
        To: AccountDeleted
        WithinTimeFrameMinutes: 720
DisplayName: "Crowdstrike Ephemeral User Account"
Enabled: true
Reference: ''
Reports:
  MITRE ATT&CK:
    - TA0003:T1136.003
    - TA0005:T1070
RuleID: "Crowdstrike.EphemeralUserAccount"
Severity: High
Tests:
  - ExpectedResult: true
    Name: User Creation, Followed By Deletion
    RuleOutputs:
      - ID: AccountCreated
        Matches:
          p_alert_context.target_name:
            non.chalant@legitbiz.com:
              - 0
      - ID: AccountDeleted
        Matches:
          p_alert_context.target_name:
            non.chalant@legitbiz.com:
              - 640
  - ExpectedResult: false
    Name: User Creation, Not Followed By Deletion
    RuleOutputs:
      - ID: AccountCreated
        Matches:
          p_alert_context.target_name:
            non.chalant@legitbiz.com:
              - 0
  - ExpectedResult: false
    Name: User Deletion, Not Preceded By Creation
    RuleOutputs:
      - ID: AccountDeleted
        Matches:
          p_alert_context.target_name:
            non.chalant@legitbiz.com:
              - 120
