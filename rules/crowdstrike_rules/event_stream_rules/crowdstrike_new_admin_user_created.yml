AnalysisType: correlation_rule
Description: >-
  Detects when a user account is created and assigned admin permissions
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 1
    Sequence:
      - ID: AccountCreated
        RuleID: Crowdstrike.NewUserCreated
      - ID: AdminRoleAssigned
        RuleID: Crowdstrike.AdminRoleAssigned
    Transitions:
      - From: AccountCreated
        ID: AcountCreated FOLLOWED BY AdminRoleAssigned ON target AND actor
        Match:
          - On: p_alert_context.actor_target
        To: AdminRoleAssigned
        WithinTimeFrameMinutes: 45
DisplayName: "Crowdstrike New Admin User Created"
Enabled: true
Reports:
  MITRE ATT&CK:
    - TA0003:T1136.003
    - TA0003:T1098.003
    - TA0004:T1098.003
RuleID: "Crowdstrike.NewAdminUserCreated"
Severity: High
Tests:
  - ExpectedResult: true
    Name: User Creation, Followed By Role Assignment
    RuleOutputs:
      - ID: AccountCreated
        Matches:
          p_alert_context.actor_target:
            newuser@biz.co-hackerman@biz.co:
              - 0
      - ID: AdminRoleAssigned
        Matches:
          p_alert_context.actor_target:
            newuser@biz.co-hackerman@biz.co:
              - 15
  - ExpectedResult: false
    Name: User Creation, Not Followed By Role Assignment
    RuleOutputs:
      - ID: AccountCreated
        Matches:
          p_alert_context.actor_target:
            newuser@biz.co-hackerman@biz.co:
              - 0
  - ExpectedResult: false
    Name: Role Assignment Not Preceded By User Creation
    RuleOutputs:
      - ID: AdminRoleAssigned
        Matches:
          p_alert_context.actor_target:
            newuser@biz.co-hackerman@biz.co:
              - 20
