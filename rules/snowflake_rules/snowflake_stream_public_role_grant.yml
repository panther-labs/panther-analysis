AnalysisType: rule
Description: >-
  Detect additional grants to the public role.
DisplayName: "Snowflake Grant to Public Role"
Enabled: true
Filename: snowflake_stream_public_role_grant.py
LogTypes:
  - Snowflake.GrantsToRoles
Reports:
  MITRE ATT&CK:
    - TA0004:T1078.001
RuleID: "Snowflake.Stream.PublicRoleGrant"
Runbook: >-
  Determine if this is a necessary grant for the public role, which should be kept
  to the fewest possible.
Severity: Medium
Tags:
  - Snowflake
  - '[MITRE] Privilege Escalation'
  - '[MITRE] Valid Accounts'
  - '[MITRE] Valid Accounts: Default Accounts'
Tests:
  - ExpectedResult: true
    Log:
      "CREATED_ON": "2024-10-10 12:56:35.822 -0700"
      "DELETED_ON": ""
      "GRANTED_BY": "ACCOUNTADMIN"
      "GRANTED_BY_ROLE_TYPE": "ROLE"
      "GRANTED_ON": "TABLE"
      "GRANTED_TO": "ROLE"
      "GRANTEE_NAME": "PUBLIC"
      "GRANT_OPTION": false
      "MODIFIED_ON": "2024-10-10 12:56:35.822 -0700"
      "NAME": "MYTABLE"
      "OBJECT_INSTANCE": ""
      "PRIVILEGE": "SELECT"
      "TABLE_CATALOG": "TEST_DB"
      "TABLE_SCHEMA": "PUBLIC"
      "p_source_label": "DailyPlanet-Snowflake"
    Name: SELECT Granted to Public
  - ExpectedResult: false
    Log:
      "CREATED_ON": "2024-10-10 12:56:35.822 -0700"
      "DELETED_ON": ""
      "GRANTED_BY": "ACCOUNTADMIN"
      "GRANTED_BY_ROLE_TYPE": "ROLE"
      "GRANTED_ON": "TABLE"
      "GRANTED_TO": "ROLE"
      "GRANTEE_NAME": "APP_READONLY"
      "GRANT_OPTION": false
      "MODIFIED_ON": "2024-10-10 12:56:35.822 -0700"
      "NAME": "MYTABLE"
      "OBJECT_INSTANCE": ""
      "PRIVILEGE": "SELECT"
      "TABLE_CATALOG": "TEST_DB"
      "TABLE_SCHEMA": "PUBLIC"
      "p_source_label": "DailyPlanet-Snowflake"
    Name: Privilege Granted to Non-PUBLIC Role
