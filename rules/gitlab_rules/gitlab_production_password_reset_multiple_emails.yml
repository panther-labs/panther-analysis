AnalysisType: rule
Description: >-
  Attackers are exploiting a Critical (CVSS 10.0) GitLab vulnerability in which user
  account password reset emails could be delivered to an unverified email address.
DisplayName: "CVE-2023-7028 - GitLab Production Password Reset Multiple Emails"
Enabled: true
Filename: gitlab_production_password_reset_multiple_emails.py
LogTypes:
  - GitLab.Production
Reference: 
  https://about.gitlab.com/releases/2024/01/11/critical-security-release-gitlab-16-7-2-released/
Reports:
  MITRE ATT&CK:
    - TA0001:T1195
    - TA0001:T1190
    - TA0003:T1098
RuleID: "GitLab.Production.Password.Reset.Multiple.Emails"
Severity: High
Tags:
  - GitLab
  - CVE-2023-7028
  - No Pack
Tests:
  - ExpectedResult: false
    Log:
      "params":
        - "key": "authenticity_token"
          "value": "[FILTERED]"
        - "key": "user"
          "value":
            "email":
              - "peter@example.com"
              - "bob@example.com"
      "path": "/cats"
    Name: not a password reset
  - ExpectedResult: false
    Log:
      "params":
        - "key": "authenticity_token"
          "value": "[FILTERED]"
        - "key": "user"
          "value":
            "email":
              - "bob@example.com"
      "path": "/users/password"
    Name: one email
  - ExpectedResult: true
    Log:
      "params":
        - "key": "authenticity_token"
          "value": "[FILTERED]"
        - "key": "user"
          "value":
            "email":
              - "peter@example.com"
              - "bob@example.com"
      "path": "/users/password"
    Name: multiple emails
