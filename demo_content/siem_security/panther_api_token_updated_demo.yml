AnalysisType: rule
Filename: panther_api_token_updated_demo.py
RuleID: "Panther.APIToken.Updated.Demo"
DisplayName: Panther API Token Updated
Enabled: true
LogTypes:
  - Panther.Audit
Severity: Low
DedupPeriodMinutes: 1440
InlineFilters:
  - KeyPath: actionResult
    Condition: Equals
    Value: SUCCEEDED
Tags:
  - demo
  - compliance.soc2
  - usecase.configuration_management
  - asset.api_credentials
  - risk.medium
Description: >
  Detects when an API token is updated in Panther. This can help monitor changes to API tokens for auditing and security purposes.
Runbook: |
  1. Review the user and context of the API token update.
  2. Confirm the update was expected and authorized.
  3. If unexpected, rotate the token and investigate further.
Reference: https://docs.panther.com/data-onboarding/supported-logs/panther-audit
SummaryAttributes:
  - token_name
  - token_id
  - user
  - source_ip
  - timestamp
Tests:
  - Name: API Token Updated
    ExpectedResult: true
    Log:
      {
        "actionName": "UPDATE_API_TOKEN",
        "actionResult": "SUCCEEDED",
        "actor": {
          "id": "api_key_abc123",
          "name": "automation-key",
          "type": "TOKEN"
        },
        "sourceIP": "1.2.3.4",
        "timestamp": "2024-06-01T12:00:00Z",
        "actionParams": {"input": {"description": "Token rotated"}},
        "p_log_type": "Panther.Audit"
      }
  - Name: Not an API Token Update
    ExpectedResult: false
    Log:
      {
        "actionName": "LOGIN",
        "actionResult": "SUCCEEDED",
        "actor": {
          "id": "user_123",
          "name": "jane@example.com",
          "type": "USER"
        },
        "sourceIP": "1.2.3.4",
        "timestamp": "2024-06-01T12:00:00Z",
        "p_log_type": "Panther.Audit"
      }