AnalysisType: policy
Description: >-
  This policy ensures that AMIs you have created are not configured to allow public
  access, which could result in accidental data loss. AMI's that you use but do not
  own are not evaluated by this policy.
DisplayName: "AWS AMI Sharing"
Enabled: true
Filename: aws_ami_private.py
PolicyID: "AWS.AMI.Private"
Reference: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharing-amis.html
Reports:
  MITRE ATT&CK:
    - TA0010:T1537
ResourceTypes:
  - AWS.EC2.AMI
Runbook: >-
  Immediately remove public access from the AMI until you can determine whether that
  setting is intentional
Severity: High
Tags:
  - AWS
  - Panther
  - Panther Enterprise
  - Exfiltration:Transfer Data to Cloud Account
Tests:
  - ExpectedResult: true
    Name: Private AMI
    Resource:
      "ARN": "arn:aws:ec2:us-west-2:123456789012:image/ami-abc234"
      "AccountId": "123456789012"
      "Architecture": "x86_64"
      "BlockDeviceMappings": []
      "Description":
      "EnaSupport":
      "Hypervisor": "xen"
      "ID": "ami-abc234"
      "ImageId": "ami-abc234"
      "ImageLocation": "ubuntu-us-west-2/kernels/ubuntu.xml"
      "ImageOwnerAlias":
      "ImageType": "ramdisk"
      "KernelId":
      "Name": "ubuntu/image"
      "OwnerId": "123456789012"
      "Platform":
      "ProductCodes":
      "Public": false
      "RamdiskId":
      "Region": "us-west-2"
      "ResourceID": "arn:aws:ec2:us-west-2:123456789012:image/ami-abc234"
      "ResourceType": "AWS.EC2.AMI"
      "RootDeviceName":
      "RootDeviceType": "instance-store"
      "SriovNetSupport":
      "State": "available"
      "StateReason":
      "Tags": {}
      "TimeCreated": "2011-11-04T12:34:17.000Z"
      "VirtualizationType": "paravirtual"
  - ExpectedResult: false
    Name: Public AMI
    Resource:
      "ARN": "arn:aws:ec2:us-west-2:123456789012:image/ami-abc234"
      "AccountId": "123456789012"
      "Architecture": "x86_64"
      "BlockDeviceMappings": []
      "Description":
      "EnaSupport":
      "Hypervisor": "xen"
      "ID": "ami-abc234"
      "ImageId": "ami-abc234"
      "ImageLocation": "ubuntu-us-west-2/kernels/ubuntu.xml"
      "ImageOwnerAlias":
      "ImageType": "ramdisk"
      "KernelId":
      "Name": "ubuntu/image"
      "OwnerId": "123456789012"
      "Platform":
      "ProductCodes":
      "Public": true
      "RamdiskId":
      "Region": "us-west-2"
      "ResourceID": "arn:aws:ec2:us-west-2:123456789012:image/ami-abc234"
      "ResourceType": "AWS.EC2.AMI"
      "RootDeviceName":
      "RootDeviceType": "instance-store"
      "SriovNetSupport":
      "State": "available"
      "StateReason":
      "Tags": {}
      "TimeCreated": "2011-11-04T12:34:17.000Z"
      "VirtualizationType": "paravirtual"
