AnalysisType: policy
Description: >-
  Ensure that all GuardDuty logs are sending into a single Master account. This is
  a best practice for centralizing detection logic and useful data during an investigation.
DisplayName: "AWS GuardDuty Master Account"
Enabled: false
Filename: aws_guardduty_master_account.py
PolicyID: "AWS.GuardDuty.MasterAccount"
Reference: https://aws.amazon.com/guardduty/
Reports:
  MITRE ATT&CK:
    - TA0005:T1562
ResourceTypes:
  - AWS.GuardDuty.Detector
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-guardduty-is-logging-to-a-master-account
Severity: High
Tags:
  - AWS
  - Configuration Required
  - Security Control
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: true
    Name: Detector Not Logging to Master
    Resource:
      "AccountId": "123456789012"
      "FindingPublishingFrequency": "SIX_HOURS"
      "Id": "12a12345b12345c12ab12a1a1ab1a1ab1"
      "Master":
      "Region": "eu-central-1"
      "ResourceId": "123456789012:eu-central-1:AWS.GuardDuty.Detector"
      "ResourceType": "AWS.GuardDuty.Detector"
      "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/guardduty.amazonaws.com/AWSServiceRoleForAmazonGuardDuty"
      "Status": "ENABLED"
      "Tags":
        "KeyName1": "Value1"
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UpdatedAt": "2019-01-01T00:00:00.000Z"
  - ExpectedResult: true
    Name: Detector Logging to Master
    Resource:
      "AccountId": "123456789012"
      "FindingPublishingFrequency": "SIX_HOURS"
      "Id": "12a12345b12345c12ab12a1a1ab1a1ab1"
      "Master":
        "AccountId": "123456789012"
        "InvitationId": "11111111111111"
        "InvitedAt": "2019"
        "RelationshipStatus": "active"
      "Region": "eu-central-1"
      "ResourceId": "123456789012:eu-central-1:AWS.GuardDuty.Detector"
      "ResourceType": "AWS.GuardDuty.Detector"
      "ServiceRole": "arn:aws:iam::123456789012:role/aws-service-role/guardduty.amazonaws.com/AWSServiceRoleForAmazonGuardDuty"
      "Status": "ENABLED"
      "Tags":
        "KeyName1": "Value1"
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UpdatedAt": "2019-01-01T00:00:00.000Z"
