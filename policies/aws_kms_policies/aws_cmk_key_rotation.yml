AnalysisType: policy
Description: >-
  This policy validates that customer master keys (CMKs) have automatic key rotation
  enabled.
DisplayName: "AWS KMS CMK Key Rotation"
Enabled: true
Filename: aws_cmk_key_rotation.py
PolicyID: "AWS.CMK.KeyRotation"
Reference: https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html
Reports:
  CIS:
    - 2.8
  MITRE ATT&CK:
    - TA0006:T1552
  PCI:
    - 3.5.2
ResourceTypes:
  - AWS.KMS.Key
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-customer-created-cmk-has-key-rotation-enabled
Severity: Low
Tags:
  - AWS
  - Identity & Access Management
  - Credential Access:Unsecured Credentials
Tests:
  - ExpectedResult: true
    Name: Key Managed By AWS
    Resource:
      "AccountId": "1122334455"
      "Arn": "arn:aws:kms:us-west-2:11223344:key/1122233-asdf-adsf-111222333"
      "CloudHsmClusterId":
      "CreationDate": "2019-01-01T00:00:00Z"
      "CustomKeyStoreId":
      "DeletionDate":
      "Description": "Default master key that protects my Secrets Manager data when
        no other key is defined"
      "Enabled": false
      "ExpirationModel":
      "KeyId": "1122233-asdf-adsf-111222333"
      "KeyManager": "AWS"
      "KeyRotationEnabled": true
      "KeyState": "Enabled"
      "KeyUsage": "ENCRYPT_DECRYPT"
      "Origin": "AWS_KMS"
      "Policy": "{JSON policy document see https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html
        for details}"
      "ValidTo":
  - ExpectedResult: true
    Name: Key Rotation Enabled
    Resource:
      "AccountId": "1122334455"
      "Arn": "arn:aws:kms:us-west-2:11223344:key/1122233-asdf-adsf-111222333"
      "CloudHsmClusterId":
      "CreationDate": "2019-01-01T00:00:00Z"
      "CustomKeyStoreId":
      "DeletionDate":
      "Description": "Default master key that protects my Secrets Manager data when
        no other key is defined"
      "Enabled": true
      "ExpirationModel":
      "KeyId": "1122233-asdf-adsf-111222333"
      "KeyManager": "CUSTOMER"
      "KeyRotationEnabled": true
      "KeyState": "Enabled"
      "KeyUsage": "ENCRYPT_DECRYPT"
      "Origin": "AWS_KMS"
      "Policy": "{JSON policy document see https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html
        for details}"
      "ValidTo":
  - ExpectedResult: false
    Name: Key Rotation Never Set
    Resource:
      "AccountId": "1122334455"
      "Arn": "arn:aws:kms:us-west-2:11223344:key/1122233-asdf-adsf-111222333"
      "CloudHsmClusterId":
      "CreationDate": "2019-01-01T00:00:00Z"
      "CustomKeyStoreId":
      "DeletionDate":
      "Description": "Default master key that protects my Secrets Manager data when
        no other key is defined"
      "Enabled": false
      "ExpirationModel":
      "KeyId": "1122233-asdf-adsf-111222333"
      "KeyManager": "CUSTOMER"
      "KeyRotationEnabled":
      "KeyState": "Enabled"
      "KeyUsage": "ENCRYPT_DECRYPT"
      "Origin": "AWS_KMS"
      "Policy": "{JSON policy document see https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html
        for details}"
      "ValidTo":
  - ExpectedResult: false
    Name: Key Rotation Not Enabled
    Resource:
      "AccountId": "1122334455"
      "Arn": "arn:aws:kms:us-west-2:11223344:key/1122233-asdf-adsf-111222333"
      "CloudHsmClusterId":
      "CreationDate": "2019-01-01T00:00:00Z"
      "CustomKeyStoreId":
      "DeletionDate":
      "Description": "Default master key that protects my Secrets Manager data when
        no other key is defined"
      "Enabled": false
      "ExpirationModel":
      "KeyId": "1122233-asdf-adsf-111222333"
      "KeyManager": "CUSTOMER"
      "KeyRotationEnabled": false
      "KeyState": "Enabled"
      "KeyUsage": "ENCRYPT_DECRYPT"
      "Origin": "AWS_KMS"
      "Policy": "{JSON policy document see https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html
        for details}"
      "ValidTo":
  - ExpectedResult: true
    Name: Key Not Eligible for Rotation
    Resource:
      "AccountId": "1122334455"
      "Arn": "arn:aws:kms:us-west-2:11223344:key/1122233-asdf-adsf-111222333"
      "CloudHsmClusterId":
      "CreationDate": "2019-01-01T00:00:00Z"
      "CustomKeyStoreId":
      "DeletionDate":
      "Description": "Default master key that protects my Secrets Manager data when
        no other key is defined"
      "Enabled": false
      "ExpirationModel":
      "KeyId": "1122233-asdf-adsf-111222333"
      "KeyManager": "AWS"
      "KeyRotationEnabled":
      "KeyState": "Enabled"
      "KeyUsage": "ENCRYPT_DECRYPT"
      "Origin": "External"
      "Policy": "{JSON policy document see https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html
        for details}"
      "ValidTo":
