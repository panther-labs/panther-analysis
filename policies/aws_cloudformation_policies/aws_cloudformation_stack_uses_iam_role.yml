AnalysisType: policy
Description: >-
  Associating IAM roles with CloudFormation stacks ensures least privilege when making
  changes to your account.
DisplayName: "AWS CloudFormation Stack IAM Service Role"
Enabled: true
Filename: aws_cloudformation_stack_uses_iam_role.py
PolicyID: "AWS.CloudFormation.Stack.UsesIAMServiceRole"
Reference: https://amzn.to/2HAdfny
ResourceTypes:
  - AWS.CloudFormation.Stack
Runbook: >-
  Create a new IAM role to be assumable by the cloudformation service, and then update
  the current stack with the --role-arn argument.
Severity: Info
Tags:
  - AWS
  - Operations
  - Panther
Tests:
  - ExpectedResult: true
    Name: IAM Service Role Attached
    Resource:
      "ARN": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "AccountId": "123456789012"
      "Capabilities":
        - "CAPABILITY_NAMED_IAM"
      "ChangeSetId":
      "DeletionTime":
      "Description": "IAM role stack"
      "DisableRollback": false
      "DriftInformation":
        "LastCheckTimestamp": "2019-01-01T00:00:00Z"
        "StackDriftStatus": "IN-SYNC"
      "Drifts": []
      "EnableTerminationProtection":
      "ID": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "LastUpdatedTime": "2019-01-01T00:00:00Z"
      "Name": "iam-roles"
      "NotificationARNs": []
      "Outputs":
      "Parameters":
        - "ParameterKey": "MaxSessionDurationSec"
          "ParameterValue": "10000"
          "ResolvedValue":
          "UsePreviousValue":
        - "ParameterKey": "Prefix"
          "ParameterValue": "Dev"
          "ResolvedValue":
          "UsePreviousValue":
      "ParentId":
      "Region": "us-west-2"
      "ResourceID": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "ResourceType": "AWS.CloudFormation.Stack"
      "RoleARN": "arn:aws:iam::123456789012:role/CFNServiceRole"
      "RollbackConfiguration":
        "MonitoringTimeInMinutes":
        "RollbackTriggers": []
      "RootId":
      "StackId": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "StackStatus": "UPDATE_COMPLETE"
      "StackStatusReason":
      "Tags": {}
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "TimeoutInMinutes":
  - ExpectedResult: false
    Name: No Service Role Provided
    Resource:
      "ARN": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "AccountId": "123456789012"
      "Capabilities":
        - "CAPABILITY_NAMED_IAM"
      "ChangeSetId":
      "DeletionTime":
      "Description": "IAM role stack"
      "DisableRollback": false
      "DriftInformation":
        "LastCheckTimestamp": "2019-01-01T00:00:00Z"
        "StackDriftStatus": "IN-SYNC"
      "Drifts": []
      "EnableTerminationProtection":
      "ID": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "LastUpdatedTime": "2019-01-01T00:00:00Z"
      "Name": "iam-roles"
      "NotificationARNs": []
      "Outputs":
      "Parameters":
        - "ParameterKey": "MaxSessionDurationSec"
          "ParameterValue": "10000"
          "ResolvedValue":
          "UsePreviousValue":
        - "ParameterKey": "Prefix"
          "ParameterValue": "Dev"
          "ResolvedValue":
          "UsePreviousValue":
      "ParentId":
      "Region": "us-west-2"
      "ResourceID": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "ResourceType": "AWS.CloudFormation.Stack"
      "RoleARN":
      "RollbackConfiguration":
        "MonitoringTimeInMinutes":
        "RollbackTriggers": []
      "RootId":
      "StackId": "arn:aws:cloudformation:us-west-2:123456789012:stack/iam-roles/1"
      "StackStatus": "UPDATE_COMPLETE"
      "StackStatusReason":
      "Tags": {}
      "TimeCreated": "2019-01-01T17:16:30.000Z"
      "TimeoutInMinutes":
  - ExpectedResult: true
    Name: No Service Role Provided But Stack Is StackSet
    Resource:
      "ARN": "arn:aws:cloudformation:us-west-2:123456789012:stack/StackSet-iam-roles/1"
      "AccountId": "123456789012"
      "Capabilities":
        - "CAPABILITY_NAMED_IAM"
      "ChangeSetId":
      "DeletionTime":
      "Description": "IAM role stack set"
      "DisableRollback": false
      "DriftInformation":
        "LastCheckTimestamp": "2019-01-01T00:00:00Z"
        "StackDriftStatus": "IN-SYNC"
      "Drifts": []
      "EnableTerminationProtection":
      "ID": "arn:aws:cloudformation:us-west-2:123456789012:stack/StackSet-iam-roles/1"
      "LastUpdatedTime": "2019-01-01T00:00:00Z"
      "Name": "StackSet-iam-roles"
      "NotificationARNs": []
      "Outputs":
      "Parameters":
        - "ParameterKey": "MaxSessionDurationSec"
          "ParameterValue": "10000"
          "ResolvedValue":
          "UsePreviousValue":
        - "ParameterKey": "Prefix"
          "ParameterValue": "Dev"
          "ResolvedValue":
          "UsePreviousValue":
      "ParentId":
      "Region": "us-west-2"
      "ResourceID": "arn:aws:cloudformation:us-west-2:123456789012:stack/StackSet-iam-roles/1"
      "ResourceType": "AWS.CloudFormation.Stack"
      "RoleARN":
      "RollbackConfiguration":
        "MonitoringTimeInMinutes":
        "RollbackTriggers": []
      "RootId":
      "StackStatus": "UPDATE_COMPLETE"
      "StackStatusReason":
      "Tags": {}
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "TimeoutInMinutes":
