AnalysisType: policy
Filename: aws_s3_bucket_public_write.py
PolicyID: "AWS.S3.Bucket.PublicWrite"
DisplayName: "AWS S3 Bucket Public Write"
Enabled: true
ResourceTypes:
  - AWS.S3.Bucket
Tags:
  - AWS
  - Data Protection
  - Identity & Access Management
  - Impact:Data Destruction
Reports:
  CIS:
    - S3.8
  PCI:
    - 1.3.1
    - 7.1
    - 7.2.1
  MITRE ATT&CK:
    - TA0040:T1485
Severity: Critical
Description: >
  This policy ensures that S3 buckets are not publicly writeable. Public write access to S3 buckets represents a critical security vulnerability that can lead to multiple attack vectors. Attackers with public write permissions can upload malicious content including malware, ransomware, phishing pages, or illegal content that could implicate your organization. They can delete or overwrite legitimate objects causing data loss or service disruption. Malicious actors can consume storage to generate massive AWS bills through resource exhaustion attacks. Public write access also enables attackers to use your bucket for command and control infrastructure, data staging for other attacks, or cryptocurrency mining operations. Additionally, uploaded malicious files could be served to legitimate users if the bucket hosts a website or application assets, creating supply chain attacks. The S3 bucket could become a vector for malware distribution or be used to host phishing campaigns. This misconfiguration violates security best practices, compliance requirements, and can result in significant financial, reputational, and legal consequences. AWS strongly recommends using S3 Block Public Access settings and restricting bucket access through IAM policies, bucket policies, and ACLs that follow the principle of least privilege.
Runbook: |
  1. Sign in to the AWS Management Console and navigate to the S3 service at https://console.aws.amazon.com/s3, then locate and select the bucket identified in the alert that has public write access enabled
  2. Click on the "Permissions" tab and review the "Access Control List (ACL)" section - look for "Everyone (public access)" or "Authenticated Users" with WRITE, WRITE_ACP, or FULL_CONTROL permissions
  3. Remove public write permissions from the ACL by clicking "Edit" next to any public grantee entries and removing WRITE, WRITE_ACP, and FULL_CONTROL permissions, or delete the entire grant entry for public groups
  4. Review the "Bucket policy" section and check if any policy statements allow s3:PutObject, s3:DeleteObject, s3:PutObjectAcl, or s3:* actions for Principal "*" - edit the bucket policy to remove any statements granting public write access
  5. Enable S3 Block Public Access settings: Click on the "Block Public Access (bucket settings)" section, click "Edit", and enable all four Block Public Access settings
  6. Click "Save changes" and confirm by typing "confirm" when prompted - this will override any ACLs or policies attempting to grant public access
  7. If the bucket needs to be accessed by specific external parties, create IAM roles or users with appropriate permissions and use presigned URLs for temporary access instead of public permissions
  8. Review CloudTrail logs to identify any unauthorized write operations (search for s3:PutObject, s3:DeleteObject, s3:PutObjectAcl events from unfamiliar IP addresses), and if unauthorized content was uploaded, quarantine or delete malicious objects
  9. Enable S3 server access logging and CloudTrail S3 data events for ongoing monitoring of bucket access and modifications
  10. Document this remediation in your security incident log, consider implementing S3 Object Lock or versioning for data immutability, and review how the public write access was granted to prevent recurrence
Reference: https://docs.aws.amazon.com/AmazonS3/latest/dev/using-iam-policies.html
Tests:
  - Name: Bucket Grants READ To All Authenticated Users
    ExpectedResult: true
    Resource:
      {
        "CreationDate": "2019-01-01T00:00:00Z",
        "EncryptionRules":
          [
            {
              "ApplyServerSideEncryptionByDefault":
                { "KMSMasterKeyID": null, "SSEAlgorithm": "AES256" },
            },
          ],
        "Grants":
          [
            {
              "Grantee":
                {
                  "DisplayName": "user.name",
                  "EmailAddress": null,
                  "ID": "11112223334445556667778899aaabbbcccdddeeee",
                  "Type": "CanonicalUser",
                  "URI": "http://acs.amazonaws.com/groups/global/AuthenticatedUsers",
                },
              "Permission": "READ",
            },
            {
              "Grantee":
                {
                  "DisplayName": null,
                  "EmailAddress": null,
                  "ID": null,
                  "Type": "Group",
                  "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
                },
              "Permission": "READ",
            },
          ],
        "LifecycleRules": null,
        "Location": "us-east-2",
        "LoggingPolicy": null,
        "MFADelete": null,
        "Name": "bucket-name",
        "Owner":
          {
            "DisplayName": "user.name",
            "ID": "11112223334445556667778899aaabbbcccdddeeee",
          },
        "Policy": null,
        "PublicAccessBlockConfiguration":
          {
            "BlockPublicAcls": false,
            "BlockPublicPolicy": false,
            "IgnorePublicAcls": false,
            "RestrictPublicBuckets": false,
          },
        "Versioning": null,
      }
  - Name: Bucket Grants WRITE To All Authenticated Users
    ExpectedResult: false
    Resource:
      {
        "CreationDate": "2019-01-01T00:00:00Z",
        "EncryptionRules":
          [
            {
              "ApplyServerSideEncryptionByDefault":
                { "KMSMasterKeyID": null, "SSEAlgorithm": "AES256" },
            },
          ],
        "Grants":
          [
            {
              "Grantee":
                {
                  "DisplayName": "user.name",
                  "EmailAddress": null,
                  "ID": "11112223334445556667778899aaabbbcccdddeeee",
                  "Type": "CanonicalUser",
                  "URI": "http://acs.amazonaws.com/groups/global/AuthenticatedUsers",
                },
              "Permission": "WRITE",
            },
            {
              "Grantee":
                {
                  "DisplayName": null,
                  "EmailAddress": null,
                  "ID": null,
                  "Type": "Group",
                  "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
                },
              "Permission": "WRITE",
            },
          ],
        "LifecycleRules": null,
        "Location": "us-east-2",
        "LoggingPolicy": null,
        "MFADelete": null,
        "Name": "bucket-name",
        "Owner":
          {
            "DisplayName": "user.name",
            "ID": "11112223334445556667778899aaabbbcccdddeeee",
          },
        "Policy": null,
        "PublicAccessBlockConfiguration":
          {
            "BlockPublicAcls": false,
            "BlockPublicPolicy": false,
            "IgnorePublicAcls": false,
            "RestrictPublicBuckets": false,
          },
        "Versioning": null,
      }
  - Name: Bucket Grants WRITE To All Users
    ExpectedResult: false
    Resource:
      {
        "CreationDate": "2019-01-01T00:00:00Z",
        "EncryptionRules":
          [
            {
              "ApplyServerSideEncryptionByDefault":
                { "KMSMasterKeyID": null, "SSEAlgorithm": "AES256" },
            },
          ],
        "Grants":
          [
            {
              "Grantee":
                {
                  "DisplayName": "user.name",
                  "EmailAddress": null,
                  "ID": "11112223334445556667778899aaabbbcccdddeeee",
                  "Type": "CanonicalUser",
                  "URI": "http://acs.amazonaws.com/groups/global/AllUsers",
                },
              "Permission": "WRITE",
            },
            {
              "Grantee":
                {
                  "DisplayName": null,
                  "EmailAddress": null,
                  "ID": null,
                  "Type": "Group",
                  "URI": "http://acs.amazonaws.com/groups/s3/LogDelivery",
                },
              "Permission": "WRITE",
            },
          ],
        "LifecycleRules": null,
        "Location": "us-east-2",
        "LoggingPolicy": null,
        "MFADelete": null,
        "Name": "bucket-name",
        "Owner":
          {
            "DisplayName": "user.name",
            "ID": "11112223334445556667778899aaabbbcccdddeeee",
          },
        "Policy": null,
        "PublicAccessBlockConfiguration":
          {
            "BlockPublicAcls": false,
            "BlockPublicPolicy": false,
            "IgnorePublicAcls": false,
            "RestrictPublicBuckets": false,
          },
        "Versioning": null,
      }
  - Name: Null Configuration
    ExpectedResult: true
    Resource:
      {
        "Arn": "arn:aws:s3:::something-prodsec",
        "LoggingPolicy": null,
        "Policy": null,
        "MFADelete": null,
        "ObjectLockConfiguration": null,
        "LifecycleRules": null,
        "Grants": null,
        "Versioning": null,
        "EncryptionRules": null,
        "PublicAccessBlockConfiguration": null,
        "AccountId": "123456789",
        "Tags":
          {
            "something": "ttd",
            "user": "prodsec",
            "service": "-",
            "owner": "-",
            "team": "-",
          },
        "Region": "us-west-2",
        "ResourceType": "AWS.S3.Bucket",
        "Name": "something-prodsec",
        "ResourceId": "arn:aws:s3:::something-prodsec",
        "TimeCreated": "2020-06-27T00:11:11Z",
        "Owner":
          {
            "DisplayName": "aws-corp",
            "ID": "11112223334445556667778899aaabbbcccdddeeee",
          },
      }
