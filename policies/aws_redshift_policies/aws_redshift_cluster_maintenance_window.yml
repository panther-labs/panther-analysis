AnalysisType: policy
Description: >-
  This policy validates that Redshift Clusters have the correct preferred maintenance
  window configured.
DisplayName: "AWS Redshift Cluster Maintenance Window"
Enabled: false
Filename: aws_redshift_cluster_maintenance_window.py
PolicyID: "AWS.Redshift.Cluster.MaintenanceWindow"
Reference: 
  https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-clusters.html#rs-maintenance-windows
ResourceTypes:
  - AWS.Redshift.Cluster
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-redshift-cluster-has-correct-preferred-maintenance-window
Severity: Info
Tags:
  - AWS
  - Configuration Required
Tests:
  - ExpectedResult: true
    Name: Correct Preferred Maintenance Window
    Resource:
      "AllowVersionUpgrade": false
      "AutomatedSnapshotRetentionPeriod": 3
      "AvailabilityZone": "us-west-2d"
      "ClusterAvailabilityStatus": "Available"
      "ClusterCreateTime": "2019-01-01T00:00:00.0100Z"
      "ClusterIdentifier": "redshift-cluster-2"
      "ClusterNodes":
        - "NodeRole": "SHARED"
          "PrivateIPAddress": "172.0.0.0"
          "PublicIPAddress": "52.0.0.0"
      "ClusterParameterGroups":
        - "ClusterParameterStatusList":
          "ParameterApplyStatus": "in-sync"
          "ParameterGroupName": "default.redshift-1.0"
      "ClusterPublicKey": "ssh-rsa abcd+111/222/333/444 Amazon-Redshift\n"
      "ClusterRevisionNumber": "8205"
      "ClusterSecurityGroups":
      "ClusterSnapshotCopyStatus":
      "ClusterStatus": "available"
      "ClusterSubnetGroupName": "default"
      "ClusterVersion": "1.0"
      "DBName": "example"
      "DataTransferProgress":
      "DeferredMaintenanceWindows":
      "ElasticIpStatus":
      "ElasticResizeNumberOfNodeOptions":
      "Encrypted": true
      "Endpoint":
        "Address": "redshift-cluster-2.abcdefg.us-west-2.redshift.amazonaws.com"
        "Port": 5439
      "EnhancedVpcRouting": false
      "HsmStatus":
      "IamRoles":
      "KmsKeyId": "arn:aws:kms:us-west-2:123456789012:key/abcdefg-111-222-333"
      "LoggingStatus":
        "BucketName": "example-bucket"
        "LastFailureMessage":
        "LastFailureTime":
        "LastSuccessfulDeliveryTime": "2019-01-01T00:00:00Z"
        "LoggingEnabled": true
        "S3KeyPrefix":
      "MaintenanceTrackName": "current"
      "ManualSnapshotRetentionPeriod": -1
      "MasterUsername": "awsuser"
      "ModifyStatus":
      "NodeType": "dc2.large"
      "NumberOfNodes": 1
      "PendingActions":
      "PendingModifiedValues":
        "AutomatedSnapshotRetentionPeriod":
        "ClusterIdentifier":
        "ClusterType":
        "ClusterVersion":
        "EncryptionType":
        "EnhancedVpcRouting":
        "MaintenanceTrackName":
        "MasterUserPassword":
        "NodeType":
        "NumberOfNodes":
        "PubliclyAccessible":
      "PreferredMaintenanceWindow": "sat:10:30-sat:11:00"
      "PubliclyAccessible": true
      "ResizeInfo":
      "RestoreStatus":
      "SnapshotScheduleIdentifier":
      "SnapshotScheduleState":
      "Tags":
      "VpcId": "vpc-6aa60b12"
      "VpcSecurityGroups":
  - ExpectedResult: false
    Name: Incorrect Preferred Maintenance Window
    Resource:
      "AllowVersionUpgrade": false
      "AutomatedSnapshotRetentionPeriod": 3
      "AvailabilityZone": "us-west-2d"
      "ClusterAvailabilityStatus": "Available"
      "ClusterCreateTime": "2019-01-01T00:00:00.0100Z"
      "ClusterIdentifier": "redshift-cluster-2"
      "ClusterNodes":
        - "NodeRole": "SHARED"
          "PrivateIPAddress": "172.0.0.0"
          "PublicIPAddress": "52.0.0.0"
      "ClusterParameterGroups":
        - "ClusterParameterStatusList":
          "ParameterApplyStatus": "in-sync"
          "ParameterGroupName": "default.redshift-1.0"
      "ClusterPublicKey": "ssh-rsa abcd+111/222/333/444 Amazon-Redshift\n"
      "ClusterRevisionNumber": "8205"
      "ClusterSecurityGroups":
      "ClusterSnapshotCopyStatus":
      "ClusterStatus": "available"
      "ClusterSubnetGroupName": "default"
      "ClusterVersion": "1.0"
      "DBName": "example"
      "DataTransferProgress":
      "DeferredMaintenanceWindows":
      "ElasticIpStatus":
      "ElasticResizeNumberOfNodeOptions":
      "Encrypted": true
      "Endpoint":
        "Address": "redshift-cluster-2.abcdefg.us-west-2.redshift.amazonaws.com"
        "Port": 5439
      "EnhancedVpcRouting": false
      "HsmStatus":
      "IamRoles":
      "KmsKeyId": "arn:aws:kms:us-west-2:123456789012:key/abcdefg-111-222-333"
      "LoggingStatus":
        "BucketName": "example-bucket"
        "LastFailureMessage":
        "LastFailureTime":
        "LastSuccessfulDeliveryTime": "2019-01-01T00:00:00Z"
        "LoggingEnabled": true
        "S3KeyPrefix":
      "MaintenanceTrackName": "current"
      "ManualSnapshotRetentionPeriod": -1
      "MasterUsername": "awsuser"
      "ModifyStatus":
      "NodeType": "dc2.large"
      "NumberOfNodes": 1
      "PendingActions":
      "PendingModifiedValues":
        "AutomatedSnapshotRetentionPeriod":
        "ClusterIdentifier":
        "ClusterType":
        "ClusterVersion":
        "EncryptionType":
        "EnhancedVpcRouting":
        "MaintenanceTrackName":
        "MasterUserPassword":
        "NodeType":
        "NumberOfNodes":
        "PubliclyAccessible":
      "PreferredMaintenanceWindow": "fri:11:30-fri:12:00"
      "PubliclyAccessible": true
      "ResizeInfo":
      "RestoreStatus":
      "SnapshotScheduleIdentifier":
      "SnapshotScheduleState":
      "Tags":
      "VpcId": "vpc-6aa60b12"
      "VpcSecurityGroups":
