AnalysisType: policy
Description: >-
  This policy validates that all DynamoDB tables have a TTL field configured.
DisplayName: "AWS DynamoDB Table TTL"
Enabled: false
Filename: aws_dynamodb_table_ttl_enabled.py
PolicyID: "AWS.DynamoDB.TableTTLEnabled"
Reference: https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/TTL.html
Reports:
  MITRE ATT&CK:
    - TA0009:T1530
  PCI:
    - 3.1
ResourceTypes:
  - AWS.DynamoDB.Table
Runbook: >-
  Enable table TTL.
Severity: Low
Tags:
  - AWS
  - Database
  - PCI
  - Collection:Data From Cloud Storage Object
Tests:
  - ExpectedResult: true
    Name: TTL Enabled
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:dynamodb:us-west-2:123456789012:table/example-table"
      "AttributeDefinitions":
        - "AttributeName": "attr1"
          "AttributeType": "S"
        - "AttributeName": "attr2"
          "AttributeType": "S"
      "AutoScalingDescriptions":
      "BillingModeSummary":
        "BillingMode": "PAY_PER_REQUEST"
        "LastUpdateToPayPerRequestDateTime": "2019-01-01T00:00:00Z"
      "GlobalSecondaryIndexes":
      "Id": "1"
      "ItemCount": 0
      "KeySchema":
        - "AttributeName": "attr1"
          "KeyType": "HASH"
        - "AttributeName": "attr2"
          "KeyType": "RANGE"
      "LatestStreamArn": "arn:aws:dynamodb:us-west-2:123456789012:table/example-table/stream/2019-01-01T00:00:00.000"
      "LatestStreamLabel": "2019-01-01T00:00:00.000"
      "LocalSecondaryIndexes":
      "Name": "example-table"
      "ProvisionedThroughput":
        "LastDecreaseDateTime":
        "LastIncreaseDateTime":
        "NumberOfDecreasesToday": 0
        "ReadCapacityUnits": 0
        "WriteCapacityUnits": 0
      "Region": "us-west-2"
      "ResourceId": "arn:aws:dynamodb:us-west-2:123456789012:table/example-table"
      "ResourceType": "AWS.DynamoDB.Table"
      "RestoreSummary":
      "SSEDescription":
        "KMSMasterKeyArn": "arn:aws:kms:us-west-2:123456789012:key/1"
        "SSEType": "KMS"
        "Status": "ENABLED"
      "StreamSpecification":
        "StreamEnabled": true
        "StreamViewType": "NEW_IMAGE"
      "TableSizeBytes": 0
      "TableStatus": "ACTIVE"
      "Tags":
        "environment": "pci"
      "TimeCreated": "2019-02-01T00:00:00.000Z"
      "TimeToLiveDescription":
        "AttributeName": "expiresAt"
        "TimeToLiveStatus": "ENABLED"
  - ExpectedResult: false
    Name: TTL Disabled
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:dynamodb:us-west-2:123456789012:table/example-table"
      "AttributeDefinitions":
        - "AttributeName": "attr1"
          "AttributeType": "S"
        - "AttributeName": "attr2"
          "AttributeType": "S"
      "AutoScalingDescriptions":
      "BillingModeSummary":
        "BillingMode": "PAY_PER_REQUEST"
        "LastUpdateToPayPerRequestDateTime": "2019-01-01T00:00:00Z"
      "GlobalSecondaryIndexes":
      "Id": "1"
      "ItemCount": 0
      "KeySchema":
        - "AttributeName": "attr1"
          "KeyType": "HASH"
        - "AttributeName": "attr2"
          "KeyType": "RANGE"
      "LatestStreamArn": "arn:aws:dynamodb:us-west-2:123456789012:table/example-table/stream/2019-01-01T00:00:00.000"
      "LatestStreamLabel": "2019-01-01T00:00:00.000"
      "LocalSecondaryIndexes":
      "Name": "example-table"
      "ProvisionedThroughput":
        "LastDecreaseDateTime":
        "LastIncreaseDateTime":
        "NumberOfDecreasesToday": 0
        "ReadCapacityUnits": 0
        "WriteCapacityUnits": 0
      "Region": "us-west-2"
      "ResourceId": "arn:aws:dynamodb:us-west-2:123456789012:table/example-table"
      "ResourceType": "AWS.DynamoDB.Table"
      "RestoreSummary":
      "SSEDescription":
        "KMSMasterKeyArn": "arn:aws:kms:us-west-2:123456789012:key/1"
        "SSEType": "KMS"
        "Status": "ENABLED"
      "StreamSpecification":
        "StreamEnabled": true
        "StreamViewType": "NEW_IMAGE"
      "TableSizeBytes": 0
      "TableStatus": "ACTIVE"
      "Tags":
        "environment": "pci"
      "TimeCreated": "2019-02-01T00:00:00.000Z"
      "TimeToLiveDescription":
        "AttributeName":
        "TimeToLiveStatus": "DISABLED"
