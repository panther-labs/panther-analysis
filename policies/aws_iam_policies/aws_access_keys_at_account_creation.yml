AnalysisType: policy
Description: >-
  This policy validates that AWS IAM user accounts do not have access keys that were
  created during account creation. This results in excess keys being generated, and
  unnecessary management work in auditing and rotating these keys.
DisplayName: "AWS Access Keys At Account Creation"
Enabled: true
Filename: aws_access_keys_at_account_creation.py
PolicyID: "AWS.AccessKeys.AccountCreation"
Reference: https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html
Reports:
  CIS:
    - 1.21
ResourceTypes:
  - AWS.IAM.User
  - AWS.IAM.RootUser
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-access-keys-are-not-created-at-account-creation
Severity: Low
Tags:
  - AWS
  - Identity & Access Management
Tests:
  - ExpectedResult: false
    Name: Root User Access Key Created At Account Creation
    Resource:
      "ARN": "arn:aws:iam::123456789012:root"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:root"
        "AccessKey1Active": false
        "AccessKey1LastRotated": "2019-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": true
        "PasswordEnabled": false
        "PasswordLastChanged": "0001-01-01T00:00:00Z"
        "PasswordLastUsed": "2019-01-01T00:00:00Z"
        "PasswordNextRotation": "0001-01-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "<root_account>"
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UserID":
      "UserName": "root"
      "VirtualMFA":
  - ExpectedResult: true
    Name: Root User Access Key Not Created At Account Creation
    Resource:
      "ARN": "arn:aws:iam::123456789012:root"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:root"
        "AccessKey1Active": false
        "AccessKey1LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": true
        "PasswordEnabled": false
        "PasswordLastChanged": "0001-01-01T00:00:00Z"
        "PasswordLastUsed": "2019-01-01T00:00:00Z"
        "PasswordNextRotation": "0001-01-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "<root_account>"
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UserID":
      "UserName": "root"
      "VirtualMFA":
  - ExpectedResult: true
    Name: Root User Access Key Rotated Since Account Creation
    Resource:
      "ARN": "arn:aws:iam::123456789012:root"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:root"
        "AccessKey1Active": false
        "AccessKey1LastRotated": "2019-01-01T00:10:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": true
        "PasswordEnabled": false
        "PasswordLastChanged": "0001-01-01T00:00:00Z"
        "PasswordLastUsed": "2019-01-01T00:00:00Z"
        "PasswordNextRotation": "0001-01-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "<root_account>"
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UserID":
      "UserName": "root"
      "VirtualMFA":
  - ExpectedResult: false
    Name: User Access Key Created At Account Creation
    Resource:
      "Arn": "arn:aws:iam::123456789012:user/Bobert"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/Bobert"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:05Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "0001-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-04-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "Bobert"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/ExampleGroup"
          "GroupId": "ABCDEFGHIJKLMNOP"
          "GroupName": "ExampleGroup"
          "Path": "/"
          "TimeCreated": "2019-01-01T00:00:00.000Z"
      "InlinePolicyNames":
      "ManagedPolicyNames":
        - "IAMUserChangePassword"
      "PasswordLastUsed":
      "Path": "/"
      "PermissionsBoundary":
      "Tags":
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UserId": "ASDFASDFASDFASDF"
      "UserName": "Bobert"
      "VirtualMFA":
  - ExpectedResult: true
    Name: User Access Key Not Created At Account Creation
    Resource:
      "Arn": "arn:aws:iam::123456789012:user/Bobert"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/Bobert"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "0001-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-04-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "Bobert"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/ExampleGroup"
          "GroupId": "ABCDEFGHIJKLMNOP"
          "GroupName": "ExampleGroup"
          "Path": "/"
          "TimeCreated": "2019-01-01T00:00:00.000Z"
      "InlinePolicyNames":
      "ManagedPolicyNames":
        - "IAMUserChangePassword"
      "PasswordLastUsed":
      "Path": "/"
      "PermissionsBoundary":
      "Tags":
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UserId": "ASDFASDFASDFASDF"
      "UserName": "Bobert"
      "VirtualMFA":
  - ExpectedResult: true
    Name: User Access Key Rotated Since Account Creation
    Resource:
      "Arn": "arn:aws:iam::123456789012:user/Bobert"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/Bobert"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:30Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "0001-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-04-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "Bobert"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/ExampleGroup"
          "GroupId": "ABCDEFGHIJKLMNOP"
          "GroupName": "ExampleGroup"
          "Path": "/"
          "TimeCreated": "2019-01-01T00:00:00.000Z"
      "InlinePolicyNames":
      "ManagedPolicyNames":
        - "IAMUserChangePassword"
      "PasswordLastUsed":
      "Path": "/"
      "PermissionsBoundary":
      "Tags":
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "UserId": "ASDFASDFASDFASDF"
      "UserName": "Bobert"
      "VirtualMFA":
  - ExpectedResult: true
    Name: Observed - Timestamp Issues
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:iam::123456789012:user/bobert"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/bobert"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2021-02-07T09:18:42Z"
        "AccessKey1LastUsedDate": "2021-03-01T14:31:00Z"
        "AccessKey1LastUsedRegion": "us-east-1"
        "AccessKey1LastUsedService": "sts"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": true
        "PasswordEnabled": true
        "PasswordLastChanged": "2021-02-09T14:05:34Z"
        "PasswordLastUsed": "2021-03-01T10:13:14Z"
        "PasswordNextRotation": "2021-05-10T14:05:34Z"
        "UserCreationTime": "2020-06-02T09:33:48Z"
        "UserName": "bobert"
      "Id": "XXXXXXXXXXXXXXXXXXXXX"
      "InlinePolicies":
      "ManagedPolicyNames":
      "Name": "bobert"
      "PasswordLastUsed": "2021-03-01T10:13:14Z"
      "Path": "/"
      "PermissionsBoundary":
      "Region": "global"
      "ResourceId": "arn:aws:iam::123456789012:user/bobert"
      "ResourceType": "AWS.IAM.User"
      "Tags":
      "TimeCreated": "2020-06-02T09:33:48Z"
      "VirtualMFA":
        "EnableDate": "2020-06-02T10:10:10Z"
        "SerialNumber": "arn:aws:iam::123456789012:mfa/bobert"
