AnalysisType: policy
Description: >-
  Users with permissions to disable or reconfigure CloudTrail should be limited.
DisplayName: "AWS CloudTrail Least Privilege Access"
Enabled: false
Filename: aws_cloudtrail_least_privilege.py
PolicyID: "AWS.CloudTrail.LeastPrivilege"
Reference: https://amzn.to/2ZEUrKm
Reports:
  MITRE ATT&CK:
    - TA0005:T1562
ResourceTypes:
  - AWS.IAM.Group
Runbook: >-
  Remove the AWSCloudTrailFullAccess managed IAM policy from all but one user in the
  account.
Severity: Medium
Tags:
  - AWS
  - Configuration Required
  - IAM
  - Panther
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: true
    Name: Limited Membership to IAM Group with CloudTrail FullAccess Policy
    Resource:
      "Arn": "arn:aws:iam::123456789012:group/CloudTrailAdmins"
      "CreateDate": "2019-01-01T00:00:00Z"
      "GroupId": "ABCDEFGHIJKLMNOP"
      "GroupName": "CloudTrailAdmins"
      "InlinePolicies": []
      "ManagedPolicyARNs":
        - "arn:aws:iam::aws:policy/AWSCloudTrailFullAccess"
        - "arn:aws:iam::aws:policy/Readonly"
      "Path": "/"
      "Users":
        - "Arn": "arn:aws:iam::123456789012:user/Bobert"
          "CreateDate": "2019-01-1T00:00:00Z"
          "PasswordLastUsed":
          "Path": "/"
          "PermissionsBoundary":
          "Tags":
          "UserId": "ABCDEFGHIJKLMNOP"
          "UserName": "Bobert"
  - ExpectedResult: false
    Name: More Than 2 Users in IAM Group with CloudTrail FullAccess Policy
    Resource:
      "Arn": "arn:aws:iam::123456789012:group/CloudTrailAdmins"
      "CreateDate": "2019-01-01T00:00:00Z"
      "GroupId": "ABCDEFGHIJKLMNOP"
      "GroupName": "CloudTrailAdmins"
      "InlinePolicies": []
      "ManagedPolicyARNs":
        - "arn:aws:iam::aws:policy/AWSCloudTrailFullAccess"
        - "arn:aws:iam::aws:policy/ReadOnly"
      "Path": "/"
      "Users":
        - "Arn": "arn:aws:iam::123456789012:user/Bobert"
          "CreateDate": "2019-01-1T00:00:00Z"
          "PasswordLastUsed":
          "Path": "/"
          "PermissionsBoundary":
          "Tags":
          "UserId": "ABCDEFGHIJKLMNOP"
          "UserName": "Bobert"
        - "Arn": "arn:aws:iam::123456789012:user/Bobert2"
          "CreateDate": "2019-01-1T00:00:00Z"
          "PasswordLastUsed":
          "Path": "/"
          "PermissionsBoundary":
          "Tags":
          "UserId": "ABCDEFGHIJKLMNOP"
          "UserName": "Bobert2"
        - "Arn": "arn:aws:iam::123456789012:user/Bobert3"
          "CreateDate": "2019-01-1T00:00:00Z"
          "PasswordLastUsed":
          "Path": "/"
          "PermissionsBoundary":
          "Tags":
          "UserId": "ABCDEFGHIJKLMNOP"
          "UserName": "Bobert3"
