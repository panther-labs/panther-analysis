AnalysisType: policy
Description: >-
  This policy validates that there are no IAM policies assigned directly to users.
  Best practice suggests assigning to an IAM group and placing users within that group.
DisplayName: "AWS IAM Policy Assigned to User"
Enabled: true
Filename: aws_iam_policy_assigned_to_user.py
PolicyID: "AWS.IAM.Policy.AssignedToUser"
Reference: https://amzn.to/2Pss7Ln
Reports:
  CIS:
    - 1.16
  MITRE ATT&CK:
    - TA0004:T1078
  PCI:
    - 2.2.4
    - 7.1.1
ResourceTypes:
  - AWS.IAM.User
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-iam-policy-not-assigned-directly-to-user
Severity: Low
Tags:
  - AWS
  - Identity & Access Management
  - Privilege Escalation:Valid Accounts
Tests:
  - ExpectedResult: false
    Name: Managed Policy Directly Assigned
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:iam::123456789012:user/tester"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/tester"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "2019-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-01-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "tester"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/TestGroup"
          "CreateDate": "2019-01-01T00:00:00Z"
          "GroupId": "111"
          "GroupName": "TestGroup"
          "Path": "/"
      "Id": "1111"
      "InlinePolicies":
      "ManagedPolicyNames":
        - "IAMUserChangePassword"
      "Name": "tester"
      "PasswordLastUsed": "2019-01-01T00:00:00Z"
      "Path": "/"
      "PermissionsBoundary":
      "Region": "global"
      "ResourceId": "arn:aws:iam::123456789012:user/tester"
      "ResourceType": "AWS.IAM.User"
      "Tags":
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "VirtualMFA":
  - ExpectedResult: false
    Name: Inline Policy Directly Assigned
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:iam::123456789012:user/tester"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/tester"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "2019-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-01-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "tester"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/TestGroup"
          "CreateDate": "2019-01-01T00:00:00Z"
          "GroupId": "111"
          "GroupName": "TestGroup"
          "Path": "/"
      "Id": "1111"
      "InlinePolicies":
        "inline-policy": "policy document"
      "ManagedPolicyNames":
      "Name": "tester"
      "PasswordLastUsed": "2019-01-01T00:00:00Z"
      "Path": "/"
      "PermissionsBoundary":
      "Region": "global"
      "ResourceId": "arn:aws:iam::123456789012:user/tester"
      "ResourceType": "AWS.IAM.User"
      "Tags":
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "VirtualMFA":
  - ExpectedResult: true
    Name: No Policies Directly Assigned
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:iam::123456789012:user/tester"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/tester"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "2019-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-01-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "tester"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/TestGroup"
          "CreateDate": "2019-01-01T00:00:00Z"
          "GroupId": "111"
          "GroupName": "TestGroup"
          "Path": "/"
      "Id": "1111"
      "InlinePolicies":
      "ManagedPolicyNames":
      "Name": "tester"
      "PasswordLastUsed": "2019-01-01T00:00:00Z"
      "Path": "/"
      "PermissionsBoundary":
      "Region": "global"
      "ResourceId": "arn:aws:iam::123456789012:user/tester"
      "ResourceType": "AWS.IAM.User"
      "Tags":
      "TimeCreated": "2019-01-01T00:00:00.000Z"
      "VirtualMFA":
