AnalysisType: policy
Description: >-
  This policy validates that no IAM entities have inline policies assigned. Inline
  policies are more difficult to administer and audit, and may lead to access that
  lasts longer than intended.
DisplayName: "AWS IAM Resource Does Not Have Inline Policy"
Enabled: true
Filename: aws_iam_resource_does_not_have_inline_policy.py
PolicyID: "AWS.IAM.Resource.DoesNotHaveInlinePolicy"
Reference: 
  https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_managed-vs-inline.html
Reports:
  MITRE ATT&CK:
    - TA0003:T1078
  PCI:
    - 2.2.4
    - 7.1.1
ResourceTypes:
  - AWS.IAM.User
  - AWS.IAM.Group
Runbook: >-
  Delete the inline policy, and if the permissions are required add an appropriate
  IAM managed policy to the entity.
Severity: Medium
Tags:
  - AWS
  - PCI
  - Persistence:Valid Accounts
Tests:
  - ExpectedResult: false
    Name: IAM User Has Inline Policy
    Resource:
      "Arn": "arn:aws:iam::123456789012:user/Bobert"
      "CreateDate": "2019-01-01T00:00:00Z"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/Bobert"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "0001-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-04-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "Bobert"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/ExampleGroup"
          "CreateDate": "2019-01-01T00:00:00Z"
          "GroupId": "ABCDEFGHIJKLMNOP"
          "GroupName": "ExampleGroup"
          "Path": "/"
      "InlinePolicies":
        "BobsInlinePolicy": "policy document"
      "ManagedPolicyNames":
      "PasswordLastUsed":
      "Path": "/"
      "PermissionsBoundary":
      "Tags":
      "UserId": "ASDFASDFASDFASDF"
      "UserName": "Bobert"
      "VirtualMFA":
  - ExpectedResult: true
    Name: IAM User Has No Inline Policy
    Resource:
      "Arn": "arn:aws:iam::123456789012:user/Bobert"
      "CreateDate": "2019-01-01T00:00:00Z"
      "CredentialReport":
        "ARN": "arn:aws:iam::123456789012:user/Bobert"
        "AccessKey1Active": true
        "AccessKey1LastRotated": "2019-01-01T00:00:00Z"
        "AccessKey1LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey1LastUsedRegion": "N/A"
        "AccessKey1LastUsedService": "N/A"
        "AccessKey2Active": false
        "AccessKey2LastRotated": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedDate": "0001-01-01T00:00:00Z"
        "AccessKey2LastUsedRegion": "N/A"
        "AccessKey2LastUsedService": "N/A"
        "Cert1Active": false
        "Cert1LastRotated": "0001-01-01T00:00:00Z"
        "Cert2Active": false
        "Cert2LastRotated": "0001-01-01T00:00:00Z"
        "MfaActive": false
        "PasswordEnabled": true
        "PasswordLastChanged": "2019-01-01T00:00:00Z"
        "PasswordLastUsed": "0001-01-01T00:00:00Z"
        "PasswordNextRotation": "2019-04-01T00:00:00Z"
        "UserCreationTime": "2019-01-01T00:00:00Z"
        "UserName": "Bobert"
      "Groups":
        - "Arn": "arn:aws:iam::123456789012:group/ExampleGroup"
          "CreateDate": "2019-01-01T00:00:00Z"
          "GroupId": "ABCDEFGHIJKLMNOP"
          "GroupName": "ExampleGroup"
          "Path": "/"
      "InlinePolicies":
      "ManagedPolicyNames":
      "PasswordLastUsed":
      "Path": "/"
      "PermissionsBoundary":
      "Tags":
      "UserId": "ASDFASDFASDFASDF"
      "UserName": "Bobert"
      "VirtualMFA":
