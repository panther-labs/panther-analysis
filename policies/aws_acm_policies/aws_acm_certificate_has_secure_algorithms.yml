AnalysisType: policy
Description: >-
  This policy validates that all ACM certificates are using secure key and signature
  algorithms.
DisplayName: "AWS ACM Secure Algorithms"
Enabled: false
Filename: aws_acm_certificate_has_secure_algorithms.py
PolicyID: "AWS.ACM.HasSecureAlgorithms"
Reference: https://docs.aws.amazon.com/acm/latest/userguide/acm-certificate.html#algorithms
Reports:
  MITRE ATT&CK:
    - TA0005:T1562
  PCI:
    - 2.2.3
ResourceTypes:
  - AWS.ACM.Certificate
Runbook: >-
  Delete the insecure certificate, and re-create with appropriately secure key and
  signature algorithms.
Severity: High
Tags:
  - AWS
  - Configuration Required
  - PCI
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: true
    Name: Certificate Has Secure Algorithms
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:acm:us-east-1:123456789012:certificate/1"
      "CertificateAuthorityArn":
      "DomainName": "example.com"
      "DomainValidationOptions":
        - "DomainName": "example.com"
          "ResourceRecord":
            "Name": "aaaa.example.com."
            "Type": "CNAME"
            "Value": "aaaa.bbbb.acm-validations.aws."
          "ValidationDomain": "example.com"
          "ValidationEmails":
          "ValidationMethod": "DNS"
          "ValidationStatus": "SUCCESS"
      "ExtendedKeyUsages":
        - "Name": "TLS_WEB_SERVER_AUTHENTICATION"
          "OID": "1.3.6.1.5.5.7.3.1"
      "FailureReason":
      "InUseBy":
      "IssuedAt": "2019-01-01T00:00:00Z"
      "Issuer": "Amazon"
      "KeyAlgorithm": "RSA-2048"
      "KeyUsages":
        - "Name": "DIGITAL_SIGNATURE"
      "Name": "example.com"
      "NotAfter": "2020-01-01T00:00:00Z"
      "NotBefore": "2019-01-01T00:00:00Z"
      "Options":
        "CertificateTransparencyLoggingPreference": "ENABLED"
      "Region": "us-east-1"
      "RenewalEligibility": "INELIGIBLE"
      "RenewalSummary":
      "ResourceId": "arn:aws:acm:us-east-1:123456789012:certificate/1"
      "ResourceType": "AWS.ACM.Certificate"
      "RevocationReason":
      "RevokedAt":
      "Serial": "00:00:00"
      "SignatureAlgorithm": "SHA256WITHRSA"
      "Status": "ISSUED"
      "Subject": "CN=example.com"
      "SubjectAlternativeNames":
        - "example.com"
      "Tags":
      "TimeCreated":
      "Type": "AMAZON_ISSUED"
  - ExpectedResult: false
    Name: Certificate Has One Insecure Algorithm
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:acm:us-east-1:123456789012:certificate/1"
      "CertificateAuthorityArn":
      "DomainName": "example.com"
      "DomainValidationOptions":
        - "DomainName": "example.com"
          "ResourceRecord":
            "Name": "aaaa.example.com."
            "Type": "CNAME"
            "Value": "aaaa.bbbb.acm-validations.aws."
          "ValidationDomain": "example.com"
          "ValidationEmails":
          "ValidationMethod": "DNS"
          "ValidationStatus": "SUCCESS"
      "ExtendedKeyUsages":
        - "Name": "TLS_WEB_SERVER_AUTHENTICATION"
          "OID": "1.3.6.1.5.5.7.3.1"
      "FailureReason":
      "InUseBy":
      "IssuedAt": "2019-01-01T00:00:00Z"
      "Issuer": "Amazon"
      "KeyAlgorithm": "LANMAN"
      "KeyUsages":
        - "Name": "DIGITAL_SIGNATURE"
      "Name": "example.com"
      "NotAfter": "2020-01-01T00:00:00Z"
      "NotBefore": "2019-01-01T00:00:00Z"
      "Options":
        "CertificateTransparencyLoggingPreference": "ENABLED"
      "Region": "us-east-1"
      "RenewalEligibility": "INELIGIBLE"
      "RenewalSummary":
      "ResourceId": "arn:aws:acm:us-east-1:123456789012:certificate/1"
      "ResourceType": "AWS.ACM.Certificate"
      "RevocationReason":
      "RevokedAt":
      "Serial": "00:00:00"
      "SignatureAlgorithm": "SHA256WITHRSA"
      "Status": "ISSUED"
      "Subject": "CN=example.com"
      "SubjectAlternativeNames":
        - "example.com"
      "Tags":
      "TimeCreated":
      "Type": "AMAZON_ISSUED"
  - ExpectedResult: false
    Name: Certificate Has Two Insecure Agorithms
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:acm:us-east-1:123456789012:certificate/1"
      "CertificateAuthorityArn":
      "DomainName": "example.com"
      "DomainValidationOptions":
        - "DomainName": "example.com"
          "ResourceRecord":
            "Name": "aaaa.example.com."
            "Type": "CNAME"
            "Value": "aaaa.bbbb.acm-validations.aws."
          "ValidationDomain": "example.com"
          "ValidationEmails":
          "ValidationMethod": "DNS"
          "ValidationStatus": "SUCCESS"
      "ExtendedKeyUsages":
        - "Name": "TLS_WEB_SERVER_AUTHENTICATION"
          "OID": "1.3.6.1.5.5.7.3.1"
      "FailureReason":
      "InUseBy":
      "IssuedAt": "2019-01-01T00:00:00Z"
      "Issuer": "Amazon"
      "KeyAlgorithm": "LANMAN"
      "KeyUsages":
        - "Name": "DIGITAL_SIGNATURE"
      "Name": "example.com"
      "NotAfter": "2020-01-01T00:00:00Z"
      "NotBefore": "2019-01-01T00:00:00Z"
      "Options":
        "CertificateTransparencyLoggingPreference": "ENABLED"
      "Region": "us-east-1"
      "RenewalEligibility": "INELIGIBLE"
      "RenewalSummary":
      "ResourceId": "arn:aws:acm:us-east-1:123456789012:certificate/1"
      "ResourceType": "AWS.ACM.Certificate"
      "RevocationReason":
      "RevokedAt":
      "Serial": "00:00:00"
      "SignatureAlgorithm": "MD5"
      "Status": "ISSUED"
      "Subject": "CN=example.com"
      "SubjectAlternativeNames":
        - "example.com"
      "Tags":
      "TimeCreated":
      "Type": "AMAZON_ISSUED"
