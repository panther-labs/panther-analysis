AnalysisType: policy
Description: >-
  CloudTrail supports sending data and management events to CloudWatch Logs. This
  setup can be used for real-time processing of all CloudTrail data events.
DisplayName: "AWS CloudTrail CloudWatch Logs"
Enabled: false
Filename: aws_cloudtrail_cloudwatch_logs.py
PolicyID: "AWS.CloudTrail.CloudWatchLogs"
Reference: 
  https://docs.aws.amazon.com/awscloudtrail/latest/userguide/send-cloudtrail-events-to-cloudwatch-logs.html
Reports:
  CIS:
    - 2.4
  MITRE ATT&CK:
    - TA0005:T1562
ResourceTypes:
  - AWS.CloudTrail
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-cloudtrail-trails-integrated-with-cloudwatch-logs
Severity: Low
Tags:
  - AWS
  - Security Control
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: false
    Name: CloudWatch Logs Not Setup
    Resource:
      "CloudWatchLogsLogGroupArn":
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values": []
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled": true
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime":
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded": ""
        "LatestNotificationAttemptTime": ""
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped": ""
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
  - ExpectedResult: false
    Name: CloudTrail Set But No Logs Delivered
    Resource:
      "CloudWatchLogsLogGroupArn": "arn:aws:cloudwatch:us-west-2:123456789012:watch/cloudwatch-name"
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values": []
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled": true
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime":
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded": ""
        "LatestNotificationAttemptTime": ""
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped": ""
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
  - ExpectedResult: false
    Name: CloudTrail Set But Logs Delivered Too Long Ago
    Resource:
      "CloudWatchLogsLogGroupArn": "arn:aws:cloudwatch:us-west-2:123456789012:watch/cloudwatch-name"
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values": []
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled": true
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime": "1019-01-01T00:00:00Z"
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded": ""
        "LatestNotificationAttemptTime": ""
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped": ""
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
  - ExpectedResult: true
    Name: CloudTrail Set And Logs Delivered Recently
    Resource:
      "CloudWatchLogsLogGroupArn": "arn:aws:cloudwatch:us-west-2:123456789012:watch/cloudwatch-name"
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values": []
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled": true
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime": "3019-01-01T00:00:00Z"
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded": ""
        "LatestNotificationAttemptTime": ""
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped": ""
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
