AnalysisType: policy
Description: >-
  This policy ensures that CloudTrail logs have file integrity validation enabled.
DisplayName: "AWS CloudTrail Log Validation"
Enabled: true
Filename: aws_cloudtrail_log_validation.py
PolicyID: "AWS.CloudTrail.LogValidation"
Reference: https://amzn.to/2MMgE6W
Reports:
  CIS:
    - 2.2
  MITRE ATT&CK:
    - TA0005:T1562
  PCI:
    - 10.5.5
ResourceTypes:
  - AWS.CloudTrail
Runbook: >-
  https://docs.runpanther.io/alert-runbooks/built-in-policies/aws-cloudtrail-log-validation-enabled
Severity: Medium
Tags:
  - AWS
  - Data Protection
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: false
    Name: Log File Validation Disabled
    Resource:
      "CloudWatchLogsLogGroupArn":
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values":
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled": false
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime":
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded":
        "LatestNotificationAttemptTime":
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped":
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
  - ExpectedResult: true
    Name: Log File Validation Enabled
    Resource:
      "CloudWatchLogsLogGroupArn":
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values":
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled": true
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime":
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded":
        "LatestNotificationAttemptTime":
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped":
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
  - ExpectedResult: false
    Name: Log File Validation Not Set
    Resource:
      "CloudWatchLogsLogGroupArn":
      "CloudWatchLogsRoleArn":
      "EventSelectors":
        - "DataResources":
            - "Type": "AWS::S3::Object"
              "Values":
          "IncludeManagementEvents": false
          "ReadWriteType": "All"
      "HasCustomEventSelectors": true
      "HomeRegion": "us-west-2"
      "IncludeGlobalServiceEvents": true
      "IsMultiRegionTrail": false
      "IsOrganizationTrail": false
      "KmsKeyId":
      "LogFileValidationEnabled":
      "Name": "cloudtrail-name"
      "S3BucketName": "bucket-name"
      "S3KeyPrefix":
      "SnsTopicARN":
      "SnsTopicName":
      "Status":
        "IsLogging": true
        "LatestCloudWatchLogsDeliveryError":
        "LatestCloudWatchLogsDeliveryTime":
        "LatestDeliveryAttemptSucceeded": "2019-01-01T00:00:00Z"
        "LatestDeliveryAttemptTime": "2019-01-01T00:00:00Z"
        "LatestDeliveryError":
        "LatestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestDigestDeliveryError":
        "LatestDigestDeliveryTime": "2019-01-01T00:00:00Z"
        "LatestNotificationAttemptSucceeded":
        "LatestNotificationAttemptTime":
        "LatestNotificationError":
        "LatestNotificationTime":
        "StartLoggingTime": "2019-01-01T00:00:00Z"
        "StopLoggingTime":
        "TimeLoggingStarted": "2019-01-01T00:00:00Z"
        "TimeLoggingStopped":
      "TrailARN": "arn:aws:cloudtrail:us-west-2:112233445566:trail/cloudtrail-name"
