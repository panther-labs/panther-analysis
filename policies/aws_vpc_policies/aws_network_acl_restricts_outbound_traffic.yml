AnalysisType: policy
Description: >-
  This policy validates that Network ACLs have some restrictions on outbound traffic.
DisplayName: "AWS Network ACL Restricts Outbound Traffic"
Enabled: false
Filename: aws_network_acl_restricts_outbound_traffic.py
PolicyID: "AWS.NetworkACL.RestrictsOutboundTraffic"
Reference: https://docs.aws.amazon.com/vpc/latest/userguide/vpc-recommended-nacl-rules.html
Reports:
  MITRE ATT&CK:
    - TA0010:T1567
  PCI:
    - 1.1.4
    - 1.3.2
ResourceTypes:
  - AWS.EC2.NetworkACL
Runbook: >-
  Add appropriate restrictions on outbound traffic.
Severity: Low
Tags:
  - AWS
  - PCI
  - Exfiltration:Exfiltration Over Web Service
Tests:
  - ExpectedResult: true
    Name: Network ACL Restricts Outbound Traffic
    Resource:
      "Associations":
        - "NetworkAclAssociationId": "aclassoc-abc111222333"
          "NetworkAclId": "acl-def111222333"
          "SubnetId": "subnet-111222333444"
      "Entries":
        - "CidrBlock": "0.0.0.0/0"
          "Egress": true
          "IcmpTypeCode":
          "Ipv6CidrBlock":
          "PortRange":
            "From": 1024
            "To": 65535
          "Protocol": "6"
          "RuleAction": "allow"
          "RuleNumber": 100
        - "CidrBlock": "0.0.0.0/0"
          "Egress": true
          "IcmpTypeCode":
          "Ipv6CidrBlock":
          "PortRange":
          "Protocol": "-1"
          "RuleAction": "deny"
          "RuleNumber": 4200
        - "CidrBlock": "0.0.0.0/0"
          "Egress": false
          "IcmpTypeCode":
          "Ipv6CidrBlock":
          "PortRange":
            "From": 80
            "To": 80
          "Protocol": "6"
          "RuleAction": "allow"
          "RuleNumber": 100
      "IsDefault": false
      "NetworkAclId": "acl-abc111222333"
      "OwnerId": "123456789012"
      "Tags":
        "environment": "pci"
      "VpcId": "vpc-abc111222333"
  - ExpectedResult: false
    Name: Network ACL Does Not Restrict Outbound Traffic
    Resource:
      "Associations":
        - "NetworkAclAssociationId": "aclassoc-abc111222333"
          "NetworkAclId": "acl-def111222333"
          "SubnetId": "subnet-111222333444"
      "Entries":
        - "CidrBlock": "0.0.0.0/0"
          "Egress": true
          "IcmpTypeCode":
          "Ipv6CidrBlock":
          "PortRange":
            "From": 1024
            "To": 65535
          "Protocol": "6"
          "RuleAction": "allow"
          "RuleNumber": 100
        - "CidrBlock": "0.0.0.0/0"
          "Egress": true
          "IcmpTypeCode":
          "Ipv6CidrBlock":
          "PortRange":
          "Protocol": "-1"
          "RuleAction": "deny"
          "RuleNumber": 4200
        - "CidrBlock": "0.0.0.0/0"
          "Egress": true
          "IcmpTypeCode":
          "Ipv6CidrBlock":
          "PortRange":
          "Protocol": "6"
          "RuleAction": "allow"
          "RuleNumber": 100
      "IsDefault": false
      "NetworkAclId": "acl-abc111222333"
      "OwnerId": "123456789012"
      "Tags":
        "environment": "pci"
      "VpcId": "vpc-abc111222333"
