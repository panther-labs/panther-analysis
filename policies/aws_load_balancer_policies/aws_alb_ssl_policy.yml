AnalysisType: policy
Description: >-
  Ensures that deprecated TLS versions are not supported in internet-facing load balancers
DisplayName: "AWS ELB SSL Policies"
Enabled: true
Filename: aws_alb_ssl_policy.py
PolicyID: "AWS.ELBv2.SSLPolicy"
Reference: 
  https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html
Reports:
  MITRE ATT&CK:
    - TA0001:T1190
  PCI:
    - 2.2.3
    - 4.1
ResourceTypes:
  - AWS.ELBV2.ApplicationLoadBalancer
Runbook: >-
  Update your load balancer's SSLPolicies to only support modern TLS versions
Severity: Medium
Tags:
  - AWS
  - Panther
  - Initial Access:Exploit Public-Facing Application
Tests:
  - ExpectedResult: true
    Name: Strong Ciphers Internet Facing
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
      "AvailabilityZones":
        - "LoadBalancerAddresses":
          "SubnetId": "subnet-05f7b81cc5d97e0e2"
          "ZoneName": "us-east-1b"
        - "LoadBalancerAddresses":
          "SubnetId": "subnet-07419606a40f4c414"
          "ZoneName": "us-east-1a"
      "CanonicalHostedZonedId": "Z1H1FL5HABSF5"
      "DNSName": "web-360787852.us-east-1.elb.amazonaws.com"
      "IpAddressType": "ipv4"
      "Listeners":
        - "Certificates":
            - "CertificateArn": "arn:aws:acm:us-east-1:123456789012:certificate/10c4e713-9bb5-4ccf-aabc-1c9119370038"
              "IsDefault":
          "DefaultActions":
            - "AuthenticateCognitoConfig":
              "AuthenticateOidcConfig":
              "FixedResponseConfig":
              "ForwardConfig":
                "TargetGroupStickinessConfig":
                  "DurationSeconds":
                  "Enabled": false
                "TargetGroups":
                  - "TargetGroupArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/web/54eedfcacc3949ef"
                    "Weight": 1
              "Order":
              "RedirectConfig":
              "TargetGroupArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/web/54eedfcacc3949ef"
              "Type": "forward"
          "ListenerArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:listener/app/web/3ff2fab33a993e0c/995359b182328b77"
          "LoadBalancerArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
          "Port": 443
          "Protocol": "HTTPS"
          "SslPolicy": "ELBSecurityPolicy-2016-08"
      "Name": "web"
      "Region": "us-east-1"
      "ResourceId": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
      "ResourceType": "AWS.ELBV2.ApplicationLoadBalancer"
      "SSLPolicies":
        "ELBSecurityPolicy-FS-1-2-2019-08":
          "Ciphers":
            - "Name": "ECDHE-ECDSA-AES128-GCM-SHA256"
              "Priority": 1
            - "Name": "ECDHE-RSA-AES128-GCM-SHA256"
              "Priority": 2
            - "Name": "ECDHE-ECDSA-AES128-SHA256"
              "Priority": 3
            - "Name": "ECDHE-RSA-AES128-SHA256"
              "Priority": 4
            - "Name": "ECDHE-ECDSA-AES128-SHA"
              "Priority": 5
            - "Name": "ECDHE-RSA-AES128-SHA"
              "Priority": 6
            - "Name": "ECDHE-ECDSA-AES256-GCM-SHA384"
              "Priority": 7
            - "Name": "ECDHE-RSA-AES256-GCM-SHA384"
              "Priority": 8
            - "Name": "ECDHE-ECDSA-AES256-SHA384"
              "Priority": 9
            - "Name": "ECDHE-RSA-AES256-SHA384"
              "Priority": 10
            - "Name": "ECDHE-RSA-AES256-SHA"
              "Priority": 11
            - "Name": "ECDHE-ECDSA-AES256-SHA"
              "Priority": 12
          "Name": "ELBSecurityPolicy-FS-1-2-2019-08"
          "SslProtocols":
            - "TLSv1.2"
      "Scheme": "internet-facing"
      "SecurityGroups":
        - "sg-000bbcc377444490b"
      "State":
        "Code": "active"
        "Reason":
      "Tags":
        "Application": "Test"
      "TimeCreated": "2020-03-24T21:39:15.050Z"
      "Type": "application"
      "VpcId": "vpc-0aa6688dd88484847"
      "WebAcl":
  - ExpectedResult: false
    Name: Default Ciphers
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
      "AvailabilityZones":
        - "LoadBalancerAddresses":
          "SubnetId": "subnet-05f7b81cc5d97e0e2"
          "ZoneName": "us-east-1b"
        - "LoadBalancerAddresses":
          "SubnetId": "subnet-07419606a40f4c414"
          "ZoneName": "us-east-1a"
      "CanonicalHostedZonedId": "Z1H1FL5HABSF5"
      "DNSName": "web-360787852.us-east-1.elb.amazonaws.com"
      "IpAddressType": "ipv4"
      "Listeners":
        - "Certificates":
            - "CertificateArn": "arn:aws:acm:us-east-1:123456789012:certificate/10c4e713-9bb5-4ccf-aabc-1c9119370038"
              "IsDefault":
          "DefaultActions":
            - "AuthenticateCognitoConfig":
              "AuthenticateOidcConfig":
              "FixedResponseConfig":
              "ForwardConfig":
                "TargetGroupStickinessConfig":
                  "DurationSeconds":
                  "Enabled": false
                "TargetGroups":
                  - "TargetGroupArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/web/54eedfcacc3949ef"
                    "Weight": 1
              "Order":
              "RedirectConfig":
              "TargetGroupArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/web/54eedfcacc3949ef"
              "Type": "forward"
          "ListenerArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:listener/app/web/3ff2fab33a993e0c/995359b182328b77"
          "LoadBalancerArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
          "Port": 443
          "Protocol": "HTTPS"
          "SslPolicy": "ELBSecurityPolicy-2016-08"
      "Name": "web"
      "Region": "us-east-1"
      "ResourceId": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
      "ResourceType": "AWS.ELBV2.ApplicationLoadBalancer"
      "SSLPolicies":
        "ELBSecurityPolicy-2016-08":
          "Ciphers":
            - "Name": "ECDHE-ECDSA-AES128-GCM-SHA256"
              "Priority": 1
            - "Name": "ECDHE-RSA-AES128-GCM-SHA256"
              "Priority": 2
            - "Name": "ECDHE-ECDSA-AES128-SHA256"
              "Priority": 3
            - "Name": "ECDHE-RSA-AES128-SHA256"
              "Priority": 4
            - "Name": "ECDHE-ECDSA-AES128-SHA"
              "Priority": 5
            - "Name": "ECDHE-RSA-AES128-SHA"
              "Priority": 6
            - "Name": "ECDHE-ECDSA-AES256-GCM-SHA384"
              "Priority": 7
            - "Name": "ECDHE-RSA-AES256-GCM-SHA384"
              "Priority": 8
            - "Name": "ECDHE-ECDSA-AES256-SHA384"
              "Priority": 9
            - "Name": "ECDHE-RSA-AES256-SHA384"
              "Priority": 10
            - "Name": "ECDHE-RSA-AES256-SHA"
              "Priority": 11
            - "Name": "ECDHE-ECDSA-AES256-SHA"
              "Priority": 12
            - "Name": "AES128-GCM-SHA256"
              "Priority": 13
            - "Name": "AES128-SHA256"
              "Priority": 14
            - "Name": "AES128-SHA"
              "Priority": 15
            - "Name": "AES256-GCM-SHA384"
              "Priority": 16
            - "Name": "AES256-SHA256"
              "Priority": 17
            - "Name": "AES256-SHA"
              "Priority": 18
          "Name": "ELBSecurityPolicy-2016-08"
          "SslProtocols":
            - "TLSv1"
            - "TLSv1.1"
            - "TLSv1.2"
      "Scheme": "internet-facing"
      "SecurityGroups":
        - "sg-000bbcc377444490b"
      "State":
        "Code": "active"
        "Reason":
      "Tags":
        "Application": "Test"
      "TimeCreated": "2020-03-24T21:39:15.050Z"
      "Type": "application"
      "VpcId": "vpc-0aa6688dd88484847"
      "WebAcl":
  - ExpectedResult: true
    Name: Default Ciphers Internal Load Balancer
    Resource:
      "AccountId": "123456789012"
      "Arn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
      "AvailabilityZones":
        - "LoadBalancerAddresses":
          "SubnetId": "subnet-05f7b81cc5d97e0e2"
          "ZoneName": "us-east-1b"
        - "LoadBalancerAddresses":
          "SubnetId": "subnet-07419606a40f4c414"
          "ZoneName": "us-east-1a"
      "CanonicalHostedZonedId": "Z1H1FL5HABSF5"
      "DNSName": "web-360787852.us-east-1.elb.amazonaws.com"
      "IpAddressType": "ipv4"
      "Listeners":
        - "Certificates":
            - "CertificateArn": "arn:aws:acm:us-east-1:123456789012:certificate/10c4e713-9bb5-4ccf-aabc-1c9119370038"
              "IsDefault":
          "DefaultActions":
            - "AuthenticateCognitoConfig":
              "AuthenticateOidcConfig":
              "FixedResponseConfig":
              "ForwardConfig":
                "TargetGroupStickinessConfig":
                  "DurationSeconds":
                  "Enabled": false
                "TargetGroups":
                  - "TargetGroupArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/web/54eedfcacc3949ef"
                    "Weight": 1
              "Order":
              "RedirectConfig":
              "TargetGroupArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/web/54eedfcacc3949ef"
              "Type": "forward"
          "ListenerArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:listener/app/web/3ff2fab33a993e0c/995359b182328b77"
          "LoadBalancerArn": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
          "Port": 443
          "Protocol": "HTTPS"
          "SslPolicy": "ELBSecurityPolicy-2016-08"
      "Name": "web"
      "Region": "us-east-1"
      "ResourceId": "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/web/3ff2fab33a993e0c"
      "ResourceType": "AWS.ELBV2.ApplicationLoadBalancer"
      "SSLPolicies":
        "ELBSecurityPolicy-2016-08":
          "Ciphers":
            - "Name": "ECDHE-ECDSA-AES128-GCM-SHA256"
              "Priority": 1
            - "Name": "ECDHE-RSA-AES128-GCM-SHA256"
              "Priority": 2
            - "Name": "ECDHE-ECDSA-AES128-SHA256"
              "Priority": 3
            - "Name": "ECDHE-RSA-AES128-SHA256"
              "Priority": 4
            - "Name": "ECDHE-ECDSA-AES128-SHA"
              "Priority": 5
            - "Name": "ECDHE-RSA-AES128-SHA"
              "Priority": 6
            - "Name": "ECDHE-ECDSA-AES256-GCM-SHA384"
              "Priority": 7
            - "Name": "ECDHE-RSA-AES256-GCM-SHA384"
              "Priority": 8
            - "Name": "ECDHE-ECDSA-AES256-SHA384"
              "Priority": 9
            - "Name": "ECDHE-RSA-AES256-SHA384"
              "Priority": 10
            - "Name": "ECDHE-RSA-AES256-SHA"
              "Priority": 11
            - "Name": "ECDHE-ECDSA-AES256-SHA"
              "Priority": 12
            - "Name": "AES128-GCM-SHA256"
              "Priority": 13
            - "Name": "AES128-SHA256"
              "Priority": 14
            - "Name": "AES128-SHA"
              "Priority": 15
            - "Name": "AES256-GCM-SHA384"
              "Priority": 16
            - "Name": "AES256-SHA256"
              "Priority": 17
            - "Name": "AES256-SHA"
              "Priority": 18
          "Name": "ELBSecurityPolicy-2016-08"
          "SslProtocols":
            - "TLSv1"
            - "TLSv1.1"
            - "TLSv1.2"
      "Scheme": "internal"
      "SecurityGroups":
        - "sg-000bbcc377444490b"
      "State":
        "Code": "active"
        "Reason":
      "Tags":
        "Application": "Test"
      "TimeCreated": "2020-03-24T21:39:15.050Z"
      "Type": "application"
      "VpcId": "vpc-0aa6688dd88484847"
      "WebAcl":
  - ExpectedResult: false
    Name: Observed - No Listeners len() issue
    Resource:
      "Listeners":
      "SSLPolicies":
        "ELBSecurityPolicy-2016-08":
          "Ciphers":
            - "Name": "ECDHE-ECDSA-AES128-GCM-SHA256"
              "Priority": 1
          "Name": "ELBSecurityPolicy-2016-08"
          "SslProtocols":
            - "TLSv1"
            - "TLSv1.1"
            - "TLSv1.2"
      "Scheme": "internet-facing"
  - ExpectedResult: true
    Name: TLS 1.3 listeners
    Resource:
      "AvailabilityZones":
        - "LoadBalancerAddresses": []
          "SubnetId": "subnet-0a42f65abd22d0d87"
          "ZoneName": "us-west-2a"
        - "LoadBalancerAddresses": []
          "SubnetId": "subnet-0aa42b18abd62e88f"
          "ZoneName": "us-west-2b"
      "CanonicalHostedZoneId": "Z1H1FL5HABSF5"
      "CreatedTime": "2023-04-17T23:46:54.550000+00:00"
      "DNSName": "tls13-46494243.us-west-2.elb.amazonaws.com"
      "IpAddressType": "ipv4"
      "Listeners":
        - "Certificates":
            - "CertificateArn": "arn:aws:acm:us-west-2:123456789012:certificate/517cb27d-03fb-4659-96a5-40592b25d977"
          "DefaultActions":
            - "ForwardConfig":
                "TargetGroupStickinessConfig":
                  "Enabled": false
                "TargetGroups":
                  - "TargetGroupArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:targetgroup/oktgname/67c62d09d6d23288"
                    "Weight": 1
              "TargetGroupArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:targetgroup/oktgname/67c62d09d6d23288"
              "Type": "forward"
          "ListenerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:listener/app/tls13/de81aaaa65555555/5f992ca6d5368214"
          "LoadBalancerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/tls13/de81aaaa65555555"
          "Port": 443
          "Protocol": "HTTPS"
          "SslPolicy": "ELBSecurityPolicy-TLS13-1-2-2021-06"
      "LoadBalancerArn": "arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/tls13/de81aaaa65555555"
      "LoadBalancerName": "tls13"
      "SSLPolicies":
        "ELBSecurityPolicy-TLS13-1-2-2021-06":
          "Ciphers":
            - "Name": "TLS_AES_128_GCM_SHA256"
              "Priority": 1
            - "Name": "TLS_AES_256_GCM_SHA384"
              "Priority": 2
            - "Name": "TLS_CHACHA20_POLY1305_SHA256"
              "Priority": 3
            - "Name": "ECDHE-ECDSA-AES128-GCM-SHA256"
              "Priority": 4
            - "Name": "ECDHE-RSA-AES128-GCM-SHA256"
              "Priority": 5
            - "Name": "ECDHE-ECDSA-AES128-SHA256"
              "Priority": 6
            - "Name": "ECDHE-RSA-AES128-SHA256"
              "Priority": 7
            - "Name": "ECDHE-ECDSA-AES256-GCM-SHA384"
              "Priority": 8
            - "Name": "ECDHE-RSA-AES256-GCM-SHA384"
              "Priority": 9
            - "Name": "ECDHE-ECDSA-AES256-SHA384"
              "Priority": 10
            - "Name": "ECDHE-RSA-AES256-SHA384"
              "Priority": 11
          "Name": "ELBSecurityPolicy-TLS13-1-2-2021-06"
          "SslProtocols":
            - "TLSv1.2"
            - "TLSv1.3"
          "SupportedLoadBalancerTypes":
            - "application"
            - "network"
      "Scheme": "internet-facing"
      "SecurityGroups":
        - "sg-0197ba84777a5858a"
      "State":
        "Code": "active"
      "Type": "application"
      "VpcId": "vpc-043e0527f2d6372ea"
