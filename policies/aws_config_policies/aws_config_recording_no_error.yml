AnalysisType: policy
Description: >-
  This policy ensures that the config recorder is operational and capturing changes
  to your account without error.
DisplayName: "AWS Config Recording Status"
Enabled: true
Filename: aws_config_recording_no_error.py
PolicyID: "AWS.Config.RecordingNoErrors"
Reference: 
  https://docs.aws.amazon.com/config/latest/developerguide/notification-delivery-failed.html
ResourceTypes:
  - AWS.Config.Recorder
Runbook: >-
  Check the AWS Config console to understand and resolve the cause of the errors.
Severity: Medium
Tags:
  - AWS
  - Panther
Tests:
  - ExpectedResult: true
    Name: Recording Enabled with No Errors
    Resource:
      "Recorder":
        "Name": "default"
        "RecordingGroup":
          "AllSupported": true
          "IncludeGlobalResourceTypes": true
          "ResourceTypes": []
        "RoleARN": "arn:aws:iam::112233445566:role/role-name"
      "Region": "us-west-2"
      "Status":
        "LastErrorCode":
        "LastErrorMessage":
        "LastStartTime": "2019-01-01T00:00:00Z"
        "LastStatus": "SUCCESS"
        "LastStatusChangeTime": "2019-01-01T00:00:00Z"
        "LastStopTime":
        "Name": "default"
        "Recording": true
  - ExpectedResult: false
    Name: Recording Errored
    Resource:
      "Recorder":
        "Name": "default"
        "RecordingGroup":
          "AllSupported": false
          "IncludeGlobalResourceTypes": true
          "ResourceTypes": []
        "RoleARN": "arn:aws:iam::112233445566:role/role-name"
      "Region": "us-west-2"
      "Status":
        "LastErrorCode": "NoSuchBucket"
        "LastErrorMessage": "Failed to deliver notification to bucket: bucket-example
          for account 123456789012 in region us-west-2"
        "LastStartTime": "2019-01-01T00:00:00Z"
        "LastStatus": "SUCCESS"
        "LastStatusChangeTime": "2019-01-01T00:00:00Z"
        "LastStopTime":
        "Name": "default"
        "Recording": true
