AnalysisType: policy
Description: >-
  Ensures that AWS WAF logging is enabled and that the logs are being sent to a valid
  destination (S3, CloudWatch, or Kinesis Firehose). Without logging, visibility into
  WAF activity is severely limited, increasing the risk of undetected attacks.
DisplayName: "AWS WAF Logging Configured"
Enabled: true
Filename: aws_waf_logging_configured.py
PolicyID: "AWS.WAF.LoggingConfigured"
Reference: https://docs.aws.amazon.com/waf/latest/developerguide/logging.html
Reports:
  MITRE ATT&CK:
    - TA0005:T1562
  PCI:
    - 10.5.5
ResourceTypes:
  - AWS.WAF.Regional.WebACL
  - AWS.WAF.WebACL
Runbook: >-
  Ensure AWS WAF logging is configured to at least one valid destination such as an
  Amazon S3 bucket, Amazon CloudWatch Logs, or Amazon Kinesis Data Firehose. Refer
  to the AWS WAF logging documentation for setup instructions.
Severity: High
Tags:
  - AWS
  - Monitoring
  - Logging
  - Security Control
  - Defense Evasion:Impair Defenses
Tests:
  - ExpectedResult: true
    Name: WAF Logging Configured to CloudWatch Logs
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:logs:us-west-2:123456789012:log-group:example-log-group"
        "RedactedFields":
  - ExpectedResult: true
    Name: WAF Logging Configured to S3
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:s3:::example-bucket/waf-logs/"
        "RedactedFields":
  - ExpectedResult: true
    Name: WAF Logging Configured to Kinesis Firehose
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:firehose:us-west-2:123456789012:deliverystream/example-firehose"
        "RedactedFields":
  - ExpectedResult: false
    Name: WAF Logging Not Configured
    Resource:
      "LoggingConfiguration":
  - ExpectedResult: false
    Name: WAF Logging Configured with Malformed CloudWatch Logs ARN
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:logs:us-west-2:123456789012"
        "RedactedFields":
  - ExpectedResult: false
    Name: WAF Logging Configured with Malformed S3 ARN
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:s3::example-bucket-wrong-format"
        "RedactedFields":
  - ExpectedResult: true
    Name: WAF Logging Configured to Both S3 and Kinesis Firehose
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:s3:::example-bucket/waf-logs/"
          - "arn:aws:firehose:us-west-2:123456789012:deliverystream/example-firehose"
        "RedactedFields":
  - ExpectedResult: false
    Name: WAF Logging Configured with Malformed Kinesis Firehose ARN
    Resource:
      "LoggingConfiguration":
        "LogDestinationConfigs":
          - "arn:aws:firehose:us-west-2"
        "RedactedFields":
