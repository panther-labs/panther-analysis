AnalysisType: policy
Description: >-
  This policy ensures that AWS WAF WebACLs are associated with at least one resource
  (ALB, CloudFront Distribution, or API Gateway). If a WebACL is not associated with
  any resources, it is inactive and not providing any protection.
DisplayName: "AWS WAF WebACL Has Associated Resources"
Enabled: true
Filename: aws_waf_webacl_has_associated_resources.py
PolicyID: "AWS.WAF.WebACLHasAssociatedResources"
Reference: https://docs.aws.amazon.com/waf/latest/developerguide/web-acl-associate.html
ResourceTypes:
  - AWS.WAF.Regional.WebACL
  - AWS.WAF.WebACL
Runbook: >-
  Associate the WAF WebACL with at least one resource, such as an Application Load
  Balancer (ALB), CloudFront Distribution, or API Gateway. WebACLs that are not associated
  with resources do not protect any traffic.
Severity: Medium
Tags:
  - AWS
  - Security Control
  - Optimization
Tests:
  - ExpectedResult: true
    Name: WebACL Associated with Resources
    Resource:
      "AssociatedResources":
        - "arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-app"
        - "arn:aws:cloudfront::123456789012:distribution/EXAMPLE"
      "ResourceType": "AWS.WAF.WebACL"
  - ExpectedResult: false
    Name: WebACL Not Associated with Resources
    Resource:
      "AssociatedResources": []
      "ResourceType": "AWS.WAF.WebACL"
  - ExpectedResult: true
    Name: WebACL Associated with Single Resource
    Resource:
      "AssociatedResources":
        - "arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-app"
      "ResourceType": "AWS.WAF.WebACL"
