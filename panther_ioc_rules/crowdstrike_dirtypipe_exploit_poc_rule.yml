AnalysisType: rule
Filename: crowdstrike_dirtypipe_exploit_poc_rule.py
RuleID: IOC.Crowdstrike.DirtyPipe.Hashes
DisplayName: DirtyPipe POC Hash Detection
Enabled: True
LogTypes:
  - Crowdstrike.ProcessRollup2
Tags:
  - Crowdstrike
  - DirtyPipe
Severity: Critical
Description: >
  Detects Hashes that contain DirtyPipe Exploit POC code. These could be used as an "off the shelf" exploitation
Reference: >
  https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0847
Runbook: >
  Investigate affected system, specifically filename matching hash. Patch to non vulnerable Kernel version if possible
SummaryAttributes:
  - p_any_ip_addresses
  - p_any_sha256_hashes

Tests:
  -
    Name: DirtyPipe Exploit Hash Detected
    ExpectedResult: true
    Log:
      {
      "event_simplename": "ProcessRollup2",
       "name": "ProcessRollup2LinuxV5",
       "aid": "9aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
       "aip": "1.1.1.1",
       "cid": "7bbbbbbbbbbbbb",
       "id": "b73a9d5d-aaf7-11eb-9009-06282f216951",
       "event_platform": "Linux",
       "timestamp": "2021-05-02 03:37:27.264",
       "configbuild": "1007.4.0013403.11",
       "configstatehash": "2559498804",
       "entitlements": "15",
       "imagefilename": "/bin/ps",
       "commandline": "/bin/ps aux",
       "rawprocessid": 42438,
       "processstarttime": "2021-05-02 03:37:22.597",
       "sha256hashdata": "092691d88c6dde0d8ad9a93f819657fec016e427e48a872faa6984af2202b529",
       "tags": "139, 12094627905582, 12094627906234, 211106232533130",
       "parentbasefilename": "somefile",
       "processgroupid": 352587198232266560,
       "uid": 0,
       "ruid": 501,
       "svuid": 501,
       "gid": 20,
       "rgid": 501,
       "svgid": 20,
       "sessionprocessid": 352461603267229250,
       "machosubtype": "1",
    }

  -
    Name: Non Vulnerable hash
    ExpectedResult: false
    Log:
      {
      "event_simplename": "ProcessRollup2",
       "name": "ProcessRollup2LinuxV5",
       "aid": "9aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
       "aip": "1.1.1.1",
       "cid": "7bbbbbbbbbbbbb",
       "id": "b73a9d5d-aaf7-11eb-9009-06282f216951",
       "event_platform": "Linux",
       "timestamp": "2021-05-02 03:37:27.264",
       "configbuild": "1007.4.0013403.11",
       "configstatehash": "2559498804",
       "entitlements": "15",
       "imagefilename": "/bin/ps",
       "commandline": "/bin/ps aux",
       "rawprocessid": 42438,
       "processstarttime": "2021-05-02 03:37:22.597",
       "sha256hashdata": "0D92691d88c6dde0dasdasdasdasdas57fec0dfgdfge48a872faa6984af2202b529",
       "tags": "139, 12094627905582, 12094627906234, 211106232533130",
       "parentbasefilename": "somefile",
       "processgroupid": 352587198232266560,
       "uid": 0,
       "ruid": 501,
       "svuid": 501,
       "gid": 20,
       "rgid": 501,
       "svgid": 20,
       "sessionprocessid": 352461603267229250,
       "machosubtype": "1",
    }

