from panther_iocs import DIRTYPIPE_POC_HASHES

# Detects known POC code that could be used to "off the shelf" exploit CVE-2022-0847 aka DirtyPipe


def rule(event):
    return event.get("sha256hashdata") in DIRTYPIPE_POC_HASHES


def title(event):
    return (
        "A file with a SHA256 hash matching CVE-2022-0847 was seen running with filename"
        f"{ event.get('imagefilename') }"
    )


def alert_context(event):
    context = {
        "hash": event.get("sha256hashdata"),
        "filename": event.get("imagefilename"),
        "crowdstrike_aid": event.get("aid"),
        "ip_address": event.get("aip"),
    }

    return context
