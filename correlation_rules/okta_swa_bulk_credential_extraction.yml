AnalysisType: correlation_rule
RuleID: "Okta.SWA.Bulk.Credential.Extraction"
DisplayName: "Okta SWA Bulk Credential Extraction"
Enabled: true
Status: Experimental
Tags:
  - Identity & Access Management
  - Okta
  - SWA
  - Credential Access:Credentials from Password Stores
  - Bulk Activity
Reports:
  MITRE ATT&CK:
    - TA0006:T1555  # Credentials from Password Stores
Severity: High
Description: |
  Detects potential bulk SWA (Secure Web Authentication) credential extraction attempts
  in Okta. When a user or attacker accesses more than 5 unique SWA applications within
  a 10-minute window, this may indicate automated credential harvesting. SWA apps store
  credentials in Okta's encrypted vault, and bulk access patterns suggest an attempt to
  extract multiple application credentials rapidly.
Reference: https://www.spera.security/resources/okta-swa-configuration-understanding-the-concept-and-different-configurations
Runbook: |
  1. Verify if the bulk application access was legitimate user behavior
  2. Review the list of accessed applications for sensitive targets
  3. Check the source IP address and geolocation for anomalies
  4. Investigate the user's recent authentication history for signs of compromise
  5. Review user-agent strings for automation tools (scripts, bots)
  6. If unauthorized, immediately suspend the user account and revoke active sessions
  7. Force password reset and MFA re-enrollment for the affected user
  8. Audit all SWA application credentials accessed during the window
  9. Check for any credential usage in the target applications
  10. Review Okta admin audit logs for any policy or configuration changes
Detection:
  - Sequence:
      - ID: SWA App Access
        RuleID: Okta.SWA.App.Access
        MinMatchCount: 6
    Transitions:
      - ID: Multiple SWA Apps Accessed
        From: SWA App Access
        To: SWA App Access
        WithinTimeFrameMinutes: 10
        Match:
          - On: actor.alternateId
    Schedule:
      RateMinutes: 60
      TimeoutMinutes: 15
    LookbackWindowMinutes: 120
Tests:
  - Name: User Accesses 8 Unique SWA Apps in 2 Minutes
    ExpectedResult: true
    RuleOutputs:
      - ID: SWA App Access
        Matches:
          actor.alternateId:
            attacker@company.com:
              - 0
              - 1
              - 2
              - 3
              - 4
              - 5
              - 6
              - 7
          app_id:
            Salesforce: [0]
            Workday: [1]
            ServiceNow: [2]
            Jira: [3]
            Confluence: [4]
            Zendesk: [5]
            Slack: [6]
            GitHub: [7]

  - Name: User Accesses 3 SWA Apps (Below Threshold)
    ExpectedResult: false
    RuleOutputs:
      - ID: SWA App Access
        Matches:
          actor.alternateId:
            user@company.com:
              - 0
              - 1
              - 2
          app_id:
            Salesforce: [0]
            Gmail: [1]
            Slack: [2]

  - Name: Same App Accessed Multiple Times (Not Unique)
    ExpectedResult: false
    RuleOutputs:
      - ID: SWA App Access
        Matches:
          actor.alternateId:
            user@company.com:
              - 0
              - 1
              - 2
              - 3
              - 4
              - 5
              - 6
              - 7
          app_id:
            Salesforce: [0, 1, 2, 3, 4, 5, 6, 7]

  - Name: Multiple Users Each Access Different Apps (Should Not Correlate)
    ExpectedResult: false
    RuleOutputs:
      - ID: SWA App Access
        Matches:
          actor.alternateId:
            user1@company.com:
              - 0
              - 1
              - 2
            user2@company.com:
              - 3
              - 4
              - 5
          app_id:
            Salesforce: [0, 3]
            Gmail: [1, 4]
            Slack: [2, 5]
