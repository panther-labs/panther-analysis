AnalysisType: correlation_rule
Description: >-
  A Notion User logged in then changed their account details.
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 5
    Sequence:
      - ID: Login
        RuleID: Notion.Login
      - ID: AccountChange
        RuleID: Notion.AccountChange
    Transitions:
      - From: Login
        ID: Login FOLLOWED BY AccountChange
        Match:
          - On: p_alert_context.actor_id
        To: AccountChange
        WithinTimeFrameMinutes: 15
DisplayName: "Notion Login FOLLOWED BY AccountChange"
Enabled: true
Reference: https://www.notion.so/help/account-settings
Reports:
  MITRE ATT&CK:
    - TA0004:T1098
RuleID: "Notion.Login.FOLLOWED.BY.AccountChange"
Runbook: >-
  Possible account takeover. Follow up with the Notion User to determine if this email
  change is genuine.
Severity: Medium
Tests:
  - ExpectedResult: true
    Name: Login, Followed By AccountChange within short time
    RuleOutputs:
      - ID: Login
        Matches:
          p_alert_context.actor_id:
            i-abcdef0123456789a:
              - '2024-06-01T10:00:01Z'
      - ID: AccountChange
        Matches:
          p_alert_context.actor_id:
            i-abcdef0123456789a:
              - '2024-06-01T10:01:01Z'
  - ExpectedResult: false
    Name: Login, Followed By AccountChange not within short time
    RuleOutputs:
      - ID: Login
        Matches:
          p_alert_context.actor_id:
            i-abcdef0123456789a:
              - '2024-06-01T10:00:01Z'
      - ID: AccountChange
        Matches:
          p_alert_context.actor_id:
            i-abcdef0123456789a:
              - '2024-06-01T11:01:01Z'
