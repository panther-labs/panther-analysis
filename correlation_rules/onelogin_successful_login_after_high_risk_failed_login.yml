AnalysisType: correlation_rule
Description: >-
  A OneLogin user successfully logged in after a failed high-risk login attempt.
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 5
    Sequence:
      - ID: HighRiskFailedLogin
        RuleID: OneLogin.HighRiskFailedLogin
      - ID: SuccessfulLogin
        RuleID: OneLogin.Login
    Transitions:
      - From: HighRiskFailedLogin
        ID: HighRiskFailedLogin FOLLOWED BY SuccessfulLogin
        Match:
          - On: user_name
        To: SuccessfulLogin
        WithinTimeFrameMinutes: 15
DisplayName: "OneLogin High Risk Failed Login FOLLOWED BY Successful Login"
Enabled: true
Reference: https://resources.onelogin.com/OneLogin_RiskBasedAuthentication-WP-v5.pdf
Reports:
  MITRE ATT&CK:
    - TA0001:T1078
RuleID: "OneLogin.HighRiskFailedLogin.FOLLOWED.BY.SuccessfulLogin"
Runbook: >-
  Investigate whether this was caused by expected user activity.
Severity: Medium
Tests:
  - ExpectedResult: true
    Name: High Risk Failed Login FOLLOWED BY Successful Login within short time
    RuleOutputs:
      - ID: HighRiskFailedLogin
        Matches:
          user_name:
            Some_user:
              - '2024-06-01T10:00:01Z'
      - ID: SuccessfulLogin
        Matches:
          user_name:
            Some_user:
              - '2024-06-01T10:01:01Z'
  - ExpectedResult: false
    Name: High Risk Failed Login FOLLOWED BY Successful Login not within short time
    RuleOutputs:
      - ID: HighRiskFailedLogin
        Matches:
          user_name:
            Some_user:
              - '2024-06-01T10:00:01Z'
      - ID: SuccessfulLogin
        Matches:
          user_name:
            Some_user:
              - '2024-06-01T11:01:01Z'
  - ExpectedResult: false
    Name: High Risk Failed Login FOLLOWED BY Successful Login of other user
    RuleOutputs:
      - ID: HighRiskFailedLogin
        Matches:
          user_name:
            Some_user:
              - '2024-06-01T10:00:01Z'
      - ID: SuccessfulLogin
        Matches:
          user_name:
            Some_other_user:
              - '2024-06-01T10:01:01Z'
