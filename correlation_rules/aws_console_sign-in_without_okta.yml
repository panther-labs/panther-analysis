AnalysisType: correlation_rule
RuleID: "AWS.Console.Sign-In.NOT.PRECEDED.BY.Okta"
DisplayName: "AWS Console Sign-In NOT PRECEDED BY Okta Redirect"
Enabled: true
Tags:
    - AWS
    - Configuration Required
    - Okta
Severity: High
Description: A user has logged into the AWS console without authenticating via Okta.  This rule requires AWS SSO via Okta, both log sources configured, and Actor Profiles enabled.
Detection:
    - Sequence:
        - ID: Okta SSO to AWS
          RuleID: SIGNAL.-.Okta.SSO.to.AWS
          Absence: true
        - ID: AWS Console Sign-In
          RuleID: SIGNAL.-.AWS.Console.Sign-In
          MinMatchCount: 1
      Transitions:
        - ID: Okta SSO to AWS TO AWS Console Sign-In ON username
          From: Okta SSO to AWS
          To: AWS Console Sign-In
          WithinTimeFrameMinutes: 5
          Match:
            - On: p_udm.user.id
      Schedule:
        RateMinutes: 10
        TimeoutMinutes: 2
      LookbackWindowMinutes: 15
