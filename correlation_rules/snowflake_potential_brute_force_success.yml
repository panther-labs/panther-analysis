AnalysisType: correlation_rule
Description: >-
  Detecting brute force activity and reporting when a user has incorrectly logged
  in multiple times and then had a successful login.
Detection:
  - LookbackWindowMinutes: 1440
    Schedule:
      RateMinutes: 720
      TimeoutMinutes: 15
    Sequence:
      - ID: Multiple Failed Logins
        MinMatchCount: 5
        RuleID: Snowflake.Stream.BruteForceByIp
      - ID: Successful Login
        RuleID: Snowflake.Stream.LoginSuccess
    Transitions:
      - From: Multiple Failed Logins
        ID: Multiple Failed Logins FOLLOWED BY Successful Login
        Match:
          - On: CLIENT_IP
        To: Successful Login
        WithinTimeFrameMinutes: 30
DisplayName: "Snowflake Brute Force Login Success"
Enabled: true
RuleID: "Snowflake.PotentialBruteForceSuccess"
Severity: High
Tests:
  - ExpectedResult: true
    Name: Successful Bulk Login
    RuleOutputs:
      - ID: Multiple Failed Logins
        Matches:
          CLIENT_IP:
            1.1.1.1:
              - 0
              - 2
              - 3
              - 6
              - 9
              - 10
              - 11
              - 15
      - ID: Successful Login
        Matches:
          CLIENT_IP:
            1.1.1.1:
              - 16
  - ExpectedResult: false
    Name: Successful Login With Single Failure
    RuleOutputs:
      - ID: Multiple Failed Logins
        Matches:
          CLIENT_IP:
            1.1.1.1:
              - 0
      - ID: Successful Login
        Matches:
          CLIENT_IP:
            1.1.1.1:
              - 1
