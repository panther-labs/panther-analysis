AnalysisType: correlation_rule
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 10
    Sequence:
      - ID: Okta
        RuleID: Okta.Login.Success
      - Absence: true
        ID: Push
        RuleID: Push.Security.Authorized.IdP.Login
    Transitions:
      - From: Okta
        ID: Okta to Push
        Match:
          - From: actor.alternateId
            To: new.email
        To: Push
        WithinTimeFrameMinutes: 60
DisplayName: "Okta Login Without Push"
Enabled: false
Reports:
  MITRE ATT&CK:
    - TA0006:T1212
    - TA0006:T1539
RuleID: "Okta.Login.Without.Push"
Severity: Critical
Tags:
  - Push Security
  - Configuration Required
Tests:
  - ExpectedResult: false
    Name: Okta Login, Followed By Push Authorized Login
    RuleOutputs:
      - ID: Okta
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push
        Matches:
          new.email:
            frodo.baggins@hobbiton.com:
              - 3
  - ExpectedResult: true
    Name: Okta Login, Not Followed By Push Authorized Login
    RuleOutputs:
      - ID: Okta
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
  - ExpectedResult: true
    Name: Okta Login, Followed By Push Authorized Login By Other User
    RuleOutputs:
      - ID: Okta
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push
        Matches:
          new.email:
            samwise.gamgee@hobbiton.com:
              - 3
