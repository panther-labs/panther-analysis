AnalysisType: correlation_rule
RuleID: "Okta.Login.Without.Push"
DisplayName: "Okta Login Without Push"
Enabled: false
Tags:
  - Okta
  - Push Security
  - Identity Verification
  - Configuration Required
  - Credential Access
Reports:
  MITRE ATT&CK:
    - TA0001:T1078 # Initial Access: Valid Accounts
    - TA0006:T1539 # Credential Access: Steal Web Session Cookie
    - TA0006:T1621 # Credential Access: Multi-Factor Authentication Request Generation
Severity: Critical
Description: >
  This correlation rule identifies successful Okta authentication events that are not followed by a corresponding Push Security authorized login within 60 minutes for the same user. Push Security provides an additional layer of identity verification and authentication assurance beyond standard Okta MFA. When a legitimate user logs into Okta, they should subsequently authenticate through Push Security as part of the organization's layered security controls. The absence of a Push Security login following an Okta authentication may indicate several security concerns: compromised credentials being used by an attacker who cannot complete the Push Security verification, session hijacking where an attacker has obtained a valid Okta session token without possessing the user's Push Security authentication factors, MFA bypass attempts through phishing-resistant authentication gaps, or unauthorized access through stolen or weak credentials. This detection helps identify cases where standard Okta MFA was satisfied but the additional Push Security verification layer was bypassed or not completed, suggesting potential credential compromise or session theft. Organizations using Push Security as a defense-in-depth strategy should investigate these events to determine if the Okta login was legitimate but the user forgot to complete Push verification, or if the access represents unauthorized activity. This rule requires configuration to match your organization's specific Push Security integration and expected authentication workflows. The 60-minute time window accounts for users who may delay their Push Security login after Okta authentication, but this should be adjusted based on organizational policies and typical user behavior patterns.
Runbook: |
  1. Query Okta System Log for all authentication events by actor.alternateId in the 90 minutes around the login to check if Push Security authentication occurred outside the 60-minute detection window, and review the source IP, geolocation, device, and MFA method used
  2. Query Push Security logs for any authentication attempts or failures by the same user in the 2 hours around the Okta login to determine if the user attempted but failed to complete Push Security verification
  3. Check Okta audit logs for all application access, permission changes, and administrative actions during the Okta session to identify suspicious activity that may indicate compromised credentials or session hijacking
Reference: https://www.okta.com/resources/datasheet/okta-adaptive-multi-factor-authentication-product-datasheet/
Detection:
  - Sequence:
      - ID: Okta
        RuleID: Okta.Login.Success
      - ID: Push
        RuleID: Push.Security.Authorized.IdP.Login
        Absence: true
    Transitions:
      - ID: Okta to Push
        From: Okta
        To: Push
        WithinTimeFrameMinutes: 60
        Match:
          - From: actor.alternateId
            To: new.email
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 10
    LookbackWindowMinutes: 2160
Tests:
  - Name: Okta Login, Followed By Push Authorized Login
    ExpectedResult: false
    RuleOutputs:
      - ID: Okta
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push
        Matches:
          new.email:
            frodo.baggins@hobbiton.com:
              - 3
  - Name: Okta Login, Not Followed By Push Authorized Login
    ExpectedResult: true
    RuleOutputs:
      - ID: Okta
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
  - Name: Okta Login, Followed By Push Authorized Login By Other User
    ExpectedResult: true
    RuleOutputs:
      - ID: Okta
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push
        Matches:
          new.email:
            samwise.gamgee@hobbiton.com:
              - 3
