AnalysisType: correlation_rule
Description: >-
  The rule detects when a GitHub Secret Scan detects an exposed secret, which is not
  followed by the expected quarantine operation in AWS.  When you make a repository
  public, or push changes to a public repository, GitHub always scans the code for
  secrets that match partner patterns. Public packages on the npm registry are also
  scanned. If secret scanning detects a potential secret, we notify the service provider
  who issued the secret. The service provider validates the string and then decides
  whether they should revoke the secret, issue a new secret, or contact you directly.
  Their action will depend on the associated risks to you or them.
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 10
    Sequence:
      - ID: SecretFound
        RuleID: GitHub.Secret.Scanning.Alert.Created
      - Absence: true
        ID: SecretNotQuarantined
        RuleID: AWS.CloudTrail.IAMCompromisedKeyQuarantine
    Transitions:
      - From: SecretFound
        ID: SecretFound TO SecretNotQuarantined
        To: SecretNotQuarantined
        WithinTimeFrameMinutes: 60
DisplayName: "Secret Exposed and not Quarantined"
Enabled: false
Reference: https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning
Reports:
  MITRE ATT&CK:
    - TA0006:T1552.001
RuleID: "Secret.Exposed.and.not.Quarantined"
Severity: High
Tags:
  - 'Unsecured Credentials: Credentials in Files'
Tests:
  - ExpectedResult: false
    Name: Secret Found and Quarantied
    RuleOutputs:
      - ID: SecretFound
        Matches:
          foo:
            bar:
              - 0
      - ID: SecretNotQuarantined
        Matches:
          foo:
            bar:
              - 30
  - ExpectedResult: true
    Name: Secret Found and Not Quarantied
    RuleOutputs:
      - ID: SecretFound
        Matches:
          foo:
            bar:
              - 0
