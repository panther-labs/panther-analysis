AnalysisType: correlation_rule
RuleID: "Secret.Exposed.and.not.Quarantined"
DisplayName: "Secret Exposed and not Quarantined"
Enabled: true
Tags:
    - 'Unsecured Credentials: Credentials in Files'
Severity: High
Reports:
    MITRE ATT&CK:
        - T1552.001
Description: The rule detects when a GitHub Secret Scan detects an exposed secret, which is not followed by the expected quarantine operation in AWS.  When you make a repository public, or push changes to a public repository, GitHub always scans the code for secrets that match partner patterns. Public packages on the npm registry are also scanned. If secret scanning detects a potential secret, we notify the service provider who issued the secret. The service provider validates the string and then decides whether they should revoke the secret, issue a new secret, or contact you directly. Their action will depend on the associated risks to you or them.
Reference: https://docs.github.com/en/code-security/secret-scanning/about-secret-scanning
Detection:
    - Sequence: # Create a list of rules or signals to correlate (order matters)
        - ID: SecretFound
          RuleID: GitHub.Secret.Scanning.Alert.Created
          MinMatchCount: 1
        - ID: SecretNotQuarantined
          RuleID: AWS.CloudTrail.IAMCompromisedKeyQuarantine
          Absence: true # makes sure the step did not happen
      Transitions: # Add conditions for each transition, if needed (otherwise, the sequence will use any matches)
        - ID: SecretFoundAndNotQuarantined
          From: SecretFound # ID from sequence step   
          To: SecretNotQuarantined # ID from sequence step 
          WithinTimeFrameMinutes: 15
      Schedule:
        RateMinutes: 10
        # CronExpression: # set if you need a schedule other than minutes 
        TimeoutMinutes: 2
      LookbackWindowMinutes: 30 # the amount of time this correlation rule should lookback over when evaluating rule and signal matches
