AnalysisType: correlation_rule
RuleID: "Potential.Compromised.Okta.Credentials"
DisplayName: "Potential Compromised Okta Credentials"
Enabled: false
Tags:
  - Okta
  - Push Security
  - Credential Compromise
  - Phishing
  - Configuration Required
Reports:
  MITRE ATT&CK:
    - TA0001:T1078 # Initial Access: Valid Accounts
    - TA0006:T1539 # Credential Access: Steal Web Session Cookie
    - TA0006:T1598 # Credential Access: Phishing for Information
    - TA0006:T1621 # Credential Access: Multi-Factor Authentication Request Generation
Severity: Critical
Description: >
  This correlation rule identifies a high-confidence indicator of compromised Okta credentials by detecting when a user logs into Okta without completing Push Security verification, followed by a Push Security phishing attack detection for the same user within 60 minutes. This sequence strongly suggests that an attacker has obtained the user's Okta credentials (through credential theft, phishing, password reuse, or data breach) and successfully authenticated to Okta, bypassing the Push Security verification step. Subsequently, the attacker attempts to trick the legitimate user into approving a fraudulent authentication request through Push Security phishing (MFA fatigue attack, push bombing, or social engineering) to gain additional access or maintain persistence. This behavior pattern is a critical security incident indicating active credential compromise and attempted multi-factor authentication bypass. The correlation of these two events within a short timeframe provides strong evidence that the user's account is under active attack. Unlike a simple missed Push Security login, this detection combines the absence of proper verification with an active phishing attempt, significantly reducing false positives and highlighting accounts requiring immediate investigation and remediation. Organizations should treat these alerts as high-priority security incidents requiring immediate password resets, session termination, and investigation into the source of credential compromise.
Runbook: |
  1. Query Okta System Log for all actions taken during the compromised session by actor.alternateId between the unauthorized login and Push Security phishing attack, looking for application access, data downloads, configuration changes, or privilege escalations
  2. Review the Push Security phishing attack details to identify the attacker's tactics, timing, and social engineering methods, then analyze the source IP address from the Okta login using threat intelligence feeds to determine if it's associated with known malicious infrastructure
  3. Query email logs and security awareness training platforms for phishing emails targeting the user in the 30 days before the compromise to identify the potential credential theft vector
Reference: https://www.okta.com/resources/datasheet/okta-adaptive-multi-factor-authentication-product-datasheet/
Detection:
  - Sequence:
      - ID: Login Without Push Marker
        RuleID: Okta.Login.Without.Push.Marker
      - ID: Push Phishing
        RuleID: Push.Security.Phishing.Attack
    Transitions:
      - ID: Match on user
        From: Login Without Push Marker
        To: Push Phishing
        WithinTimeFrameMinutes: 60
        Match:
          - From: actor.alternateId
            To: new.employee.email
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 10
    LookbackWindowMinutes: 2160
Tests:
  - Name: Login Without Marker, Followed By Phishing Detection
    ExpectedResult: true
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push Phishing
        Matches:
          new.employee.email:
            frodo.baggins@hobbiton.com:
              - 3
  - Name: Login Without Marker, Followed By Phishing Detection for Different User
    ExpectedResult: false
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push Phishing
        Matches:
          new.employee.email:
            samwise.gamgee@hobbiton.com:
              - 3
  - Name: Login Without Marker, Not Followed By Phishing Detection
    ExpectedResult: false
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
