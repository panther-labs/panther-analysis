AnalysisType: correlation_rule
RuleID: "Potential.Compromised.Okta.Credentials"
DisplayName: "Potential Compromised Okta Credentials"
Enabled: false
Tags:
  - Okta
  - Push Security
  - Credential Compromise
  - Phishing
  - Configuration Required
Reports:
  MITRE ATT&CK:
    - TA0001:T1078 # Initial Access: Valid Accounts
    - TA0006:T1539 # Credential Access: Steal Web Session Cookie
    - TA0006:T1598 # Credential Access: Phishing for Information
    - TA0006:T1621 # Credential Access: Multi-Factor Authentication Request Generation
Severity: Critical
Description: >
  This correlation rule identifies a high-confidence indicator of compromised Okta credentials by detecting when a user logs into Okta without completing Push Security verification, followed by a Push Security phishing attack detection for the same user within 60 minutes. This sequence strongly suggests that an attacker has obtained the user's Okta credentials (through credential theft, phishing, password reuse, or data breach) and successfully authenticated to Okta, bypassing the Push Security verification step. Subsequently, the attacker attempts to trick the legitimate user into approving a fraudulent authentication request through Push Security phishing (MFA fatigue attack, push bombing, or social engineering) to gain additional access or maintain persistence. This behavior pattern is a critical security incident indicating active credential compromise and attempted multi-factor authentication bypass. The correlation of these two events within a short timeframe provides strong evidence that the user's account is under active attack. Unlike a simple missed Push Security login, this detection combines the absence of proper verification with an active phishing attempt, significantly reducing false positives and highlighting accounts requiring immediate investigation and remediation. Organizations should treat these alerts as high-priority security incidents requiring immediate password resets, session termination, and investigation into the source of credential compromise.
Runbook: |
  1. Review the alert details to identify the user account with the Okta login without Push Security verification and the subsequent Push Security phishing attack detection, noting timestamps for both events
  2. Immediately contact the user through a trusted out-of-band communication channel (phone call, in-person, or verified alternate contact method) to confirm they did NOT attempt to log into Okta during the identified timeframe
  3. If the user confirms they did not attempt the login: Immediately force password reset for the Okta account, revoke all active Okta sessions and refresh tokens, and disable the account temporarily until investigation is complete
  4. Review the Okta authentication logs (Reports > System Log) to identify the source IP address, geolocation, device, and user agent information for the unauthorized login attempt
  5. Check for signs of credential compromise: Review the user's password age, check if their credentials appear in known breach databases (Have I Been Pwned), and investigate recent phishing emails or suspicious activity targeting the user
  6. Examine the Push Security phishing attack details to understand the attacker's tactics: Review the phishing attempt method, timing, and any social engineering techniques used to target the user
  7. Review all actions taken during the compromised Okta session: Check application access, data downloads, configuration changes, privilege escalations, or any lateral movement attempts across connected systems
  8. Investigate the attacker's infrastructure: Analyze the source IP address, check threat intelligence feeds, identify if the IP is associated with known malicious activity, VPN/proxy usage, or geographic anomalies
  9. Require the user to re-enroll all MFA devices, enable enhanced security monitoring for the account, and provide security awareness training on recognizing phishing attempts and protecting credentials
  10. Document the incident in your security incident management system including timeline, compromise vector, attacker actions, and implement additional monitoring for the affected user and similar attack patterns across the organization
Reference: https://www.okta.com/resources/datasheet/okta-adaptive-multi-factor-authentication-product-datasheet/
Detection:
  - Sequence:
      - ID: Login Without Push Marker
        RuleID: Okta.Login.Without.Push.Marker
      - ID: Push Phishing
        RuleID: Push.Security.Phishing.Attack
    Transitions:
      - ID: Match on user
        From: Login Without Push Marker
        To: Push Phishing
        WithinTimeFrameMinutes: 60
        Match:
          - From: actor.alternateId
            To: new.employee.email
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 10
    LookbackWindowMinutes: 2160
Tests:
  - Name: Login Without Marker, Followed By Phishing Detection
    ExpectedResult: true
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push Phishing
        Matches:
          new.employee.email:
            frodo.baggins@hobbiton.com:
              - 3
  - Name: Login Without Marker, Followed By Phishing Detection for Different User
    ExpectedResult: false
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push Phishing
        Matches:
          new.employee.email:
            samwise.gamgee@hobbiton.com:
              - 3
  - Name: Login Without Marker, Not Followed By Phishing Detection
    ExpectedResult: false
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
