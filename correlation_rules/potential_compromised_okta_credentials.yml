AnalysisType: correlation_rule
Detection:
  - LookbackWindowMinutes: 2160
    Schedule:
      RateMinutes: 1440
      TimeoutMinutes: 10
    Sequence:
      - ID: Login Without Push Marker
        RuleID: Okta.Login.Without.Push.Marker
      - ID: Push Phishing
        RuleID: Push.Security.Phishing.Attack
    Transitions:
      - From: Login Without Push Marker
        ID: Match on user
        Match:
          - From: actor.alternateId
            To: new.employee.email
        To: Push Phishing
        WithinTimeFrameMinutes: 60
DisplayName: "Potential Compromised Okta Credentials"
Enabled: false
Reports:
  MITRE ATT&CK:
    - TA0006:T1212
    - TA0006:T1539
RuleID: "Potential.Compromised.Okta.Credentials"
Severity: Critical
Tags:
  - Push Security
  - Configuration Required
Tests:
  - ExpectedResult: true
    Name: Login Without Marker, Followed By Phishing Detection
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push Phishing
        Matches:
          new.employee.email:
            frodo.baggins@hobbiton.com:
              - 3
  - ExpectedResult: false
    Name: Login Without Marker, Followed By Phishing Detection for Different User
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
      - ID: Push Phishing
        Matches:
          new.employee.email:
            samwise.gamgee@hobbiton.com:
              - 3
  - ExpectedResult: false
    Name: Login Without Marker, Not Followed By Phishing Detection
    RuleOutputs:
      - ID: Login Without Push Marker
        Matches:
          actor.alternateId:
            frodo.baggins@hobbiton.com:
              - 0
